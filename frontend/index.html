<!DOCTYPE html>
<html lang="zh-CN" data-theme="galaxy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Jotmo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+SC:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* ==================== Design Tokens ==================== */
        :root {
            /* Layout Tokens (shared) */
            --radius-card: 20px;
            --radius-btn: 14px;
            --radius-input: 12px;
            --blur-1: 20px;

            /* Animation */
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --duration-fast: 150ms;
            --duration-normal: 250ms;
            --duration-slow: 400ms;
        }

        /* ==================== Galaxy Theme ==================== */
        [data-theme="galaxy"] {
            /* Background layers */
            --bg-0: #08090f;
            --bg-1: #0d0f1a;
            --bg-2: #131628;
            --bg-rgb: 8, 9, 15;

            /* Halo colors (nebula) */
            --halo-1: rgba(139, 92, 246, 0.15);   /* violet */
            --halo-2: rgba(59, 130, 246, 0.12);   /* blue */
            --halo-3: rgba(34, 211, 238, 0.10);   /* cyan */
            --halo-4: rgba(168, 85, 247, 0.08);   /* purple */
            --halo-5: rgba(96, 165, 250, 0.10);   /* light blue */

            /* Noise */
            --noise-opacity: 0.03;

            /* Surface (glass cards) */
            --surface-1: rgba(255, 255, 255, 0.06);
            --surface-2: rgba(255, 255, 255, 0.09);
            --surface-input: rgba(0, 0, 0, 0.25);

            /* Borders */
            --border-1: rgba(255, 255, 255, 0.08);
            --border-2: rgba(255, 255, 255, 0.12);
            --border-iridescent: linear-gradient(135deg,
                rgba(139, 92, 246, 0.3),
                rgba(59, 130, 246, 0.3),
                rgba(34, 211, 238, 0.3));

            /* Text */
            --text-1: rgba(255, 255, 255, 0.95);
            --text-2: rgba(255, 255, 255, 0.65);
            --text-3: rgba(255, 255, 255, 0.40);

            /* Primary (button gradient) */
            --primary-1: #8B5CF6;
            --primary-2: #3B82F6;
            --primary-3: #22D3EE;
            --primary-gradient: linear-gradient(135deg, var(--primary-1) 0%, var(--primary-2) 50%, var(--primary-3) 100%);
            --primary-glow: rgba(139, 92, 246, 0.35);

            /* Focus */
            --focus: rgba(139, 92, 246, 0.5);

            /* Shadow */
            --shadow-1: 0 4px 24px rgba(0, 0, 0, 0.4);
            --shadow-2: 0 8px 40px rgba(0, 0, 0, 0.5);

            /* Accent colors */
            --success: #34D399;
            --danger: #F87171;
        }

        /* ==================== Forest Theme ==================== */
        [data-theme="forest"] {
            /* Background layers */
            --bg-0: #0a1210;
            --bg-1: #0f1a16;
            --bg-2: #162420;
            --bg-rgb: 10, 18, 16;

            /* Halo colors (mist/fog) */
            --halo-1: rgba(52, 211, 153, 0.12);   /* emerald */
            --halo-2: rgba(167, 243, 208, 0.10); /* mint */
            --halo-3: rgba(253, 230, 138, 0.08); /* warm yellow */
            --halo-4: rgba(110, 231, 183, 0.10); /* teal */
            --halo-5: rgba(187, 247, 208, 0.08); /* light green */

            /* Noise */
            --noise-opacity: 0.04;

            /* Surface (glass cards with warmth) */
            --surface-1: rgba(255, 255, 255, 0.07);
            --surface-2: rgba(255, 255, 255, 0.10);
            --surface-input: rgba(0, 0, 0, 0.20);

            /* Borders */
            --border-1: rgba(167, 243, 208, 0.10);
            --border-2: rgba(167, 243, 208, 0.15);
            --border-iridescent: linear-gradient(135deg,
                rgba(52, 211, 153, 0.25),
                rgba(167, 243, 208, 0.25),
                rgba(253, 230, 138, 0.20));

            /* Text (warmer tones) */
            --text-1: rgba(255, 255, 250, 0.95);
            --text-2: rgba(255, 255, 250, 0.60);
            --text-3: rgba(255, 255, 250, 0.38);

            /* Primary (moss/mint gradient) */
            --primary-1: #059669;
            --primary-2: #34D399;
            --primary-3: #FDE68A;
            --primary-gradient: linear-gradient(135deg, var(--primary-1) 0%, var(--primary-2) 60%, var(--primary-3) 100%);
            --primary-glow: rgba(52, 211, 153, 0.30);

            /* Focus */
            --focus: rgba(52, 211, 153, 0.5);

            /* Shadow */
            --shadow-1: 0 4px 24px rgba(0, 0, 0, 0.35);
            --shadow-2: 0 8px 40px rgba(0, 0, 0, 0.45);

            /* Accent colors */
            --success: #34D399;
            --danger: #FB7185;
        }

        /* ==================== Base Reset ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            color-scheme: dark;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Noto Sans SC', 'Inter', -apple-system, sans-serif;
            min-height: 100vh;
            color: var(--text-1);
            overflow-x: hidden;
            line-height: 1.6;
            background: var(--bg-0);
            transition: background var(--duration-slow) var(--ease-out);
        }

        /* ==================== Animated Background ==================== */
        .theme-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
            background: var(--bg-0);
            transition: background var(--duration-slow) var(--ease-out);
        }

        /* Gradient base layer */
        .theme-bg::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 60% at 20% 10%, var(--bg-2) 0%, transparent 60%),
                radial-gradient(ellipse 60% 80% at 80% 90%, var(--bg-1) 0%, transparent 50%);
            transition: background var(--duration-slow) var(--ease-out);
        }

        /* Noise texture overlay */
        .theme-bg::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            opacity: var(--noise-opacity);
            pointer-events: none;
            transition: opacity var(--duration-slow);
        }

        /* Floating halo orbs */
        .halo-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            transition: background var(--duration-slow) var(--ease-out);
            will-change: transform;
        }

        .halo-orb:nth-child(1) {
            width: 600px;
            height: 600px;
            background: var(--halo-1);
            top: -15%;
            left: -10%;
            animation: float1 45s ease-in-out infinite;
        }

        .halo-orb:nth-child(2) {
            width: 500px;
            height: 500px;
            background: var(--halo-2);
            top: 30%;
            right: -20%;
            animation: float2 50s ease-in-out infinite;
        }

        .halo-orb:nth-child(3) {
            width: 450px;
            height: 450px;
            background: var(--halo-3);
            bottom: 5%;
            left: 15%;
            animation: float3 55s ease-in-out infinite;
        }

        .halo-orb:nth-child(4) {
            width: 400px;
            height: 400px;
            background: var(--halo-4);
            top: 50%;
            left: 40%;
            animation: float4 60s ease-in-out infinite;
        }

        .halo-orb:nth-child(5) {
            width: 350px;
            height: 350px;
            background: var(--halo-5);
            bottom: 20%;
            right: 5%;
            animation: float5 48s ease-in-out infinite;
        }

        /* Galaxy theme: add subtle star points */
        [data-theme="galaxy"] .theme-bg .stars {
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.3) 0%, transparent 100%),
                radial-gradient(1px 1px at 40% 70%, rgba(255,255,255,0.2) 0%, transparent 100%),
                radial-gradient(1px 1px at 65% 20%, rgba(255,255,255,0.25) 0%, transparent 100%),
                radial-gradient(1.5px 1.5px at 75% 50%, rgba(255,255,255,0.15) 0%, transparent 100%),
                radial-gradient(1px 1px at 90% 80%, rgba(255,255,255,0.2) 0%, transparent 100%),
                radial-gradient(1px 1px at 10% 60%, rgba(255,255,255,0.2) 0%, transparent 100%),
                radial-gradient(1px 1px at 50% 90%, rgba(255,255,255,0.15) 0%, transparent 100%);
            opacity: 0.8;
            animation: twinkle 8s ease-in-out infinite;
        }

        [data-theme="forest"] .theme-bg .stars {
            opacity: 0;
        }

        /* ==================== Angel Theme ==================== */
        [data-theme="angel"] {
            /* Background layers - celestial gold and white */
            --bg-0: #1a1408;
            --bg-1: #241c0a;
            --bg-2: #2e250e;
            --bg-rgb: 26, 20, 8;

            /* Halo colors (divine radiance) */
            --halo-1: rgba(255, 215, 0, 0.18);    /* pure gold */
            --halo-2: rgba(255, 248, 220, 0.15);  /* celestial white */
            --halo-3: rgba(255, 223, 128, 0.12); /* warm gold */
            --halo-4: rgba(255, 255, 240, 0.10); /* ivory glow */
            --halo-5: rgba(218, 165, 32, 0.14);  /* goldenrod */

            /* Noise */
            --noise-opacity: 0.03;

            /* Surface (holy glass) */
            --surface-1: rgba(255, 248, 220, 0.08);
            --surface-2: rgba(255, 248, 220, 0.12);
            --surface-input: rgba(0, 0, 0, 0.25);

            /* Borders */
            --border-1: rgba(255, 215, 0, 0.15);
            --border-2: rgba(255, 215, 0, 0.25);
            --border-iridescent: linear-gradient(135deg,
                rgba(255, 215, 0, 0.35),
                rgba(255, 248, 220, 0.30),
                rgba(255, 255, 255, 0.25));

            /* Text (pure white with gold tint) */
            --text-1: rgba(255, 252, 240, 0.98);
            --text-2: rgba(255, 248, 220, 0.65);
            --text-3: rgba(255, 248, 220, 0.40);

            /* Primary (golden divine gradient) */
            --primary-1: #B8860B;
            --primary-2: #FFD700;
            --primary-3: #FFF8DC;
            --primary-gradient: linear-gradient(135deg, var(--primary-1) 0%, var(--primary-2) 50%, var(--primary-3) 100%);
            --primary-glow: rgba(255, 215, 0, 0.40);

            /* Focus */
            --focus: rgba(255, 215, 0, 0.6);

            /* Shadow */
            --shadow-1: 0 4px 24px rgba(0, 0, 0, 0.40);
            --shadow-2: 0 8px 40px rgba(0, 0, 0, 0.50);

            /* Accent colors */
            --success: #FFD700;
            --danger: #FF6B6B;
        }

        [data-theme="angel"] .theme-bg .stars {
            opacity: 0.3;
            background: radial-gradient(1px 1px at 10% 10%, rgba(255, 248, 220, 0.9), transparent),
                        radial-gradient(2px 2px at 40% 20%, rgba(255, 215, 0, 0.8), transparent),
                        radial-gradient(1px 1px at 70% 15%, rgba(255, 255, 255, 0.9), transparent),
                        radial-gradient(2px 2px at 90% 30%, rgba(255, 223, 128, 0.7), transparent),
                        radial-gradient(1px 1px at 25% 70%, rgba(255, 248, 220, 0.8), transparent),
                        radial-gradient(2px 2px at 60% 85%, rgba(255, 215, 0, 0.6), transparent);
        }

        [data-theme="angel"] .theme-bg .halo {
            filter: blur(100px);
        }

        /* ==================== Passion Theme ==================== */
        [data-theme="passion"] {
            /* Background layers - deep crimson and warm flesh */
            --bg-0: #1a0808;
            --bg-1: #240a0a;
            --bg-2: #2e0e0e;
            --bg-rgb: 26, 8, 8;

            /* Halo colors (sensual warmth) */
            --halo-1: rgba(220, 53, 69, 0.20);    /* crimson */
            --halo-2: rgba(255, 107, 107, 0.16); /* warm coral */
            --halo-3: rgba(255, 182, 193, 0.12); /* blush pink */
            --halo-4: rgba(199, 21, 133, 0.14);  /* deep magenta */
            --halo-5: rgba(255, 140, 105, 0.15); /* flesh tone */

            /* Noise */
            --noise-opacity: 0.04;

            /* Surface (warm velvet) */
            --surface-1: rgba(255, 182, 193, 0.07);
            --surface-2: rgba(255, 182, 193, 0.11);
            --surface-input: rgba(0, 0, 0, 0.28);

            /* Borders */
            --border-1: rgba(220, 53, 69, 0.18);
            --border-2: rgba(220, 53, 69, 0.28);
            --border-iridescent: linear-gradient(135deg,
                rgba(220, 53, 69, 0.40),
                rgba(255, 107, 107, 0.35),
                rgba(255, 182, 193, 0.30));

            /* Text (warm ivory) */
            --text-1: rgba(255, 250, 245, 0.96);
            --text-2: rgba(255, 220, 210, 0.62);
            --text-3: rgba(255, 200, 190, 0.38);

            /* Primary (passionate gradient) */
            --primary-1: #8B0000;
            --primary-2: #DC143C;
            --primary-3: #FF69B4;
            --primary-gradient: linear-gradient(135deg, var(--primary-1) 0%, var(--primary-2) 50%, var(--primary-3) 100%);
            --primary-glow: rgba(220, 53, 69, 0.45);

            /* Focus */
            --focus: rgba(220, 53, 69, 0.6);

            /* Shadow */
            --shadow-1: 0 4px 24px rgba(0, 0, 0, 0.45);
            --shadow-2: 0 8px 40px rgba(0, 0, 0, 0.55);

            /* Accent colors */
            --success: #FF69B4;
            --danger: #FF4500;
        }

        [data-theme="passion"] .theme-bg .stars {
            opacity: 0;
        }

        [data-theme="passion"] .theme-bg .halo {
            filter: blur(90px);
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.5; }
        }

        @keyframes float1 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(40px, 30px) scale(1.05); }
            50% { transform: translate(-30px, 50px) scale(0.95); }
            75% { transform: translate(20px, -20px) scale(1.02); }
        }

        @keyframes float2 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-50px, -30px) scale(1.03); }
            66% { transform: translate(30px, 40px) scale(0.97); }
        }

        @keyframes float3 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(-20px, -40px) scale(1.04); }
            50% { transform: translate(40px, 20px) scale(0.96); }
            75% { transform: translate(-30px, 30px) scale(1.01); }
        }

        @keyframes float4 {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            33% { transform: translate(calc(-50% + 30px), calc(-50% - 40px)) scale(1.06); }
            66% { transform: translate(calc(-50% - 40px), calc(-50% + 30px)) scale(0.94); }
        }

        @keyframes float5 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-35px, -25px) scale(1.03); }
        }

        /* ==================== Layout ==================== */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 380px 20px 0 20px;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* 登录页面不需要顶部空间 */
        .app-container.login-view {
            padding-top: 0;
        }

        /* ==================== Main Layout ==================== */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            padding-bottom: 100px;
            position: relative;
            z-index: 1;
        }

        @media (min-width: 768px) {
            .main-layout {
                grid-template-columns: 220px 1fr;
            }
        }

        @media (min-width: 1024px) {
            .main-layout {
                grid-template-columns: 260px minmax(0, 640px);
                justify-content: center;
            }
        }

        /* ==================== Sidebar ==================== */
        .sidebar {
            display: none;
        }

        @media (min-width: 768px) {
            .sidebar {
                display: block;
                position: sticky;
                top: 80px;
                height: fit-content;
                max-height: calc(100vh - 100px);
                overflow-y: auto;
            }
        }

        .sidebar-card {
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-card);
            overflow: hidden;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-1);
        }

        .sidebar-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-action {
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            border-radius: 6px;
            color: var(--text-3);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .sidebar-action:hover {
            background: var(--surface-2);
            color: var(--text-1);
        }

        .sidebar-action.spinning svg {
            animation: spin 1s linear infinite;
        }

        .sidebar-header-actions {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sidebar-collapse-icon {
            color: var(--text-3);
            transition: transform var(--duration-fast);
        }

        .sidebar-card.collapsed .sidebar-collapse-icon {
            transform: rotate(-90deg);
        }

        .sidebar-header {
            cursor: pointer;
            user-select: none;
        }

        .sidebar-header:hover {
            background: var(--surface-1);
        }

        .sidebar-collapsible {
            overflow: hidden;
            transition: max-height var(--duration-normal) var(--ease-out),
                        padding var(--duration-normal) var(--ease-out),
                        opacity var(--duration-fast);
        }

        .sidebar-card.collapsed .sidebar-collapsible {
            max-height: 0 !important;
            padding-top: 0;
            padding-bottom: 0;
            opacity: 0;
        }

        .sidebar-card.collapsed .sidebar-header {
            border-bottom-color: transparent;
        }

        /* ==================== Categories List ==================== */
        .categories-list {
            padding: 6px;
        }

        /* Limit height in sidebar to ensure Themes section is visible */
        .sidebar .sidebar-card:first-child .categories-list {
            max-height: 40vh;
            overflow-y: auto;
        }

        /* Limit categories height in mobile dropdown */
        .mobile-dropdown #mobileCategoriesList {
            max-height: 30vh;
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            border-radius: var(--radius-input);
            cursor: pointer;
            transition: all var(--duration-fast);
            margin-bottom: 2px;
        }

        .category-item:hover {
            background: var(--surface-2);
        }

        .category-item.active {
            background: var(--surface-2);
            border: 1px solid var(--border-2);
        }

        .category-name {
            font-size: 0.8125rem;
            color: var(--text-1);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-count {
            font-size: 0.7rem;
            color: var(--text-3);
            background: var(--surface-input);
            padding: 2px 6px;
            border-radius: 100px;
        }

        .category-parent {
            padding-left: 6px;
        }

        /* ==================== Mobile Category Bar ==================== */
        .mobile-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            position: relative;
        }

        @media (min-width: 768px) {
            .mobile-bar {
                display: none;
            }
        }

        .mobile-category-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 14px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-btn);
            font-family: inherit;
            font-size: 0.8125rem;
            color: var(--text-2);
            cursor: pointer;
            transition: all var(--duration-fast);
            flex: 1;
        }

        .mobile-category-btn:hover {
            background: var(--surface-2);
            color: var(--text-1);
        }

        .mobile-category-btn .current-cat {
            color: var(--text-1);
            font-weight: 500;
        }

        .mobile-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-2);
            max-height: 50vh;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all var(--duration-normal) var(--ease-out);
            z-index: 50;
            padding: 6px;
        }

        .mobile-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .mobile-section-label {
            padding: 8px 12px 4px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .mobile-add-theme {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface-2);
            border: 1px solid var(--border-1);
            border-radius: 4px;
            color: var(--text-2);
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
        }

        .mobile-add-theme:hover {
            background: var(--surface-1);
            color: var(--text-1);
        }

        .category-parent > .category-name {
            font-weight: 500;
        }

        .category-children {
            margin-left: 16px;
            margin-top: 4px;
        }

        .category-expand {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--text-3);
            cursor: pointer;
            transition: transform var(--duration-fast);
            margin-right: 4px;
        }

        .category-expand.collapsed {
            transform: rotate(-90deg);
        }

        .category-all {
            color: var(--text-2);
        }

        .category-uncategorized {
            color: var(--text-3);
            font-style: italic;
        }

        .category-badge {
            display: inline-block;
            padding: 2px 8px;
            background: var(--surface-2);
            border: 1px solid var(--border-1);
            border-radius: 100px;
            font-size: 0.7rem;
            color: var(--text-2);
            margin-left: 8px;
        }

        /* ==================== Navigation ==================== */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 16px 20px;
            background: transparent;
            transition: background 0.3s ease, backdrop-filter 0.3s ease;
        }

        /* 滚动时显示背景 */
        .nav.scrolled {
            background: rgba(var(--bg-rgb, 10, 10, 15), 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .nav-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-brand {
            display: flex;
            align-items: baseline;
            gap: 12px;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: 600;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
            transition: background var(--duration-slow);
        }

        .nav-tagline {
            font-size: 0.75rem;
            color: var(--text-3);
            display: none;
            transition: color var(--duration-normal);
        }

        @media (min-width: 480px) {
            .nav-tagline { display: block; }
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* ==================== Theme Dropdown ==================== */
        .theme-dropdown {
            position: relative;
        }

        .theme-current {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: 100px;
            font-family: inherit;
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .theme-current:hover {
            background: var(--surface-2);
            border-color: var(--border-2);
        }

        .theme-current-icon {
            font-size: 1.1rem;
            line-height: 1;
        }

        .theme-dropdown-arrow {
            color: var(--text-3);
            transition: transform var(--duration-fast);
        }

        .theme-dropdown.open .theme-dropdown-arrow {
            transform: rotate(180deg);
        }

        .theme-options {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            display: none;
            flex-direction: column;
            min-width: 140px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: 12px;
            padding: 6px;
            box-shadow: var(--shadow-2);
            z-index: 100;
        }

        .theme-dropdown.open .theme-options {
            display: flex;
            animation: dropdownFadeIn 0.15s ease-out;
        }

        @keyframes dropdownFadeIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .theme-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-2);
            cursor: pointer;
            transition: all var(--duration-fast);
            text-align: left;
        }

        .theme-option:hover {
            background: var(--surface-2);
            color: var(--text-1);
        }

        .theme-option.active {
            background: var(--surface-2);
            color: var(--text-1);
        }

        .theme-option .icon {
            font-size: 1rem;
            line-height: 1;
        }

        .theme-option .label {
            flex: 1;
        }

        /* ==================== User Menu ==================== */
        .nav-user {
            position: relative;
        }

        .user-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: 100px;
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
            font-family: inherit;
            font-size: 0.875rem;
            color: var(--text-1);
        }

        .user-button:hover {
            background: var(--surface-2);
            border-color: var(--border-2);
        }

        .user-avatar {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
        }

        .user-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 160px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-btn);
            box-shadow: var(--shadow-2);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px) scale(0.96);
            transition: all var(--duration-normal) var(--ease-out);
            overflow: hidden;
        }

        .user-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .dropdown-item {
            display: block;
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: none;
            text-align: left;
            font-family: inherit;
            font-size: 0.875rem;
            color: var(--text-1);
            cursor: pointer;
            transition: background var(--duration-fast);
        }

        .dropdown-item:hover {
            background: var(--surface-2);
        }

        /* ==================== Glass Card Base ==================== */
        .glass-card {
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-1);
            transition: all var(--duration-normal) var(--ease-out);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-iridescent);
            opacity: 0.6;
        }

        .glass-card:hover {
            background: var(--surface-2);
            border-color: var(--border-2);
            box-shadow: var(--shadow-2);
        }

        /* ==================== Auth Section ==================== */
        .auth-section {
            padding: 60px 0;
        }

        .auth-card {
            padding: 40px 32px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-1);
        }

        .auth-subtitle {
            font-size: 0.875rem;
            color: var(--text-2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-2);
            margin-bottom: 8px;
            transition: color var(--duration-normal);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--surface-input);
            border: 1px solid var(--border-1);
            border-radius: var(--radius-input);
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-1);
            transition: all var(--duration-normal) var(--ease-out);
        }

        .form-input:focus {
            outline: none;
            border-color: transparent;
            box-shadow: 0 0 0 2px var(--focus);
        }

        .form-input::placeholder {
            color: var(--text-3);
        }

        /* ==================== Buttons ==================== */
        .btn-primary {
            width: 100%;
            padding: 14px 24px;
            background: var(--primary-gradient);
            border: none;
            border-radius: var(--radius-btn);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            color: white;
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
            position: relative;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: rgba(255, 255, 255, 0);
            transition: background var(--duration-normal);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--primary-glow);
        }

        .btn-primary:hover::before {
            background: rgba(255, 255, 255, 0.12);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-save {
            padding: 12px 28px;
            width: auto;
        }

        .btn-save:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Auth switch */
        .auth-switch {
            text-align: center;
            margin-top: 24px;
            font-size: 0.875rem;
            color: var(--text-2);
        }

        .auth-switch-link {
            color: var(--text-1);
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            position: relative;
        }

        .auth-switch-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform var(--duration-normal) var(--ease-out);
        }

        .auth-switch-link:hover::after {
            transform: scaleX(1);
        }

        .auth-message {
            padding: 12px 16px;
            border-radius: var(--radius-input);
            margin-bottom: 20px;
            font-size: 0.875rem;
            text-align: center;
        }

        .auth-message.error {
            background: rgba(248, 113, 113, 0.15);
            color: var(--danger);
            border: 1px solid rgba(248, 113, 113, 0.25);
        }

        /* ==================== Notes Section ==================== */
        .notes-section {
            display: none;
        }

        .notes-section.active {
            display: block;
        }

        .main-content {
            min-width: 0;
        }

        /* Search Box */
        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-input);
            margin-bottom: 16px;
            transition: all var(--duration-fast);
        }

        .search-box:focus-within {
            border-color: var(--focus);
            box-shadow: 0 0 0 2px var(--focus);
        }

        .search-icon {
            color: var(--text-3);
            flex-shrink: 0;
        }

        .search-input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            font-family: inherit;
            font-size: 0.875rem;
            color: var(--text-1);
        }

        .search-input::placeholder {
            color: var(--text-3);
        }

        .search-clear {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: var(--surface-2);
            border: none;
            border-radius: 50%;
            color: var(--text-3);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .search-clear:hover {
            background: var(--surface-input);
            color: var(--text-1);
        }

        /* Bottom Composer - Chat style */
        .bottom-composer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 12px 20px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
            background: linear-gradient(to top, var(--bg-0) 60%, transparent);
            z-index: 90;
        }

        .bottom-composer-inner {
            max-width: 640px;
            margin: 0 auto;
            display: flex;
            gap: 12px;
            align-items: flex-end;
            padding: 10px 14px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: 22px;
            box-shadow: var(--shadow-2);
        }

        .bottom-composer .composer-textarea {
            flex: 1;
            min-height: 24px;
            max-height: 120px;
            padding: 8px 4px;
            background: transparent;
            border: none;
            border-radius: 0;
            font-family: inherit;
            font-size: 0.9375rem;
            line-height: 1.5;
            color: var(--text-1);
            resize: none;
        }

        .bottom-composer .composer-textarea:focus {
            outline: none;
            box-shadow: none;
        }

        .bottom-composer .btn-compose {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* 知知猫发送按钮图标切换 */
        .send-icon-cat {
            display: none;
            font-size: 20px;
        }

        .zhizhi-mode .send-icon-default {
            display: none;
        }

        .zhizhi-mode .send-icon-cat {
            display: inline;
        }

        /* ==================== 知知猫样式 ==================== */
        .zhizhi-cat {
            position: absolute;
            bottom: 100%;
            left: 20px;
            width: 40px;
            height: 32px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.3s ease;
            /* 默认走动动画 */
            animation: catWalk 8s ease-in-out infinite;
        }

        .zhizhi-cat:hover {
            transform: scale(1.1);
        }

        /* 猫身体容器 */
        .cat-body {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* 猫头 */
        .cat-head {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 22px;
            height: 18px;
            background: linear-gradient(135deg, #ffa94d 0%, #ff922b 100%);
            border-radius: 50% 50% 45% 45%;
            z-index: 3;
        }

        /* 猫耳朵 */
        .cat-ear {
            position: absolute;
            top: -6px;
            width: 10px;
            height: 12px;
            background: linear-gradient(135deg, #ffa94d 0%, #ff922b 100%);
            border-radius: 50% 50% 0 0;
            z-index: 2;
        }

        .cat-ear::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 6px;
            background: rgba(255, 200, 180, 0.8);
            border-radius: 50% 50% 0 0;
        }

        .cat-ear-left {
            left: 0;
            transform: rotate(-15deg);
        }

        .cat-ear-right {
            right: 0;
            transform: rotate(15deg);
        }

        /* 猫脸 */
        .cat-face {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* 猫眼睛 */
        .cat-eye {
            position: absolute;
            top: 6px;
            width: 6px;
            height: 6px;
            background: #fff;
            border-radius: 50%;
            overflow: hidden;
        }

        .cat-eye-left { left: 3px; }
        .cat-eye-right { right: 3px; }

        .cat-pupil {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 4px;
            background: #2d3436;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        /* 猫鼻子 */
        .cat-nose {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 3px;
            background: #e17055;
            border-radius: 50% 50% 40% 40%;
        }

        /* 猫嘴巴 */
        .cat-mouth {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 4px;
            border: none;
            border-bottom: 1.5px solid #636e72;
            border-radius: 0 0 50% 50%;
        }

        /* 猫胡须 */
        .cat-whiskers {
            position: absolute;
            top: 11px;
            width: 12px;
            height: 6px;
        }

        .cat-whiskers::before,
        .cat-whiskers::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 1px;
            background: rgba(100, 100, 100, 0.4);
        }

        .cat-whiskers::before { top: 0; }
        .cat-whiskers::after { top: 3px; }

        .cat-whiskers-left {
            left: -8px;
            transform: rotate(-5deg);
        }

        .cat-whiskers-right {
            right: -8px;
            transform: rotate(5deg);
        }

        /* 猫身体 */
        .cat-torso {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 12px;
            background: linear-gradient(135deg, #ffa94d 0%, #ff922b 100%);
            border-radius: 50% 50% 40% 40%;
            z-index: 1;
        }

        /* 猫尾巴 */
        .cat-tail {
            position: absolute;
            bottom: 2px;
            right: -8px;
            width: 16px;
            height: 6px;
            background: linear-gradient(90deg, #ff922b, #ffa94d);
            border-radius: 0 50% 50% 0;
            transform-origin: left center;
            animation: tailWag 1.5s ease-in-out infinite;
            z-index: 0;
        }

        /* 猫爪子 */
        .cat-paws {
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            display: flex;
            justify-content: space-between;
        }

        .cat-paw {
            width: 6px;
            height: 4px;
            background: #ffa94d;
            border-radius: 50%;
        }

        /* Zzz 打呼效果 */
        .cat-zzz {
            position: absolute;
            top: -8px;
            right: -5px;
            font-size: 8px;
            font-weight: bold;
            color: var(--text-3);
            opacity: 0;
            pointer-events: none;
        }

        .cat-zzz span {
            display: inline-block;
        }

        /* 走动动画 */
        @keyframes catWalk {
            0%, 100% {
                left: 20px;
                transform: scaleX(1);
            }
            45% {
                left: calc(100% - 60px);
                transform: scaleX(1);
            }
            50% {
                left: calc(100% - 60px);
                transform: scaleX(-1);
            }
            95% {
                left: 20px;
                transform: scaleX(-1);
            }
        }

        /* 尾巴摇摆 */
        @keyframes tailWag {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(15deg); }
        }

        /* ===== 睡觉状态 ===== */
        .zhizhi-cat.is-sleeping {
            animation: catSleepPosition 20s ease-in-out infinite;
        }

        .zhizhi-cat.is-sleeping .cat-body {
            transform: rotate(-10deg);
        }

        .zhizhi-cat.is-sleeping .cat-eye {
            height: 2px;
            top: 8px;
        }

        .zhizhi-cat.is-sleeping .cat-pupil {
            opacity: 0;
        }

        .zhizhi-cat.is-sleeping .cat-tail {
            animation: tailSleepWag 3s ease-in-out infinite;
        }

        .zhizhi-cat.is-sleeping .cat-zzz {
            opacity: 1;
            animation: zzzFloat 2s ease-in-out infinite;
        }

        .zhizhi-cat.is-sleeping .cat-zzz span:nth-child(1) {
            animation: zzzFloat 2s ease-in-out infinite 0.3s;
        }

        .zhizhi-cat.is-sleeping .cat-zzz span:nth-child(2) {
            animation: zzzFloat 2s ease-in-out infinite 0.6s;
        }

        @keyframes catSleepPosition {
            0%, 100% { left: 30%; }
            50% { left: 35%; }
        }

        @keyframes tailSleepWag {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes zzzFloat {
            0%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            50% {
                opacity: 1;
                transform: translateY(-4px);
            }
        }

        /* ===== 趴着打呼状态 ===== */
        .zhizhi-cat.is-lying {
            animation: catLyingPosition 25s ease-in-out infinite;
        }

        .zhizhi-cat.is-lying .cat-body {
            transform: scaleY(0.7) translateY(4px);
        }

        .zhizhi-cat.is-lying .cat-head {
            bottom: 4px;
        }

        .zhizhi-cat.is-lying .cat-eye {
            height: 2px;
            top: 8px;
        }

        .zhizhi-cat.is-lying .cat-pupil {
            opacity: 0;
        }

        .zhizhi-cat.is-lying .cat-torso {
            height: 8px;
            animation: breathe 2s ease-in-out infinite;
        }

        .zhizhi-cat.is-lying .cat-zzz {
            opacity: 1;
            animation: zzzFloat 2s ease-in-out infinite;
        }

        @keyframes catLyingPosition {
            0%, 100% { left: 50%; transform: translateX(-50%); }
        }

        @keyframes breathe {
            0%, 100% { transform: translateX(-50%) scaleY(1); }
            50% { transform: translateX(-50%) scaleY(1.15); }
        }

        /* ===== 倾听状态（鼠标靠近） ===== */
        .zhizhi-cat.is-listening {
            animation: none !important;
            left: 20px !important;
            transform: scale(1.05) scaleX(1) !important;
            transition: left 0.3s ease-out, transform 0.3s ease-out;
        }

        .zhizhi-cat.is-listening .cat-body {
            transform: none;
            animation: catPerk 0.3s ease-out forwards;
        }

        .zhizhi-cat.is-listening .cat-ear-left {
            animation: earPerkLeft 0.3s ease-out forwards;
        }

        .zhizhi-cat.is-listening .cat-ear-right {
            animation: earPerkRight 0.3s ease-out forwards;
        }

        .zhizhi-cat.is-listening .cat-eye {
            height: 8px !important;
            width: 7px;
        }

        .zhizhi-cat.is-listening .cat-pupil {
            opacity: 1 !important;
            width: 4px;
            height: 5px;
            animation: lookAround 2s ease-in-out infinite;
        }

        .zhizhi-cat.is-listening .cat-tail {
            animation: tailExcited 0.5s ease-in-out infinite;
        }

        .zhizhi-cat.is-listening .cat-zzz {
            opacity: 0 !important;
        }

        @keyframes catPerk {
            0% { transform: rotate(-10deg) scaleY(0.7); }
            100% { transform: rotate(0deg) scaleY(1); }
        }

        @keyframes earPerkLeft {
            0% { transform: rotate(-15deg); }
            50% { transform: rotate(-25deg); }
            100% { transform: rotate(-20deg); }
        }

        @keyframes earPerkRight {
            0% { transform: rotate(15deg); }
            50% { transform: rotate(25deg); }
            100% { transform: rotate(20deg); }
        }

        @keyframes lookAround {
            0%, 100% { transform: translate(-50%, -50%); }
            25% { transform: translate(-30%, -50%); }
            75% { transform: translate(-70%, -50%); }
        }

        @keyframes tailExcited {
            0%, 100% { transform: rotate(-15deg); }
            50% { transform: rotate(20deg); }
        }

        /* ===== 激活状态（知知模式） ===== */
        .zhizhi-cat.is-active {
            animation: none !important;
            left: 20px !important;
            transform: scale(1.1) scaleX(1) !important;
            filter: drop-shadow(0 0 8px rgba(255, 169, 77, 0.6));
        }

        .zhizhi-cat.is-active .cat-body {
            animation: catBounce 0.6s ease-in-out infinite;
        }

        .zhizhi-cat.is-active .cat-eye {
            height: 8px !important;
            width: 7px;
        }

        .zhizhi-cat.is-active .cat-pupil {
            opacity: 1 !important;
            background: #e17055;
            width: 4px;
            height: 5px;
        }

        .zhizhi-cat.is-active .cat-mouth {
            border-bottom-color: #e17055;
            height: 5px;
        }

        .zhizhi-cat.is-active .cat-tail {
            animation: tailHappy 0.4s ease-in-out infinite;
        }

        @keyframes catBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        @keyframes tailHappy {
            0%, 100% { transform: rotate(-20deg); }
            50% { transform: rotate(25deg); }
        }

        /* 知知模式输入框样式 */
        .zhizhi-mode .composer-textarea::placeholder {
            color: #ffa94d;
        }

        .zhizhi-mode .bottom-composer-inner {
            border-color: rgba(255, 169, 77, 0.4);
            box-shadow: 0 0 20px rgba(255, 169, 77, 0.15), var(--shadow-2);
        }

        /* Adjust notes list padding for bottom composer */
        .notes-list {
            padding-bottom: 100px;
        }

        /* Hide old composer (if any) */
        .composer {
            display: none;
        }

        .composer-inner {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .composer-textarea {
            flex: 1;
            min-height: 44px;
            max-height: 200px;
            padding: 10px 14px;
            background: var(--surface-input);
            border: 1px solid var(--border-1);
            border-radius: var(--radius-input);
            font-family: inherit;
            font-size: 0.9375rem;
            line-height: 1.5;
            color: var(--text-1);
            resize: none;
            transition: all var(--duration-normal) var(--ease-out);
        }

        .composer-textarea:focus {
            outline: none;
            border-color: transparent;
            box-shadow: 0 0 0 2px var(--focus);
        }

        .composer-textarea::placeholder {
            color: var(--text-3);
        }

        .btn-compose {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            background: var(--primary-gradient);
            border: none;
            border-radius: var(--radius-input);
            cursor: pointer;
            transition: all var(--duration-fast);
            flex-shrink: 0;
        }

        .btn-compose:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 16px var(--primary-glow);
        }

        .btn-compose:active {
            transform: scale(0.98);
        }

        .btn-compose:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn-compose svg {
            color: white;
        }

        /* Notes List */
        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 0 4px;
        }

        .notes-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .notes-count {
            font-size: 0.75rem;
            color: var(--text-3);
        }

        .notes-header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* View Mode Toggle */
        .view-mode-toggle {
            display: flex;
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: 8px;
            padding: 2px;
        }

        .view-mode-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 28px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: var(--text-3);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .view-mode-btn:hover {
            color: var(--text-2);
            background: var(--surface-2);
        }

        .view-mode-btn.active {
            color: var(--text-1);
            background: var(--primary-gradient);
        }

        /* ==================== Timeline View ==================== */
        .notes-list.timeline-mode {
            position: relative;
            padding-left: 40px;
        }

        .notes-list.timeline-mode::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg,
                var(--primary-2) 0%,
                var(--border-1) 20%,
                var(--border-1) 80%,
                transparent 100%);
        }

        .timeline-date-group {
            margin-bottom: 24px;
            animation: timelineFadeIn 0.4s ease-out forwards;
            opacity: 0;
            transform: translateX(-10px);
        }

        @keyframes timelineFadeIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .timeline-date-header {
            position: relative;
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            margin-left: -40px;
        }

        .timeline-date-dot {
            width: 12px;
            height: 12px;
            background: var(--primary-gradient);
            border-radius: 50%;
            margin-right: 16px;
            margin-left: 9px;
            box-shadow: 0 0 12px var(--primary-glow);
            flex-shrink: 0;
        }

        .timeline-date-text {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-1);
            background: var(--surface-1);
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid var(--border-1);
        }

        .timeline-notes {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .timeline-note-wrapper {
            position: relative;
            animation: timelineNoteIn 0.3s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes timelineNoteIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .timeline-note-wrapper::before {
            content: '';
            position: absolute;
            left: -32px;
            top: 16px;
            width: 20px;
            height: 2px;
            background: var(--border-1);
        }

        .timeline-note-wrapper::after {
            content: '';
            position: absolute;
            left: -40px;
            top: 12px;
            width: 8px;
            height: 8px;
            background: var(--surface-2);
            border: 2px solid var(--border-2);
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .timeline-note-wrapper:hover::after {
            background: var(--primary-2);
            border-color: var(--primary-2);
            box-shadow: 0 0 8px var(--primary-glow);
            transform: scale(1.2);
        }

        .timeline-note {
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: var(--radius-card);
            padding: 14px 16px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .timeline-note:hover {
            border-color: var(--border-2);
            transform: translateX(4px);
            box-shadow: var(--shadow-1);
        }

        .timeline-note:active {
            transform: translateX(2px) scale(0.99);
            transition: transform 0.1s ease;
        }

        .timeline-note-time {
            font-size: 0.7rem;
            color: var(--primary-2);
            font-weight: 500;
            margin-bottom: 6px;
        }

        .timeline-note-content {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-1);
            white-space: pre-wrap;
            word-break: break-word;
        }

        .timeline-note-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-1);
        }

        /* Quick date navigation */
        .timeline-quick-nav {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 4px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .notes-list.timeline-mode ~ .timeline-quick-nav,
        .timeline-quick-nav.visible {
            opacity: 1;
            visibility: visible;
        }

        .timeline-nav-dot {
            width: 8px;
            height: 8px;
            background: var(--surface-2);
            border: 1px solid var(--border-1);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .timeline-nav-dot:hover,
        .timeline-nav-dot.active {
            background: var(--primary-2);
            border-color: var(--primary-2);
            transform: scale(1.5);
        }

        .timeline-nav-dot[data-label]::after {
            content: attr(data-label);
            position: absolute;
            right: 16px;
            font-size: 0.7rem;
            color: var(--text-2);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .timeline-nav-dot:hover[data-label]::after {
            opacity: 1;
        }

        /* Timeline action buttons */
        .timeline-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: var(--text-3);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .timeline-action-btn:hover {
            background: var(--surface-2);
            color: var(--text-1);
        }

        .timeline-action-btn.danger:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        /* Timeline mobile adjustments */
        @media (max-width: 640px) {
            .notes-list.timeline-mode {
                padding-left: 30px;
            }

            .notes-list.timeline-mode::before {
                left: 10px;
            }

            .timeline-date-header {
                margin-left: -30px;
            }

            .timeline-date-dot {
                margin-left: 4px;
                margin-right: 12px;
            }

            .timeline-note-wrapper::before {
                left: -22px;
                width: 12px;
            }

            .timeline-note-wrapper::after {
                left: -30px;
                width: 6px;
                height: 6px;
            }

            .timeline-note {
                padding: 12px 14px;
            }

            .timeline-note-content {
                font-size: 0.85rem;
            }

            .view-mode-toggle {
                display: flex;
            }
        }

        /* More menu button */
        .btn-more {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: none;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-3);
            transition: all var(--duration-fast);
        }

        .btn-more:hover {
            background: var(--surface-2);
            color: var(--text-1);
        }

        .more-menu {
            position: relative;
        }

        .more-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            right: 0;
            min-width: 160px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-btn);
            box-shadow: var(--shadow-2);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-4px);
            transition: all var(--duration-fast) var(--ease-out);
            overflow: hidden;
            z-index: 10;
        }

        .more-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .more-item {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 10px 14px;
            border: none;
            background: none;
            text-align: left;
            font-family: inherit;
            font-size: 0.8125rem;
            color: var(--text-1);
            cursor: pointer;
            transition: background var(--duration-fast);
        }

        .more-item:hover {
            background: var(--surface-2);
        }

        .more-item svg {
            width: 16px;
            height: 16px;
            color: var(--text-3);
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Note Card */
        .note-card {
            padding: 20px;
            cursor: default;
            position: relative;
            overflow: visible;
        }

        .note-card:hover {
            transform: translateY(-2px);
        }

        /* ==================== 快记悬停粒子效果 ==================== */
        .note-particles {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: visible;
            z-index: 10;
        }

        .note-particle {
            position: absolute;
            pointer-events: none;
            animation-fill-mode: forwards;
        }

        /* Galaxy主题 - 星尘粒子 */
        [data-theme="galaxy"] .note-particle {
            width: 3px;
            height: 3px;
            background: radial-gradient(circle, rgba(150, 200, 255, 1) 0%, rgba(100, 150, 255, 0.6) 50%, transparent 100%);
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(100, 180, 255, 0.8), 0 0 12px rgba(138, 43, 226, 0.4);
            animation: galaxyParticleFloat 2s ease-out forwards;
        }

        [data-theme="galaxy"] .note-particle::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(150, 200, 255, 0.6), transparent);
            transform: translate(-50%, -50%);
        }

        @keyframes galaxyParticleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) translateX(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) translateX(var(--drift-x, 10px)) scale(0.3);
            }
        }

        /* Forest主题 - 萤火虫/花瓣 */
        [data-theme="forest"] .note-particle {
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(180, 255, 150, 1) 0%, rgba(120, 220, 100, 0.7) 40%, transparent 100%);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(150, 255, 100, 0.9), 0 0 16px rgba(100, 200, 80, 0.5);
            animation: forestParticleFloat 2.5s ease-out forwards;
        }

        [data-theme="forest"] .note-particle.is-petal {
            width: 6px;
            height: 10px;
            background: linear-gradient(135deg, rgba(200, 255, 180, 0.8) 0%, rgba(150, 230, 130, 0.5) 100%);
            border-radius: 50% 0 50% 0;
            box-shadow: none;
            animation: forestPetalFloat 3s ease-out forwards;
        }

        @keyframes forestParticleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) translateX(0) scale(1);
            }
            50% {
                opacity: 0.9;
            }
            100% {
                opacity: 0;
                transform: translateY(-50px) translateX(var(--drift-x, 15px)) scale(0.5);
            }
        }

        @keyframes forestPetalFloat {
            0% {
                opacity: 0.9;
                transform: translateY(0) translateX(0) rotate(0deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-70px) translateX(var(--drift-x, 20px)) rotate(180deg) scale(0.6);
            }
        }

        /* Angel主题 - 羽毛/圣光粒子 */
        [data-theme="angel"] .note-particle {
            width: 3px;
            height: 3px;
            background: radial-gradient(circle, rgba(255, 255, 255, 1) 0%, rgba(255, 240, 200, 0.8) 40%, transparent 100%);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 250, 220, 0.9), 0 0 20px rgba(255, 220, 150, 0.5);
            animation: angelParticleFloat 2s ease-out forwards;
        }

        [data-theme="angel"] .note-particle.is-feather {
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.95) 0%, rgba(255, 250, 240, 0.7) 50%, rgba(255, 245, 230, 0.3) 100%);
            border-radius: 50% 50% 20% 20%;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
            animation: angelFeatherFloat 3s ease-out forwards;
        }

        @keyframes angelParticleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-55px) translateX(var(--drift-x, 5px)) scale(0.4);
            }
        }

        @keyframes angelFeatherFloat {
            0% {
                opacity: 0.9;
                transform: translateY(0) translateX(0) rotate(-10deg) scale(1);
            }
            50% {
                transform: translateY(-30px) translateX(10px) rotate(10deg) scale(0.9);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) translateX(var(--drift-x, -5px)) rotate(-20deg) scale(0.5);
            }
        }

        /* Passion主题 - 火焰羽毛 */
        [data-theme="passion"] .note-particle {
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(255, 200, 100, 1) 0%, rgba(255, 150, 50, 0.8) 40%, transparent 100%);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255, 180, 80, 0.9), 0 0 16px rgba(255, 100, 50, 0.5);
            animation: passionSparkFloat 1.8s ease-out forwards;
        }

        [data-theme="passion"] .note-particle.is-flame-feather {
            width: 10px;
            height: 24px;
            background: linear-gradient(to top,
                rgba(255, 100, 0, 0.9) 0%,
                rgba(255, 150, 50, 0.8) 30%,
                rgba(255, 200, 100, 0.6) 60%,
                rgba(255, 220, 150, 0.3) 100%);
            border-radius: 50% 50% 20% 20%;
            box-shadow:
                0 0 10px rgba(255, 150, 50, 0.8),
                0 0 20px rgba(255, 100, 0, 0.5),
                inset 0 -5px 10px rgba(255, 50, 0, 0.3);
            animation: passionFeatherFloat 2.5s ease-out forwards;
        }

        [data-theme="passion"] .note-particle.is-flame-feather::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 8px;
            background: radial-gradient(ellipse at bottom, rgba(255, 255, 200, 0.9) 0%, transparent 70%);
        }

        @keyframes passionSparkFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-45px) translateX(var(--drift-x, 8px)) scale(0.2);
            }
        }

        @keyframes passionFeatherFloat {
            0% {
                opacity: 0.95;
                transform: translateY(0) translateX(0) rotate(0deg) scale(1);
                filter: brightness(1);
            }
            30% {
                opacity: 0.9;
                filter: brightness(1.2);
            }
            60% {
                opacity: 0.6;
                filter: brightness(1.1);
            }
            100% {
                opacity: 0;
                transform: translateY(-90px) translateX(var(--drift-x, 10px)) rotate(15deg) scale(0.4);
                filter: brightness(0.8);
            }
        }

        .note-content {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-1);
            white-space: pre-wrap;
            word-break: break-word;
            margin-bottom: 12px;
        }

        .note-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .note-time {
            font-size: 0.75rem;
            color: var(--text-3);
        }

        .note-actions-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cat-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, rgba(255, 180, 100, 0.15), rgba(255, 140, 66, 0.1));
            border: 1px solid rgba(255, 180, 100, 0.3);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cat-indicator:hover {
            background: linear-gradient(135deg, rgba(255, 180, 100, 0.25), rgba(255, 140, 66, 0.2));
            border-color: rgba(255, 180, 100, 0.5);
            transform: scale(1.1);
        }

        .cat-indicator-emoji {
            font-size: 14px;
        }

        .note-menu {
            position: relative;
        }

        .note-menu-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-3);
            transition: all var(--duration-fast);
        }

        .note-menu-btn:hover {
            background: var(--surface-2);
            color: var(--text-2);
        }

        .note-menu-dropdown {
            position: absolute;
            bottom: calc(100% + 4px);
            right: 0;
            min-width: 140px;
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-input);
            box-shadow: var(--shadow-2);
            opacity: 0;
            visibility: hidden;
            transform: translateY(4px);
            transition: all var(--duration-fast) var(--ease-out);
            overflow: hidden;
            z-index: 10;
        }

        .note-menu-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 10px 14px;
            border: none;
            background: none;
            text-align: left;
            font-family: inherit;
            font-size: 0.875rem;
            color: var(--text-1);
            cursor: pointer;
            transition: background var(--duration-fast);
        }

        .menu-item:hover {
            background: var(--surface-2);
        }

        .menu-item.danger {
            color: var(--danger);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            background: var(--surface-2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--text-3);
        }

        .empty-text {
            color: var(--text-2);
            font-size: 0.9375rem;
        }

        /* ==================== Toast ==================== */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-btn);
            padding: 14px 20px;
            box-shadow: var(--shadow-2);
            font-size: 0.875rem;
            color: var(--text-1);
            animation: slideIn var(--duration-normal) var(--ease-out);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.success::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
        }

        .toast.exit {
            animation: slideOut var(--duration-normal) var(--ease-out) forwards;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* ==================== Dialog ==================== */
        .dialog-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-normal) var(--ease-out);
            padding: 20px;
        }

        .dialog-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .dialog {
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            -webkit-backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-card);
            padding: 28px;
            max-width: 360px;
            width: 100%;
            box-shadow: var(--shadow-2);
            transform: scale(0.95);
            transition: transform var(--duration-normal) var(--ease-out);
        }

        .dialog-overlay.active .dialog {
            transform: scale(1);
        }

        .dialog-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-1);
        }

        .dialog-message {
            font-size: 0.9375rem;
            color: var(--text-2);
            margin-bottom: 24px;
        }

        .dialog-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn-cancel {
            padding: 10px 20px;
            background: var(--surface-2);
            border: 1px solid var(--border-1);
            border-radius: var(--radius-btn);
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--text-2);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .btn-cancel:hover {
            background: var(--surface-1);
            border-color: var(--border-2);
        }

        .btn-danger {
            padding: 10px 20px;
            background: var(--danger);
            border: none;
            border-radius: var(--radius-btn);
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 500;
            color: white;
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .btn-danger:hover {
            filter: brightness(1.1);
        }

        /* ==================== Floating Action Button (FAB) ==================== */
        .fab {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 20px var(--primary-glow);
            transition: all var(--duration-normal) var(--ease-out);
        }

        .fab:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 32px var(--primary-glow);
        }

        .fab:active {
            transform: scale(0.95);
        }

        .fab .starlight-icon {
            font-size: 1.5rem;
            color: white;
            animation: twinkle 2s ease-in-out infinite;
        }

        .fab-tooltip {
            position: absolute;
            right: calc(100% + 12px);
            top: 50%;
            transform: translateY(-50%);
            background: var(--surface-1);
            backdrop-filter: blur(var(--blur-1));
            border: 1px solid var(--border-1);
            border-radius: var(--radius-btn);
            padding: 8px 12px;
            font-size: 0.8125rem;
            color: var(--text-1);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-fast);
            pointer-events: none;
        }

        .fab:hover .fab-tooltip {
            opacity: 1;
            visibility: visible;
        }

        @media (max-width: 480px) {
            .fab-group {
                bottom: 16px;
                right: 16px;
            }
            .fab {
                width: 52px;
                height: 52px;
            }
            .fab .starlight-icon,
            .fab .insights-icon {
                font-size: 1.3rem;
            }
        }

        .starlight-dialog {
            padding: 0;
            overflow: hidden;
            position: relative;
            background: linear-gradient(180deg, var(--bg-1) 0%, var(--bg-0) 100%);
        }

        /* 星光对话框梦幻背景 */
        .starlight-dialog::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse 100% 60% at 50% 0%, rgba(255, 200, 100, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse 80% 40% at 20% 80%, rgba(255, 180, 50, 0.06) 0%, transparent 40%),
                radial-gradient(ellipse 60% 40% at 80% 60%, rgba(255, 220, 100, 0.05) 0%, transparent 40%);
            pointer-events: none;
            animation: starlightGlow 8s ease-in-out infinite;
        }

        @keyframes starlightGlow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* 星光粒子 */
        .starlight-dialog::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(1.5px 1.5px at 30px 40px, rgba(255, 220, 150, 0.6), transparent),
                radial-gradient(1px 1px at 80px 100px, rgba(255, 200, 100, 0.5), transparent),
                radial-gradient(1.5px 1.5px at 150px 60px, rgba(255, 230, 180, 0.6), transparent),
                radial-gradient(1px 1px at 200px 150px, rgba(255, 210, 120, 0.5), transparent),
                radial-gradient(1px 1px at 280px 80px, rgba(255, 240, 200, 0.4), transparent),
                radial-gradient(1.5px 1.5px at 320px 180px, rgba(255, 200, 100, 0.5), transparent);
            background-size: 400px 250px;
            pointer-events: none;
            animation: starlightParticles 4s ease-in-out infinite;
            opacity: 0.8;
        }

        @keyframes starlightParticles {
            0%, 100% { opacity: 0.6; transform: translateY(0); }
            50% { opacity: 0.9; transform: translateY(-5px); }
        }

        .starlight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 200, 100, 0.15);
            position: relative;
            z-index: 1;
            background: linear-gradient(180deg, rgba(255, 220, 150, 0.05) 0%, transparent 100%);
        }

        .starlight-badge {
            font-size: 0.875rem;
            font-weight: 600;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(255, 200, 100, 0.3);
        }

        .starlight-close {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            border-radius: 6px;
            font-size: 1.25rem;
            color: var(--text-3);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .starlight-close:hover {
            background: rgba(255, 200, 100, 0.1);
            color: rgba(255, 220, 150, 0.9);
        }

        .starlight-content {
            padding: 24px;
            position: relative;
            z-index: 1;
        }

        .starlight-note {
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 220, 150, 0.05) 0%, rgba(255, 180, 100, 0.02) 100%);
            border: 1px solid rgba(255, 200, 100, 0.1);
            border-radius: 16px;
            position: relative;
        }

        .starlight-note::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 3rem;
            color: rgba(255, 200, 100, 0.15);
            font-family: Georgia, serif;
            line-height: 1;
        }

        .starlight-note-text {
            font-size: 1.0625rem;
            line-height: 1.8;
            color: var(--text-1);
            white-space: pre-wrap;
            word-break: break-word;
            padding-left: 20px;
        }

        .starlight-note-time {
            display: block;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 200, 100, 0.1);
            font-size: 0.75rem;
            color: rgba(255, 200, 100, 0.6);
        }

        .starlight-insight {
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 200, 100, 0.08) 0%, rgba(255, 150, 50, 0.04) 100%);
            border: 1px solid rgba(255, 200, 100, 0.2);
            border-radius: 16px;
            font-size: 0.9375rem;
            line-height: 1.7;
            color: var(--text-2);
            font-style: italic;
            position: relative;
            overflow: hidden;
        }

        .starlight-insight::before {
            content: '✨';
            position: absolute;
            top: -5px;
            right: 10px;
            font-size: 2rem;
            opacity: 0.3;
        }

        .starlight-report {
            font-size: 0.9375rem;
            line-height: 1.8;
            color: var(--text-1);
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 8px;
        }

        .starlight-report::-webkit-scrollbar {
            width: 4px;
        }

        .starlight-report::-webkit-scrollbar-track {
            background: transparent;
        }

        .starlight-report::-webkit-scrollbar-thumb {
            background: var(--border-1);
            border-radius: 2px;
        }

        /* Color buttons for theme picker */
        .color-btn {
            width: 32px;
            height: 32px;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.selected {
            border-color: var(--text-1);
            box-shadow: 0 0 0 2px var(--bg-0);
        }

        /* Themes select list */
        .themes-select-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 16px;
        }

        .theme-select-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-input);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .theme-select-item:hover {
            background: var(--surface-2);
        }

        .theme-color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .theme-select-name {
            flex: 1;
            font-size: 0.875rem;
            color: var(--text-1);
        }

        /* Theme item in sidebar */
        .theme-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        [data-theme="forest"] .starlight-insight {
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.08), rgba(167, 243, 208, 0.06));
            border-color: rgba(52, 211, 153, 0.2);
        }

        [data-theme="angel"] .starlight-insight {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.08), rgba(255, 248, 220, 0.06));
            border-color: rgba(255, 215, 0, 0.25);
        }

        [data-theme="passion"] .starlight-insight {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.08), rgba(255, 107, 107, 0.06));
            border-color: rgba(220, 53, 69, 0.25);
        }

        .starlight-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-2);
        }

        .starlight-actions {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .btn-starlight-again {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 20px;
            background: var(--surface-2);
            border: 1px solid var(--border-1);
            border-radius: var(--radius-btn);
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-2);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .btn-starlight-again:hover {
            background: var(--surface-1);
            border-color: var(--border-2);
            color: var(--text-1);
        }

        .starlight-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-1);
        }

        .starlight-time {
            font-size: 0.8rem;
            color: var(--text-3);
        }

        .btn-starlight-refresh {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--surface-2);
            border: 1px solid var(--border-1);
            border-radius: var(--radius-btn);
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-2);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .btn-starlight-refresh:hover {
            background: var(--surface-1);
            border-color: var(--border-2);
            color: var(--text-1);
        }

        .btn-starlight-refresh span {
            font-size: 1rem;
        }

        /* ==================== FAB Group ==================== */
        .fab-group {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .fab-insights {
            background: linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%);
        }

        .fab-insights:hover {
            background: linear-gradient(135deg, #7C3AED 0%, #4F46E5 100%);
        }

        .insights-icon {
            font-size: 1.4rem;
        }

        /* ==================== Insights Full Page ==================== */
        .insights-page {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: var(--bg-0);
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .insights-page.active {
            transform: translateX(0);
        }

        /* 洞见页面梦幻背景 */
        .insights-page::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 50% at 20% 20%, rgba(0, 150, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 30%, rgba(100, 200, 255, 0.06) 0%, transparent 45%),
                radial-gradient(ellipse 70% 50% at 50% 80%, rgba(0, 100, 200, 0.05) 0%, transparent 50%);
            pointer-events: none;
            animation: insightsAuroraDrift 30s ease-in-out infinite;
        }

        @keyframes insightsAuroraDrift {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* 洞见页面浮动粒子 */
        .insights-page::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                radial-gradient(1px 1px at 100px 100px, rgba(100, 200, 255, 0.4), transparent),
                radial-gradient(1px 1px at 300px 200px, rgba(150, 220, 255, 0.3), transparent),
                radial-gradient(1.5px 1.5px at 500px 150px, rgba(100, 180, 255, 0.5), transparent),
                radial-gradient(1px 1px at 200px 350px, rgba(120, 200, 255, 0.4), transparent),
                radial-gradient(1px 1px at 700px 100px, rgba(80, 180, 255, 0.3), transparent),
                radial-gradient(1.5px 1.5px at 400px 400px, rgba(100, 220, 255, 0.4), transparent),
                radial-gradient(1px 1px at 600px 300px, rgba(150, 200, 255, 0.3), transparent);
            background-size: 800px 500px;
            pointer-events: none;
            animation: insightsParticlesFloat 60s linear infinite;
            opacity: 0.6;
        }

        @keyframes insightsParticlesFloat {
            from { transform: translateY(0); }
            to { transform: translateY(-500px); }
        }

        .insights-header {
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: linear-gradient(180deg, rgba(var(--bg-0-rgb), 0.95) 0%, rgba(var(--bg-0-rgb), 0.85) 100%);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(0, 180, 255, 0.1);
        }

        .insights-back, .insights-refresh {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            border-radius: 10px;
            color: var(--text-2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .insights-back:hover, .insights-refresh:hover {
            background: var(--surface-1);
            color: var(--text-1);
        }

        .insights-refresh.spinning svg {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .insights-title {
            font-size: 1.25rem;
            font-weight: 600;
            background: linear-gradient(135deg, #00d4ff, #7dd3fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .insights-content {
            padding: 20px;
            padding-bottom: 100px;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Loading State */
        .insights-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .insights-loading-icon {
            margin-bottom: 24px;
        }

        .loading-emoji {
            font-size: 4rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .insights-loading-text {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--text-1);
            margin-bottom: 8px;
        }

        .insights-loading-sub {
            font-size: 0.875rem;
            color: var(--text-3);
        }

        /* Error State */
        .insights-error {
            text-align: center;
            padding: 40px 20px;
        }

        .insights-error-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .insights-error-text {
            font-size: 1rem;
            color: var(--text-2);
            line-height: 1.6;
        }

        /* ==================== MBTI Card ==================== */
        .insight-section {
            margin-bottom: 32px;
            animation: insightFadeIn 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes insightFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .insight-section:nth-child(1) { animation-delay: 0.1s; }
        .insight-section:nth-child(2) { animation-delay: 0.2s; }
        .insight-section:nth-child(3) { animation-delay: 0.3s; }
        .insight-section:nth-child(4) { animation-delay: 0.4s; }
        .insight-section:nth-child(5) { animation-delay: 0.5s; }

        .section-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .mbti-card {
            background: linear-gradient(135deg, rgba(0, 150, 255, 0.1) 0%, rgba(100, 200, 255, 0.05) 100%);
            border: 1px solid rgba(0, 180, 255, 0.2);
            border-radius: 24px;
            padding: 32px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mbti-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg at 50% 50%,
                transparent 0deg,
                rgba(0, 200, 255, 0.05) 60deg,
                transparent 120deg,
                rgba(100, 200, 255, 0.03) 180deg,
                transparent 240deg,
                rgba(0, 150, 255, 0.05) 300deg,
                transparent 360deg);
            animation: mbtiCardRotate 30s linear infinite;
            pointer-events: none;
        }

        @keyframes mbtiCardRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .mbti-type-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .mbti-type {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-1);
            letter-spacing: 0.1em;
        }

        .mbti-emoji {
            font-size: 2rem;
        }

        .mbti-name {
            font-size: 1.125rem;
            color: var(--primary-2);
            margin-bottom: 20px;
        }

        .mbti-description {
            font-size: 0.9375rem;
            line-height: 1.8;
            color: var(--text-2);
            margin-bottom: 20px;
            text-align: left;
        }

        .mbti-traits {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .mbti-trait {
            padding: 6px 14px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 20px;
            font-size: 0.8125rem;
            color: var(--primary-2);
            font-weight: 500;
        }

        /* Dimension Bars */
        .mbti-dimensions {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 20px;
        }

        .dimension-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dimension-label {
            font-size: 0.75rem;
            color: var(--text-3);
            width: 40px;
            text-align: right;
            flex-shrink: 0;
        }

        .dimension-bar {
            flex: 1;
            height: 8px;
            background: var(--surface-2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .dimension-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-2), var(--primary-1));
            border-radius: 4px;
            transition: width 1s ease-out;
        }

        .dimension-label-right {
            font-size: 0.75rem;
            color: var(--text-3);
            width: 40px;
            flex-shrink: 0;
        }

        /* Evidence quotes */
        .mbti-evidences {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid rgba(139, 92, 246, 0.2);
        }

        .evidence-label {
            font-size: 0.75rem;
            color: var(--text-3);
            margin-bottom: 12px;
        }

        .evidence-item {
            font-size: 0.875rem;
            color: var(--text-2);
            font-style: italic;
            padding: 10px 14px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary-2);
        }

        /* ==================== Emotions Card ==================== */
        .emotions-card {
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: 20px;
            padding: 24px;
        }

        .emotions-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .emotions-dominant-emoji {
            font-size: 2rem;
        }

        .emotions-dominant-text {
            flex: 1;
        }

        .emotions-dominant-label {
            font-size: 0.75rem;
            color: var(--text-3);
        }

        .emotions-dominant-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-1);
        }

        /* Emotion Ring Chart */
        .emotions-ring-container {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 20px;
        }

        .emotions-ring {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            position: relative;
            flex-shrink: 0;
        }

        .emotions-ring-center {
            position: absolute;
            inset: 15px;
            background: var(--surface-1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .emotions-legend {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .emotion-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .emotion-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .emotion-name {
            font-size: 0.8125rem;
            color: var(--text-2);
            flex: 1;
        }

        .emotion-percent {
            font-size: 0.8125rem;
            color: var(--text-3);
            font-weight: 500;
        }

        .emotions-trend {
            font-size: 0.9375rem;
            color: var(--text-2);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .emotions-insight {
            font-size: 0.9375rem;
            color: var(--text-1);
            line-height: 1.7;
            padding: 16px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(52, 211, 153, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
        }

        /* ==================== Keywords Cloud ==================== */
        .keywords-card {
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: 20px;
            padding: 24px;
        }

        .keywords-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            min-height: 120px;
        }

        .keyword-tag {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
            animation: keywordFloat 0.6s ease-out forwards;
            opacity: 0;
            transform: scale(0.8);
        }

        @keyframes keywordFloat {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .keyword-tag:hover {
            transform: scale(1.1);
        }

        .keyword-size-5 { font-size: 1.25rem; }
        .keyword-size-4 { font-size: 1.0625rem; }
        .keyword-size-3 { font-size: 0.9375rem; }
        .keyword-size-2 { font-size: 0.8125rem; }
        .keyword-size-1 { font-size: 0.75rem; }

        .keyword-positive {
            background: rgba(16, 185, 129, 0.15);
            color: #34D399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .keyword-neutral {
            background: rgba(107, 114, 128, 0.15);
            color: var(--text-2);
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        .keyword-reflective {
            background: rgba(139, 92, 246, 0.15);
            color: #A78BFA;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .keyword-concern {
            background: rgba(245, 158, 11, 0.15);
            color: #FBBF24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* ==================== Personal Note ==================== */
        .personal-note-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.25);
            border-radius: 20px;
            padding: 28px;
            position: relative;
            overflow: hidden;
        }

        .personal-note-card::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 4rem;
            color: rgba(251, 191, 36, 0.2);
            font-family: Georgia, serif;
            line-height: 1;
        }

        .personal-note-text {
            font-size: 1rem;
            line-height: 2;
            color: var(--text-1);
            white-space: pre-wrap;
            position: relative;
            z-index: 1;
        }

        .personal-note-footer {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid rgba(251, 191, 36, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .personal-note-date {
            font-size: 0.75rem;
            color: var(--text-3);
        }

        .personal-note-count {
            font-size: 0.75rem;
            color: var(--text-3);
        }

        /* ==================== Future Forecast ==================== */
        .future-card {
            background: linear-gradient(135deg, var(--surface-1) 0%, rgba(139, 92, 246, 0.08) 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: var(--radius-card);
            padding: 24px;
        }

        .future-section {
            margin-bottom: 28px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-1);
        }

        .future-section:last-of-type {
            margin-bottom: 20px;
            padding-bottom: 0;
            border-bottom: none;
        }

        .future-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 16px;
        }

        .future-icon {
            font-size: 1.1rem;
        }

        /* 兴趣萌芽 */
        .interests-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .interest-item {
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: 12px;
            padding: 16px;
            transition: all var(--duration-fast);
        }

        .interest-item:hover {
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
        }

        .interest-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .interest-emoji {
            font-size: 1.2rem;
        }

        .interest-topic {
            font-weight: 600;
            color: var(--text-1);
            font-size: 0.95rem;
        }

        .interest-signal {
            font-size: 0.85rem;
            color: var(--text-2);
            line-height: 1.6;
            margin-bottom: 10px;
            padding-left: 4px;
            border-left: 2px solid rgba(139, 92, 246, 0.3);
        }

        .interest-suggestion {
            font-size: 0.85rem;
            color: var(--accent);
            font-style: italic;
        }

        /* 发展趋势 */
        .trajectory-content {
            padding: 0 4px;
        }

        .trajectory-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .trajectory-state {
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            max-width: 140px;
            text-align: center;
        }

        .from-state {
            background: var(--surface-2);
            color: var(--text-2);
        }

        .to-state {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(168, 85, 247, 0.15));
            color: var(--accent);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .trajectory-arrow {
            font-size: 1.5rem;
            color: var(--accent);
            animation: arrowPulse 2s ease-in-out infinite;
        }

        @keyframes arrowPulse {
            0%, 100% { opacity: 0.6; transform: translateX(0); }
            50% { opacity: 1; transform: translateX(4px); }
        }

        .trajectory-evidence {
            font-size: 0.85rem;
            color: var(--text-3);
            text-align: center;
            margin-bottom: 16px;
            font-style: italic;
        }

        .trajectory-meaning {
            font-size: 0.9rem;
            color: var(--text-2);
            line-height: 1.7;
            text-align: center;
            padding: 16px;
            background: var(--surface-1);
            border-radius: 12px;
            border: 1px solid var(--border-1);
        }

        /* 潜力发现 */
        .potential-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .potential-item {
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: 12px;
            padding: 16px;
            transition: all var(--duration-fast);
        }

        .potential-item:hover {
            border-color: rgba(250, 204, 21, 0.3);
            transform: translateY(-2px);
        }

        .potential-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .potential-emoji {
            font-size: 1.2rem;
        }

        .potential-ability {
            font-weight: 600;
            color: var(--text-1);
            font-size: 0.95rem;
        }

        .potential-evidence {
            font-size: 0.85rem;
            color: var(--text-3);
            margin-bottom: 10px;
            font-style: italic;
        }

        .potential-affirmation {
            font-size: 0.9rem;
            color: var(--text-2);
            line-height: 1.6;
            padding: 12px;
            background: linear-gradient(135deg, rgba(250, 204, 21, 0.08), rgba(251, 191, 36, 0.05));
            border-radius: 8px;
            border-left: 3px solid rgba(250, 204, 21, 0.5);
        }

        /* 整体展望 */
        .future-summary {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.08));
            border-radius: 16px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .future-summary-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .future-summary-text {
            font-size: 0.95rem;
            color: var(--text-1);
            line-height: 1.8;
            font-weight: 500;
        }

        .future-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }

        .future-empty-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .future-empty-text {
            font-size: 0.9rem;
            color: var(--text-3);
        }

        /* ==================== Insights Themes ==================== */
        [data-theme="forest"] .mbti-card {
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.15) 0%, rgba(16, 185, 129, 0.1) 100%);
            border-color: rgba(52, 211, 153, 0.3);
        }

        [data-theme="forest"] .mbti-trait {
            background: rgba(52, 211, 153, 0.2);
            color: #34D399;
        }

        [data-theme="angel"] .mbti-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.12) 0%, rgba(255, 193, 7, 0.08) 100%);
            border-color: rgba(255, 215, 0, 0.3);
        }

        [data-theme="angel"] .mbti-trait {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
        }

        [data-theme="passion"] .mbti-card {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.12) 0%, rgba(255, 107, 107, 0.08) 100%);
            border-color: rgba(220, 53, 69, 0.3);
        }

        [data-theme="passion"] .mbti-trait {
            background: rgba(220, 53, 69, 0.2);
            color: #FF6B6B;
        }

        .notes-actions {
            display: flex;
            gap: 8px;
        }

        /* ==================== Biography Page ==================== */
        .biography-page {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: var(--bg-0);
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .biography-page.active {
            transform: translateX(0);
        }

        /* 传奇页面梦幻背景 - 紫色星云 */
        .biography-page::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 70% 50% at 30% 20%, rgba(200, 100, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 70% 30%, rgba(150, 50, 200, 0.08) 0%, transparent 45%),
                radial-gradient(ellipse 80% 50% at 50% 80%, rgba(180, 80, 220, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse 50% 40% at 80% 70%, rgba(220, 120, 255, 0.05) 0%, transparent 40%);
            pointer-events: none;
            animation: bioAuroraDrift 25s ease-in-out infinite;
        }

        @keyframes bioAuroraDrift {
            0%, 100% { opacity: 0.7; transform: scale(1) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.05) rotate(1deg); }
        }

        /* 传奇页面星尘粒子 */
        .biography-page::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                radial-gradient(1.5px 1.5px at 80px 80px, rgba(200, 150, 255, 0.5), transparent),
                radial-gradient(1px 1px at 200px 150px, rgba(180, 120, 255, 0.4), transparent),
                radial-gradient(1.5px 1.5px at 350px 100px, rgba(220, 180, 255, 0.5), transparent),
                radial-gradient(1px 1px at 500px 200px, rgba(190, 140, 255, 0.4), transparent),
                radial-gradient(1px 1px at 150px 300px, rgba(210, 160, 255, 0.4), transparent),
                radial-gradient(1.5px 1.5px at 400px 350px, rgba(180, 100, 255, 0.5), transparent),
                radial-gradient(1px 1px at 600px 150px, rgba(200, 150, 255, 0.4), transparent),
                radial-gradient(1px 1px at 250px 400px, rgba(220, 170, 255, 0.3), transparent);
            background-size: 700px 500px;
            pointer-events: none;
            animation: bioParticlesFloat 50s linear infinite;
            opacity: 0.7;
        }

        @keyframes bioParticlesFloat {
            from { transform: translateY(0) translateX(0); }
            to { transform: translateY(-500px) translateX(50px); }
        }

        .biography-header {
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: linear-gradient(180deg, rgba(8, 9, 15, 0.95) 0%, rgba(8, 9, 15, 0.85) 100%);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(200, 150, 255, 0.1);
        }

        .biography-back, .biography-refresh {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            border-radius: 10px;
            color: var(--text-2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .biography-back:hover, .biography-refresh:hover {
            background: var(--surface-1);
            color: var(--text-1);
        }

        .biography-refresh.loading svg {
            animation: spin 1s linear infinite;
        }

        .biography-title {
            font-size: 1.125rem;
            font-weight: 600;
            background: linear-gradient(135deg, #c084fc, #e879f9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .biography-content {
            padding: 20px;
            padding-bottom: 40px;
            position: relative;
            z-index: 1;
        }

        .biography-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
        }

        .biography-loading-icon {
            margin-bottom: 20px;
        }

        .biography-loading-icon .loading-emoji {
            font-size: 4rem;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .biography-loading-text {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--text-1);
            margin-bottom: 8px;
        }

        .biography-loading-sub {
            font-size: 0.875rem;
            color: var(--text-3);
        }

        .biography-progress-bar {
            width: 200px;
            height: 6px;
            background: var(--bg-2);
            border-radius: 3px;
            overflow: hidden;
            margin: 16px 0 12px;
        }

        .biography-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #a78bfa);
            border-radius: 3px;
            transition: width 0.5s ease-out;
        }

        /* Biography Cover */
        .bio-cover {
            text-align: center;
            padding: 48px 24px 40px;
            margin-bottom: 28px;
            background: linear-gradient(180deg, rgba(200, 100, 255, 0.12) 0%, rgba(150, 50, 200, 0.05) 50%, transparent 100%);
            border: 1px solid rgba(200, 150, 255, 0.15);
            border-radius: 28px;
            animation: bioFadeIn 0.8s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .bio-cover::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse 60% 40% at 20% 20%, rgba(200, 150, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse 50% 30% at 80% 80%, rgba(180, 100, 255, 0.08) 0%, transparent 40%);
            pointer-events: none;
            animation: bioCoverGlow 6s ease-in-out infinite;
        }

        @keyframes bioCoverGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @keyframes bioFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bio-cover-emoji {
            font-size: 4rem;
            margin-bottom: 16px;
            display: inline-block;
            animation: gentlePulse 4s ease-in-out infinite;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 0 20px rgba(200, 150, 255, 0.4));
        }

        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .bio-cover-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-1);
            margin-bottom: 8px;
            line-height: 1.3;
            position: relative;
            z-index: 1;
            text-shadow: 0 0 30px rgba(200, 150, 255, 0.3);
        }

        .bio-cover-subtitle {
            font-size: 1rem;
            color: var(--text-2);
            font-style: italic;
            position: relative;
            z-index: 1;
        }

        /* Biography Section */
        .bio-section {
            margin-bottom: 32px;
            animation: bioFadeIn 0.6s ease-out forwards;
            opacity: 0;
        }

        .bio-section:nth-child(2) { animation-delay: 0.1s; }
        .bio-section:nth-child(3) { animation-delay: 0.2s; }
        .bio-section:nth-child(4) { animation-delay: 0.3s; }
        .bio-section:nth-child(5) { animation-delay: 0.4s; }
        .bio-section:nth-child(6) { animation-delay: 0.5s; }
        .bio-section:nth-child(7) { animation-delay: 0.6s; }
        .bio-section:nth-child(8) { animation-delay: 0.7s; }

        .bio-section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-1);
        }

        .bio-section-icon {
            font-size: 1rem;
        }

        /* Portrait Card */
        .bio-portrait {
            background: linear-gradient(135deg, rgba(200, 150, 255, 0.08) 0%, rgba(150, 100, 220, 0.04) 100%);
            border: 1px solid rgba(200, 150, 255, 0.15);
            border-radius: 20px;
            padding: 28px;
            position: relative;
            overflow: hidden;
        }

        .bio-portrait::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(200, 150, 255, 0.5), transparent);
        }

        .bio-tagline {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-1);
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-1);
        }

        .bio-essence {
            font-size: 0.9375rem;
            line-height: 1.9;
            color: var(--text-2);
            margin-bottom: 24px;
            text-align: justify;
        }

        .bio-traits-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .bio-traits-col h4 {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bio-traits-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .bio-traits-list li {
            font-size: 0.85rem;
            color: var(--text-2);
            padding: 6px 0;
            padding-left: 12px;
            position: relative;
        }

        .bio-traits-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary-1);
        }

        .bio-driving-force {
            background: var(--surface-1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .bio-driving-force h4 {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 8px;
        }

        .bio-driving-force p {
            font-size: 0.875rem;
            color: var(--text-2);
            line-height: 1.6;
        }

        .bio-spirit {
            text-align: center;
            padding: 16px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 12px;
            font-size: 0.9375rem;
            color: var(--primary-1);
            font-style: italic;
        }

        /* Chapter Card */
        .bio-chapter {
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: var(--radius-card);
            padding: 24px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .bio-chapter:hover {
            border-color: rgba(139, 92, 246, 0.3);
        }

        .bio-chapter-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
        }

        .bio-chapter-emoji {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .bio-chapter-meta {
            flex: 1;
        }

        .bio-chapter-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-1);
            margin-bottom: 4px;
        }

        .bio-chapter-subtitle {
            font-size: 0.875rem;
            color: var(--text-2);
            margin-bottom: 4px;
        }

        .bio-chapter-period {
            font-size: 0.75rem;
            color: var(--text-3);
        }

        .bio-chapter-opening {
            font-size: 0.9375rem;
            color: var(--primary-1);
            font-style: italic;
            padding: 12px 16px;
            background: rgba(139, 92, 246, 0.08);
            border-left: 3px solid var(--primary-1);
            border-radius: 0 8px 8px 0;
            margin-bottom: 16px;
        }

        .bio-chapter-narrative {
            font-size: 0.9375rem;
            line-height: 1.9;
            color: var(--text-2);
            margin-bottom: 20px;
            text-align: justify;
        }

        .bio-chapter-moments {
            margin-bottom: 16px;
        }

        .bio-chapter-moments h5 {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bio-moments-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .bio-moments-list li {
            font-size: 0.85rem;
            color: var(--text-2);
            padding: 8px 12px;
            background: var(--surface-2);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .bio-chapter-growth {
            background: rgba(52, 211, 153, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .bio-chapter-growth h5 {
            font-size: 0.8125rem;
            font-weight: 600;
            color: #34D399;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bio-chapter-growth p {
            font-size: 0.875rem;
            color: var(--text-2);
            line-height: 1.7;
        }

        .bio-chapter-closing {
            font-size: 0.875rem;
            color: var(--text-3);
            font-style: italic;
            text-align: right;
            padding-top: 12px;
            border-top: 1px solid var(--border-1);
        }

        /* Life Themes */
        .bio-theme {
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .bio-theme-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .bio-theme-emoji {
            font-size: 1.5rem;
        }

        .bio-theme-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-1);
        }

        .bio-theme-desc {
            font-size: 0.875rem;
            color: var(--text-2);
            line-height: 1.7;
            margin-bottom: 16px;
        }

        .bio-theme-manifestations {
            margin-bottom: 12px;
        }

        .bio-theme-manifestations h5 {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-3);
            margin-bottom: 8px;
        }

        .bio-manifestation-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .bio-manifestation-tag {
            font-size: 0.8125rem;
            color: var(--text-2);
            background: var(--surface-2);
            padding: 6px 12px;
            border-radius: 20px;
        }

        .bio-theme-evolution {
            font-size: 0.8125rem;
            color: var(--primary-1);
            font-style: italic;
        }

        /* Quotes */
        .bio-quote {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, transparent 100%);
            border-left: 4px solid var(--primary-1);
            border-radius: 0 16px 16px 0;
            padding: 20px 24px;
            margin-bottom: 16px;
        }

        .bio-quote-text {
            font-size: 1.0625rem;
            color: var(--text-1);
            line-height: 1.7;
            margin-bottom: 12px;
            font-style: italic;
        }

        .bio-quote-text::before {
            content: """;
            font-size: 2rem;
            color: var(--primary-1);
            line-height: 0;
            margin-right: 4px;
            vertical-align: middle;
        }

        .bio-quote-text::after {
            content: """;
            font-size: 2rem;
            color: var(--primary-1);
            line-height: 0;
            margin-left: 4px;
            vertical-align: middle;
        }

        .bio-quote-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bio-quote-source {
            font-size: 0.8125rem;
            color: var(--text-3);
        }

        .bio-quote-meaning {
            font-size: 0.75rem;
            color: var(--text-2);
            max-width: 60%;
            text-align: right;
        }

        /* Timeline */
        .bio-timeline {
            position: relative;
            padding-left: 24px;
        }

        .bio-timeline::before {
            content: "";
            position: absolute;
            left: 6px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            background: linear-gradient(180deg, var(--primary-1) 0%, var(--primary-2) 50%, var(--primary-3) 100%);
            border-radius: 2px;
        }

        .bio-timeline-item {
            position: relative;
            padding-bottom: 24px;
        }

        .bio-timeline-item:last-child {
            padding-bottom: 0;
        }

        .bio-timeline-dot {
            position: absolute;
            left: -24px;
            top: 4px;
            width: 16px;
            height: 16px;
            background: var(--bg-0);
            border: 3px solid var(--primary-1);
            border-radius: 50%;
            z-index: 1;
        }

        .bio-timeline-date {
            font-size: 0.75rem;
            color: var(--text-3);
            margin-bottom: 4px;
        }

        .bio-timeline-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 6px;
        }

        .bio-timeline-desc {
            font-size: 0.875rem;
            color: var(--text-2);
            margin-bottom: 6px;
        }

        .bio-timeline-significance {
            font-size: 0.8125rem;
            color: var(--primary-1);
            font-style: italic;
        }

        /* Epilogue */
        .bio-epilogue {
            background: linear-gradient(180deg, transparent 0%, rgba(139, 92, 246, 0.08) 100%);
            border: 1px solid var(--border-1);
            border-radius: var(--radius-card);
            padding: 32px 24px;
            text-align: center;
        }

        .bio-epilogue-text {
            font-size: 0.9375rem;
            line-height: 2;
            color: var(--text-2);
            text-align: justify;
            margin-bottom: 24px;
        }

        .bio-meta {
            display: flex;
            justify-content: center;
            gap: 16px;
            font-size: 0.75rem;
            color: var(--text-3);
        }

        .bio-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Empty State */
        .bio-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }

        .bio-empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .bio-empty-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 12px;
        }

        .bio-empty-text {
            font-size: 0.9375rem;
            color: var(--text-2);
            line-height: 1.6;
            max-width: 300px;
            margin-bottom: 24px;
        }

        .bio-generate-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: var(--primary-gradient);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-btn);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px var(--primary-glow);
        }

        .bio-generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px var(--primary-glow);
        }

        .bio-generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Update Banner */
        .bio-update-banner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            background: rgba(139, 92, 246, 0.15);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 20px;
        }

        .bio-update-info {
            flex: 1;
        }

        .bio-update-info strong {
            font-size: 0.875rem;
            color: var(--text-1);
        }

        .bio-update-info small {
            font-size: 0.75rem;
            color: var(--text-3);
            display: block;
            margin-top: 2px;
        }

        .bio-update-btn {
            padding: 8px 16px;
            background: var(--primary-1);
            color: white;
            font-size: 0.8125rem;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bio-update-btn:hover {
            background: var(--primary-2);
        }

        /* Biography Theme Variations */
        [data-theme="forest"] .bio-cover {
            background: linear-gradient(180deg, rgba(52, 211, 153, 0.1) 0%, transparent 100%);
        }

        [data-theme="forest"] .bio-portrait {
            background: linear-gradient(135deg, var(--surface-1) 0%, rgba(52, 211, 153, 0.08) 100%);
            border-color: rgba(52, 211, 153, 0.2);
        }

        [data-theme="angel"] .bio-cover {
            background: linear-gradient(180deg, rgba(255, 215, 0, 0.1) 0%, transparent 100%);
        }

        [data-theme="angel"] .bio-portrait {
            background: linear-gradient(135deg, var(--surface-1) 0%, rgba(255, 215, 0, 0.08) 100%);
            border-color: rgba(255, 215, 0, 0.2);
        }

        [data-theme="passion"] .bio-cover {
            background: linear-gradient(180deg, rgba(220, 53, 69, 0.1) 0%, transparent 100%);
        }

        [data-theme="passion"] .bio-portrait {
            background: linear-gradient(135deg, var(--surface-1) 0%, rgba(220, 53, 69, 0.08) 100%);
            border-color: rgba(220, 53, 69, 0.2);
        }

        /* ==================== Cat Bubble ==================== */
        .cat-bubble-overlay {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease-out;
            pointer-events: none;
        }

        .cat-bubble-overlay.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }

        .cat-bubble {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            max-width: 400px;
            padding: 18px 20px;
            background: rgba(30, 30, 40, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 180, 100, 0.3);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 60px rgba(255, 180, 100, 0.15);
            animation: catBounce 0.5s ease-out;
        }

        @keyframes catBounce {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .cat-avatar {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #FFB366 0%, #FF8C42 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(255, 140, 66, 0.3);
        }

        .cat-emoji {
            font-size: 24px;
        }

        .cat-content {
            flex: 1;
            min-width: 0;
        }

        .cat-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: #FFB366;
            margin-bottom: 6px;
        }

        .cat-message {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-1);
            white-space: pre-wrap;
        }

        .cat-close {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--text-3);
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .cat-close:hover {
            opacity: 1;
        }

        /* 知知专属气泡样式 */
        .zhizhi-bubble-overlay {
            bottom: 120px;
        }

        .zhizhi-bubble {
            border: 1px solid rgba(255, 169, 77, 0.5) !important;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5), 0 0 80px rgba(255, 169, 77, 0.25) !important;
            background: linear-gradient(145deg, rgba(40, 30, 20, 0.98), rgba(30, 25, 15, 0.98)) !important;
        }

        .zhizhi-avatar {
            flex-shrink: 0;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            background: linear-gradient(135deg, #ffa94d 0%, #ff922b 100%);
            border-radius: 50%;
            box-shadow: 0 4px 16px rgba(255, 169, 77, 0.5);
            animation: zhizhiPulse 2s ease-in-out infinite;
        }

        @keyframes zhizhiPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 16px rgba(255, 169, 77, 0.5); }
            50% { transform: scale(1.05); box-shadow: 0 6px 24px rgba(255, 169, 77, 0.7); }
        }

        .zhizhi-content {
            flex: 1;
            min-width: 0;
        }

        .zhizhi-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: #ffa94d;
            margin-bottom: 6px;
        }

        .zhizhi-message {
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-1);
            white-space: pre-wrap;
        }

        /* 知知思考中提示 */
        .zhizhi-thinking {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease-out;
            pointer-events: none;
        }

        .zhizhi-thinking.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .zhizhi-thinking-content {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: linear-gradient(145deg, rgba(40, 30, 20, 0.95), rgba(30, 25, 15, 0.95));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 169, 77, 0.4);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 40px rgba(255, 169, 77, 0.15);
        }

        .zhizhi-thinking-emoji {
            font-size: 24px;
            animation: zhizhiThinkBounce 1s ease-in-out infinite;
        }

        @keyframes zhizhiThinkBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        .zhizhi-thinking-text {
            font-size: 0.9rem;
            color: #ffa94d;
            font-weight: 500;
        }

        .zhizhi-thinking-dots {
            display: flex;
            gap: 2px;
        }

        .zhizhi-thinking-dots span {
            font-size: 1.2rem;
            color: #ffa94d;
            animation: zhizhiDotPulse 1.4s ease-in-out infinite;
        }

        .zhizhi-thinking-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .zhizhi-thinking-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes zhizhiDotPulse {
            0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }
            30% { opacity: 1; transform: translateY(-3px); }
        }

        /* Theme-specific cat bubble */
        [data-theme="angel"] .cat-bubble {
            background: rgba(40, 35, 20, 0.96);
            border-color: rgba(255, 215, 0, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 60px rgba(255, 215, 0, 0.2);
        }

        [data-theme="angel"] .cat-avatar {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
        }

        [data-theme="angel"] .cat-name {
            color: #FFD700;
        }

        [data-theme="passion"] .cat-bubble {
            background: rgba(40, 20, 25, 0.96);
            border-color: rgba(220, 53, 69, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 60px rgba(220, 53, 69, 0.2);
        }

        [data-theme="passion"] .cat-avatar {
            background: linear-gradient(135deg, #FF6B6B 0%, #DC143C 100%);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        [data-theme="passion"] .cat-name {
            color: #FF6B6B;
        }

        [data-theme="forest"] .cat-bubble {
            background: rgba(20, 35, 30, 0.96);
            border-color: rgba(52, 211, 153, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 60px rgba(52, 211, 153, 0.15);
        }

        [data-theme="forest"] .cat-avatar {
            background: linear-gradient(135deg, #34D399 0%, #059669 100%);
            box-shadow: 0 4px 12px rgba(52, 211, 153, 0.4);
        }

        [data-theme="forest"] .cat-name {
            color: #34D399;
        }

        /* ==================== Loading ==================== */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            gap: 8px;
            color: var(--text-3);
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-1);
            border-top-color: var(--primary-2);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==================== Utilities ==================== */
        .hidden {
            display: none !important;
        }

        /* Mobile adjustments */
        @media (max-width: 480px) {
            .app-container {
                padding: 0 16px;
            }

            .auth-card {
                padding: 32px 24px;
            }

            .composer {
                padding: 20px;
            }

            .note-card {
                padding: 16px;
            }

            .toast-container {
                bottom: 16px;
                right: 16px;
                left: 16px;
            }

            .toast {
                width: 100%;
            }

            .nav-actions {
                gap: 8px;
            }

            .theme-btn {
                padding: 8px 10px;
            }

            .user-button {
                padding: 6px 10px;
            }

            .user-button .user-name {
                display: none;
            }
        }

        /* ========================================
           Scene Portal - 全屏沉浸式主题场景
           ======================================== */
        .scene-portal {
            position: fixed;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        /* 只在登录后显示场景 */
        .notes-section.active .scene-portal {
            opacity: 1;
            visibility: visible;
        }

        .scene {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            inset: 0;
        }

        /* 场景渐变遮罩 - 让内容区域可读 */
        .scene::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                180deg,
                transparent 0%,
                transparent 25%,
                rgba(var(--bg-rgb, 10, 10, 15), 0.3) 40%,
                rgba(var(--bg-rgb, 10, 10, 15), 0.7) 60%,
                rgba(var(--bg-rgb, 10, 10, 15), 0.92) 80%,
                var(--bg-0) 100%
            );
            pointer-events: none;
        }

        [data-theme="galaxy"] .scene-galaxy { display: block; }
        [data-theme="forest"] .scene-forest { display: block; }
        [data-theme="angel"] .scene-angel { display: block; }
        [data-theme="passion"] .scene-passion { display: block; }

        /* 通用入口样式 - 大气融入场景 */
        .portal-entry {
            position: fixed;
            cursor: pointer;
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), filter 0.4s ease;
            pointer-events: auto;
        }

        .portal-entry:hover { filter: brightness(1.2); }
        .portal-entry:active { transform: scale(0.98); }

        .portal-entry .entry-name {
            margin-top: 12px;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 2px;
            opacity: 0.9;
            transition: opacity 0.3s ease, transform 0.3s ease, text-shadow 0.3s ease;
        }

        .portal-entry:hover .entry-name {
            opacity: 1;
            transform: translateY(-3px);
        }

        /* 入口位置 - 屏幕上方可见区域 */
        .entry-left { left: 15%; top: 180px; transform: translateY(0); }
        .entry-center { left: 50%; top: 150px; transform: translateX(-50%); }
        .entry-right { right: 15%; top: 180px; transform: translateY(0); }

        .entry-left:hover { transform: translateY(-5px) scale(1.08); }
        .entry-center:hover { transform: translateX(-50%) translateY(-5px) scale(1.12); }
        .entry-right:hover { transform: translateY(-5px) scale(1.08); }

        /* 入口光环背景 - 让元素融入场景 */
        .portal-entry::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180%;
            height: 180%;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
            z-index: -1;
        }

        .portal-entry:hover::before {
            opacity: 1;
        }

        /* ========================================
           Galaxy Scene - 细腻梦幻星河
           ======================================== */
        .scene-galaxy {
            background: #000;
            overflow: hidden;
        }

        .galaxy-layer {
            position: absolute;
            inset: 0;
        }

        /* 深空背景 - 更柔和的多层渐变 */
        .galaxy-deep {
            background:
                radial-gradient(ellipse at 15% 85%, rgba(40, 15, 70, 0.9) 0%, transparent 50%),
                radial-gradient(ellipse at 85% 15%, rgba(15, 30, 70, 0.9) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(20, 10, 40, 0.95) 0%, transparent 70%),
                radial-gradient(ellipse at 30% 20%, rgba(25, 15, 55, 0.7) 0%, transparent 45%),
                radial-gradient(ellipse at 70% 80%, rgba(15, 25, 50, 0.7) 0%, transparent 45%),
                radial-gradient(ellipse at 50% 30%, rgba(30, 20, 60, 0.5) 0%, transparent 60%),
                #030308;
        }

        /* 宇宙极光层 - 顶部的梦幻极光 */
        .galaxy-aurora {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background:
                linear-gradient(180deg,
                    rgba(138, 43, 226, 0.08) 0%,
                    rgba(75, 0, 130, 0.05) 20%,
                    rgba(0, 150, 200, 0.03) 40%,
                    transparent 100%
                );
            animation: galaxyAuroraPulse 20s ease-in-out infinite;
        }

        .galaxy-aurora::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 40% at 30% 20%, rgba(100, 200, 255, 0.06) 0%, transparent 60%),
                radial-gradient(ellipse 60% 30% at 70% 30%, rgba(200, 100, 255, 0.05) 0%, transparent 50%);
            animation: auroraWave 15s ease-in-out infinite;
        }

        @keyframes galaxyAuroraPulse {
            0%, 100% { opacity: 0.6; transform: scaleY(1); }
            50% { opacity: 1; transform: scaleY(1.1); }
        }

        @keyframes auroraWave {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(30px); }
        }

        /* 主星云 - 更细腻柔和的紫蓝色调 */
        .galaxy-nebula {
            background:
                radial-gradient(ellipse 70% 50% at 25% 30%, rgba(138, 43, 226, 0.18) 0%, rgba(138, 43, 226, 0.05) 30%, transparent 60%),
                radial-gradient(ellipse 60% 70% at 75% 55%, rgba(75, 0, 130, 0.22) 0%, rgba(75, 0, 130, 0.06) 35%, transparent 55%),
                radial-gradient(ellipse 80% 60% at 50% 85%, rgba(30, 60, 120, 0.18) 0%, transparent 50%),
                radial-gradient(ellipse 50% 50% at 85% 25%, rgba(100, 50, 180, 0.15) 0%, transparent 45%),
                radial-gradient(ellipse 40% 35% at 15% 60%, rgba(80, 40, 160, 0.12) 0%, transparent 40%);
            animation: nebulaDrift 50s ease-in-out infinite;
            filter: blur(2px);
        }

        /* 次级星云 - 青蓝色调更梦幻 */
        .galaxy-nebula-2 {
            background:
                radial-gradient(ellipse 55% 55% at 60% 35%, rgba(0, 150, 200, 0.12) 0%, transparent 55%),
                radial-gradient(ellipse 65% 45% at 20% 65%, rgba(0, 200, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse 45% 65% at 80% 70%, rgba(50, 100, 200, 0.12) 0%, transparent 45%),
                radial-gradient(ellipse 35% 40% at 40% 20%, rgba(100, 180, 255, 0.08) 0%, transparent 40%);
            animation: nebulaDrift2 60s ease-in-out infinite reverse;
            filter: blur(3px);
        }

        /* 星云丝带 - 飘逸的细腻丝带 */
        .galaxy-nebula-wisps {
            position: absolute;
            inset: 0;
            opacity: 0.5;
        }

        .nebula-wisp {
            position: absolute;
            border-radius: 50%;
            filter: blur(20px);
            animation: wispFloat 25s ease-in-out infinite;
        }

        .wisp-1 {
            width: 300px;
            height: 60px;
            background: linear-gradient(90deg, transparent, rgba(200, 100, 255, 0.15), rgba(150, 50, 200, 0.1), transparent);
            top: 15%;
            left: 10%;
            transform: rotate(-15deg);
            animation-delay: 0s;
        }

        .wisp-2 {
            width: 250px;
            height: 50px;
            background: linear-gradient(90deg, transparent, rgba(100, 150, 255, 0.12), rgba(50, 100, 200, 0.08), transparent);
            top: 35%;
            right: 15%;
            transform: rotate(10deg);
            animation-delay: 5s;
        }

        .wisp-3 {
            width: 200px;
            height: 40px;
            background: linear-gradient(90deg, transparent, rgba(0, 200, 255, 0.1), rgba(100, 200, 255, 0.06), transparent);
            bottom: 40%;
            left: 25%;
            transform: rotate(-8deg);
            animation-delay: 10s;
        }

        @keyframes wispFloat {
            0%, 100% { transform: translateX(0) translateY(0) rotate(-15deg); opacity: 0.4; }
            25% { transform: translateX(30px) translateY(-10px) rotate(-12deg); opacity: 0.6; }
            50% { transform: translateX(15px) translateY(5px) rotate(-18deg); opacity: 0.5; }
            75% { transform: translateX(-20px) translateY(-5px) rotate(-14deg); opacity: 0.55; }
        }

        @keyframes nebulaDrift {
            0%, 100% { transform: translateX(0) translateY(0) scale(1); opacity: 1; }
            33% { transform: translateX(-20px) translateY(10px) scale(1.03); opacity: 0.85; }
            66% { transform: translateX(15px) translateY(-8px) scale(0.98); opacity: 0.95; }
        }

        @keyframes nebulaDrift2 {
            0%, 100% { transform: translateX(0) translateY(0) scale(1); }
            50% { transform: translateX(30px) translateY(-15px) scale(1.05); }
        }

        /* 银河带 - 更细腻的星河 */
        .galaxy-milkyway {
            background:
                linear-gradient(125deg,
                    transparent 0%,
                    transparent 32%,
                    rgba(180, 160, 220, 0.015) 36%,
                    rgba(220, 200, 255, 0.04) 41%,
                    rgba(255, 255, 255, 0.08) 46%,
                    rgba(255, 252, 245, 0.12) 49%,
                    rgba(255, 250, 240, 0.14) 50%,
                    rgba(255, 252, 245, 0.12) 51%,
                    rgba(255, 255, 255, 0.08) 54%,
                    rgba(220, 200, 255, 0.04) 59%,
                    rgba(180, 160, 220, 0.015) 64%,
                    transparent 68%,
                    transparent 100%
                );
            filter: blur(15px);
            animation: milkywayShimmer 20s ease-in-out infinite;
        }

        /* 银河微粒层 */
        .galaxy-milkyway-particles {
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(0.5px 0.5px at 30% 45%, rgba(255,255,255,0.8), transparent),
                radial-gradient(0.5px 0.5px at 35% 48%, rgba(255,255,255,0.6), transparent),
                radial-gradient(0.5px 0.5px at 40% 46%, rgba(255,255,255,0.7), transparent),
                radial-gradient(0.5px 0.5px at 45% 49%, rgba(255,255,255,0.5), transparent),
                radial-gradient(0.5px 0.5px at 50% 47%, rgba(255,255,255,0.8), transparent),
                radial-gradient(0.5px 0.5px at 55% 50%, rgba(255,255,255,0.6), transparent),
                radial-gradient(0.5px 0.5px at 60% 48%, rgba(255,255,255,0.7), transparent),
                radial-gradient(0.5px 0.5px at 65% 51%, rgba(255,255,255,0.5), transparent),
                radial-gradient(0.5px 0.5px at 70% 49%, rgba(255,255,255,0.8), transparent);
            background-size: 100% 100%;
            opacity: 0.4;
            animation: milkywayParticles 8s ease-in-out infinite;
        }

        @keyframes milkywayParticles {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.5; }
        }

        @keyframes milkywayShimmer {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* 宇宙薄雾层 - 增加深度感 */
        .galaxy-mist {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        .galaxy-mist-layer {
            position: absolute;
            inset: 0;
            opacity: 0.3;
        }

        .mist-cosmic-1 {
            background: radial-gradient(ellipse 100% 50% at 50% 100%, rgba(30, 20, 60, 0.4) 0%, transparent 70%);
            animation: cosmicMistFloat 35s ease-in-out infinite;
        }

        .mist-cosmic-2 {
            background: radial-gradient(ellipse 80% 40% at 20% 80%, rgba(50, 30, 80, 0.3) 0%, transparent 60%);
            animation: cosmicMistFloat 40s ease-in-out infinite reverse;
        }

        .mist-cosmic-3 {
            background: radial-gradient(ellipse 80% 40% at 80% 85%, rgba(20, 40, 70, 0.3) 0%, transparent 60%);
            animation: cosmicMistFloat 45s ease-in-out infinite;
            animation-delay: -15s;
        }

        @keyframes cosmicMistFloat {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.25; }
            50% { transform: translateY(-20px) scale(1.05); opacity: 0.35; }
        }

        /* 螺旋星系 - 更精致 */
        .spiral-galaxy {
            position: absolute;
            border-radius: 50%;
            background:
                conic-gradient(from 0deg,
                    transparent 0deg,
                    rgba(255, 255, 255, 0.12) 15deg,
                    transparent 30deg,
                    rgba(200, 180, 255, 0.08) 60deg,
                    transparent 75deg,
                    rgba(255, 255, 255, 0.1) 105deg,
                    transparent 120deg,
                    rgba(180, 160, 220, 0.08) 150deg,
                    transparent 165deg,
                    rgba(255, 255, 255, 0.12) 195deg,
                    transparent 210deg,
                    rgba(200, 180, 255, 0.08) 240deg,
                    transparent 255deg,
                    rgba(255, 255, 255, 0.1) 285deg,
                    transparent 300deg,
                    rgba(180, 160, 220, 0.08) 330deg,
                    transparent 345deg
                ),
                radial-gradient(circle, rgba(255,255,255,0.5) 0%, rgba(200,180,255,0.25) 15%, rgba(150,130,200,0.1) 30%, transparent 55%);
            filter: blur(0.5px);
        }

        .spiral-1 {
            width: 180px;
            height: 180px;
            top: 8%;
            right: 15%;
            animation: spiralRotate 150s linear infinite, spiralPulse 10s ease-in-out infinite;
            opacity: 0.5;
        }

        .spiral-2 {
            width: 100px;
            height: 100px;
            bottom: 30%;
            left: 8%;
            animation: spiralRotate 100s linear infinite reverse, spiralPulse 8s ease-in-out infinite;
            opacity: 0.35;
        }

        .spiral-3 {
            width: 60px;
            height: 60px;
            top: 45%;
            right: 25%;
            animation: spiralRotate 80s linear infinite, spiralPulse 6s ease-in-out infinite;
            opacity: 0.25;
        }

        @keyframes spiralRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes spiralPulse {
            0%, 100% { filter: blur(0.5px) brightness(1); }
            50% { filter: blur(1px) brightness(1.2); }
        }

        /* 星团簇 - 密集的微小星星群 */
        .star-cluster {
            position: absolute;
            border-radius: 50%;
        }

        .cluster-1 {
            width: 80px;
            height: 80px;
            top: 20%;
            left: 30%;
            background-image:
                radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.9), transparent),
                radial-gradient(0.5px 0.5px at 35% 25%, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 50% 40%, rgba(255,255,255,0.8), transparent),
                radial-gradient(0.5px 0.5px at 65% 35%, rgba(255,255,255,0.6), transparent),
                radial-gradient(1px 1px at 40% 55%, rgba(200,220,255,0.9), transparent),
                radial-gradient(0.5px 0.5px at 55% 60%, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 30% 70%, rgba(255,255,255,0.8), transparent),
                radial-gradient(0.5px 0.5px at 70% 50%, rgba(200,200,255,0.6), transparent);
            filter: blur(0.3px);
            animation: clusterTwinkle 5s ease-in-out infinite;
        }

        .cluster-2 {
            width: 60px;
            height: 60px;
            top: 55%;
            right: 35%;
            background-image:
                radial-gradient(1px 1px at 25% 35%, rgba(255,255,255,0.8), transparent),
                radial-gradient(0.5px 0.5px at 40% 30%, rgba(200,220,255,0.7), transparent),
                radial-gradient(1px 1px at 55% 45%, rgba(255,255,255,0.9), transparent),
                radial-gradient(0.5px 0.5px at 70% 40%, rgba(255,255,255,0.6), transparent),
                radial-gradient(1px 1px at 35% 60%, rgba(255,255,255,0.8), transparent),
                radial-gradient(0.5px 0.5px at 60% 55%, rgba(200,200,255,0.7), transparent);
            filter: blur(0.3px);
            animation: clusterTwinkle 4s ease-in-out infinite;
            animation-delay: 1s;
        }

        .cluster-3 {
            width: 50px;
            height: 50px;
            bottom: 35%;
            left: 45%;
            background-image:
                radial-gradient(1px 1px at 30% 40%, rgba(255,255,255,0.9), transparent),
                radial-gradient(0.5px 0.5px at 45% 35%, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 60% 50%, rgba(200,220,255,0.8), transparent),
                radial-gradient(0.5px 0.5px at 50% 65%, rgba(255,255,255,0.6), transparent),
                radial-gradient(1px 1px at 35% 55%, rgba(255,255,255,0.8), transparent);
            filter: blur(0.3px);
            animation: clusterTwinkle 6s ease-in-out infinite;
            animation-delay: 2s;
        }

        @keyframes clusterTwinkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        /* 远方星系团 - 更精致 */
        .distant-galaxy {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.7) 0%, rgba(220,200,255,0.4) 25%, rgba(180,160,220,0.15) 50%, transparent 70%);
            filter: blur(1px);
            animation: distantPulse 6s ease-in-out infinite;
        }

        .dg-1 {
            width: 6px;
            height: 6px;
            top: 15%;
            left: 25%;
            animation-delay: 0s;
        }

        .dg-2 {
            width: 10px;
            height: 10px;
            top: 35%;
            right: 20%;
            animation-delay: 2s;
        }

        .dg-3 {
            width: 5px;
            height: 5px;
            bottom: 45%;
            left: 35%;
            animation-delay: 4s;
        }

        .dg-4 {
            width: 7px;
            height: 7px;
            top: 50%;
            left: 15%;
            animation-delay: 1s;
        }

        .dg-5 {
            width: 4px;
            height: 4px;
            bottom: 55%;
            right: 30%;
            animation-delay: 3s;
        }

        @keyframes distantPulse {
            0%, 100% { transform: scale(1); opacity: 0.4; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* 多层星星 - 更细腻的远景 */
        .galaxy-stars-container {
            position: absolute;
            inset: 0;
        }

        .galaxy-stars-far {
            background-image:
                radial-gradient(0.8px 0.8px at 50px 80px, rgba(255,255,255,0.5), transparent),
                radial-gradient(0.6px 0.6px at 150px 200px, rgba(255,255,255,0.4), transparent),
                radial-gradient(0.8px 0.8px at 280px 50px, rgba(200,200,255,0.5), transparent),
                radial-gradient(0.6px 0.6px at 400px 180px, rgba(255,255,255,0.4), transparent),
                radial-gradient(0.8px 0.8px at 550px 100px, rgba(255,255,255,0.5), transparent),
                radial-gradient(0.6px 0.6px at 700px 220px, rgba(200,220,255,0.4), transparent),
                radial-gradient(0.8px 0.8px at 850px 60px, rgba(255,255,255,0.5), transparent),
                radial-gradient(0.6px 0.6px at 100px 300px, rgba(255,255,255,0.4), transparent),
                radial-gradient(0.8px 0.8px at 320px 280px, rgba(200,200,255,0.5), transparent),
                radial-gradient(0.6px 0.6px at 600px 320px, rgba(255,255,255,0.4), transparent),
                radial-gradient(0.5px 0.5px at 200px 150px, rgba(255,255,255,0.3), transparent),
                radial-gradient(0.5px 0.5px at 450px 250px, rgba(200,220,255,0.3), transparent),
                radial-gradient(0.5px 0.5px at 750px 150px, rgba(255,255,255,0.3), transparent);
            background-size: 1000px 400px;
            opacity: 0.7;
            animation: starsFloat 120s linear infinite;
        }

        /* 中景星星 - 更细腻 */
        .galaxy-stars-mid {
            background-image:
                radial-gradient(1.5px 1.5px at 30px 50px, rgba(255,255,255,0.95), transparent),
                radial-gradient(1.2px 1.2px at 120px 150px, rgba(255,255,255,0.85), transparent),
                radial-gradient(1.5px 1.5px at 250px 80px, rgba(200,220,255,0.9), transparent),
                radial-gradient(1.2px 1.2px at 380px 200px, rgba(255,255,255,0.85), transparent),
                radial-gradient(1.5px 1.5px at 500px 40px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1.2px 1.2px at 630px 180px, rgba(220,200,255,0.85), transparent),
                radial-gradient(1.5px 1.5px at 780px 100px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1.2px 1.2px at 180px 250px, rgba(200,255,255,0.85), transparent),
                radial-gradient(1.5px 1.5px at 450px 300px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1.2px 1.2px at 700px 280px, rgba(255,220,255,0.85), transparent);
            background-size: 900px 380px;
            animation: starsTwinkle 8s ease-in-out infinite;
        }

        /* 近景亮星 - 带光晕 */
        .galaxy-stars-near {
            background-image:
                radial-gradient(2.5px 2.5px at 80px 120px, #fff, rgba(255,255,255,0.3) 60%, transparent),
                radial-gradient(3px 3px at 300px 60px, rgba(200,220,255,1), rgba(200,220,255,0.2) 70%, transparent),
                radial-gradient(2.5px 2.5px at 520px 200px, #fff, rgba(255,255,255,0.3) 60%, transparent),
                radial-gradient(3px 3px at 750px 80px, rgba(255,220,255,1), rgba(255,220,255,0.2) 70%, transparent),
                radial-gradient(2.5px 2.5px at 200px 280px, rgba(200,255,255,1), rgba(200,255,255,0.2) 60%, transparent),
                radial-gradient(3px 3px at 600px 320px, #fff, rgba(255,255,255,0.3) 70%, transparent);
            background-size: 950px 400px;
            animation: starsTwinkleBright 5s ease-in-out infinite;
        }

        /* 最亮的主星 - 有十字光芒 */
        .galaxy-bright-star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px 3px rgba(255,255,255,0.6), 0 0 20px 6px rgba(200,220,255,0.3);
        }

        .galaxy-bright-star::before,
        .galaxy-bright-star::after {
            content: '';
            position: absolute;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
        }

        .galaxy-bright-star::before {
            width: 30px;
            height: 1px;
            left: -13px;
            top: 50%;
            transform: translateY(-50%);
        }

        .galaxy-bright-star::after {
            width: 1px;
            height: 30px;
            top: -13px;
            left: 50%;
            transform: translateX(-50%);
        }

        .bright-star-1 {
            top: 12%;
            left: 40%;
            animation: brightStarPulse 3s ease-in-out infinite;
        }

        .bright-star-2 {
            top: 30%;
            right: 25%;
            animation: brightStarPulse 4s ease-in-out infinite;
            animation-delay: 1s;
        }

        .bright-star-3 {
            bottom: 35%;
            left: 20%;
            animation: brightStarPulse 3.5s ease-in-out infinite;
            animation-delay: 2s;
        }

        @keyframes brightStarPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        @keyframes starsFloat {
            from { transform: translateY(0); }
            to { transform: translateY(-400px); }
        }

        @keyframes starsTwinkle {
            0%, 100% { opacity: 0.85; }
            50% { opacity: 0.65; }
        }

        @keyframes starsTwinkleBright {
            0%, 100% { opacity: 1; filter: brightness(1); }
            50% { opacity: 0.7; filter: brightness(1.3); }
        }

        /* 宇宙尘埃 - 更细腻的粒子 */
        .cosmic-dust {
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(1.5px 1.5px at 100px 100px, rgba(138, 43, 226, 0.35), transparent),
                radial-gradient(2px 2px at 300px 200px, rgba(0, 200, 255, 0.25), transparent),
                radial-gradient(1.5px 1.5px at 500px 150px, rgba(255, 100, 255, 0.25), transparent),
                radial-gradient(2px 2px at 700px 250px, rgba(100, 150, 255, 0.35), transparent),
                radial-gradient(1.5px 1.5px at 200px 350px, rgba(200, 100, 255, 0.25), transparent),
                radial-gradient(2px 2px at 600px 50px, rgba(0, 255, 200, 0.25), transparent),
                radial-gradient(1px 1px at 150px 250px, rgba(150, 100, 200, 0.3), transparent),
                radial-gradient(1px 1px at 450px 100px, rgba(100, 200, 255, 0.3), transparent),
                radial-gradient(1px 1px at 750px 300px, rgba(200, 150, 255, 0.3), transparent);
            background-size: 900px 450px;
            animation: dustFloat 40s ease-in-out infinite;
            opacity: 0.5;
        }

        @keyframes dustFloat {
            0%, 100% { transform: translateX(0) translateY(0); }
            33% { transform: translateX(15px) translateY(-10px); }
            66% { transform: translateX(-10px) translateY(8px); }
        }

        /* 精致流星 */
        .galaxy-shooting-star {
            position: absolute;
            width: 120px;
            height: 1.5px;
            background: linear-gradient(90deg,
                rgba(255,255,255,0.95) 0%,
                rgba(220,230,255,0.7) 20%,
                rgba(180,200,255,0.4) 40%,
                transparent 100%);
            top: 15%;
            left: -150px;
            transform: rotate(-35deg);
            animation: shootingStar 10s ease-out infinite;
            opacity: 0;
            filter: blur(0.3px);
        }

        .galaxy-shooting-star::before {
            content: '';
            position: absolute;
            left: 0;
            top: -1.5px;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #fff 0%, rgba(220,230,255,0.9) 40%, transparent 100%);
            border-radius: 50%;
            box-shadow: 0 0 6px 2px rgba(255,255,255,0.5);
        }

        .galaxy-shooting-star.delay-1 { top: 22%; animation-delay: 3s; transform: rotate(-38deg); }
        .galaxy-shooting-star.delay-2 { top: 35%; animation-delay: 6s; transform: rotate(-32deg); width: 100px; }
        .galaxy-shooting-star.delay-3 { top: 48%; animation-delay: 9s; transform: rotate(-42deg); width: 80px; }
        .galaxy-shooting-star.delay-4 { top: 60%; animation-delay: 12s; transform: rotate(-30deg); width: 90px; }

        @keyframes shootingStar {
            0% { left: -150px; opacity: 0; }
            2% { opacity: 0.9; }
            20% { left: 110%; opacity: 0; }
            100% { left: 110%; opacity: 0; }
        }

        /* 星光粒子飘浮 */
        .stardust-particles {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .stardust {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: stardustFloat 20s linear infinite;
        }

        .stardust:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 25s; }
        .stardust:nth-child(2) { left: 20%; animation-delay: 3s; animation-duration: 22s; }
        .stardust:nth-child(3) { left: 30%; animation-delay: 6s; animation-duration: 28s; }
        .stardust:nth-child(4) { left: 40%; animation-delay: 2s; animation-duration: 24s; }
        .stardust:nth-child(5) { left: 50%; animation-delay: 8s; animation-duration: 26s; }
        .stardust:nth-child(6) { left: 60%; animation-delay: 4s; animation-duration: 23s; }
        .stardust:nth-child(7) { left: 70%; animation-delay: 7s; animation-duration: 27s; }
        .stardust:nth-child(8) { left: 80%; animation-delay: 1s; animation-duration: 21s; }
        .stardust:nth-child(9) { left: 90%; animation-delay: 5s; animation-duration: 29s; }
        .stardust:nth-child(10) { left: 15%; animation-delay: 9s; animation-duration: 24s; }

        @keyframes stardustFloat {
            0% {
                transform: translateY(100vh) translateX(0) scale(0.5);
                opacity: 0;
            }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% {
                transform: translateY(-20px) translateX(30px) scale(1);
                opacity: 0;
            }
        }

        /* ============================================
           洞见 - 蓝色智慧之眼
           ============================================ */
        .star-insight {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .insight-orbit {
            position: absolute;
            inset: -15px;
            border: 2px solid rgba(0, 200, 255, 0.3);
            border-radius: 50%;
            animation: orbitRotate 8s linear infinite;
        }

        .insight-orbit::before {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(0, 255, 255, 0.9);
            border-radius: 50%;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        .insight-orbit.orbit-2 {
            inset: -30px;
            border-color: rgba(100, 150, 255, 0.2);
            animation: orbitRotate 12s linear infinite reverse;
        }

        .insight-orbit.orbit-2::before {
            width: 6px;
            height: 6px;
            background: rgba(100, 150, 255, 0.8);
            box-shadow: 0 0 8px rgba(100, 150, 255, 0.7);
        }

        @keyframes orbitRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .insight-glow {
            position: absolute;
            inset: -20px;
            background: radial-gradient(circle,
                rgba(0, 150, 255, 0.3) 0%,
                rgba(0, 100, 200, 0.15) 40%,
                transparent 70%);
            animation: insightPulse 3s ease-in-out infinite;
        }

        .insight-core {
            position: absolute;
            inset: 15px;
            background: radial-gradient(circle,
                #fff 0%,
                rgba(0, 200, 255, 0.9) 20%,
                rgba(0, 100, 200, 0.7) 50%,
                rgba(0, 50, 150, 0.4) 70%,
                transparent 100%);
            border-radius: 50%;
            box-shadow:
                0 0 30px rgba(0, 200, 255, 0.7),
                0 0 60px rgba(0, 100, 200, 0.4),
                inset 0 0 20px rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .insight-pupil {
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #000 0%, rgba(0, 50, 100, 0.8) 50%, transparent 100%);
            border-radius: 50%;
            animation: pupilLook 5s ease-in-out infinite;
        }

        @keyframes insightPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.15); opacity: 1; }
        }

        @keyframes pupilLook {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(3px, -2px); }
            50% { transform: translate(-2px, 2px); }
            75% { transform: translate(2px, 3px); }
        }

        /* ============================================
           Starlight - 金色超新星
           ============================================ */
        .star-supernova {
            position: relative;
            width: 140px;
            height: 140px;
        }

        .supernova-corona {
            position: absolute;
            inset: -30px;
            background:
                conic-gradient(from 0deg,
                    rgba(255, 215, 0, 0.4) 0deg,
                    transparent 15deg,
                    rgba(255, 180, 0, 0.3) 30deg,
                    transparent 45deg,
                    rgba(255, 220, 100, 0.4) 60deg,
                    transparent 75deg,
                    rgba(255, 200, 50, 0.3) 90deg,
                    transparent 105deg,
                    rgba(255, 215, 0, 0.4) 120deg,
                    transparent 135deg,
                    rgba(255, 180, 0, 0.3) 150deg,
                    transparent 165deg,
                    rgba(255, 220, 100, 0.4) 180deg,
                    transparent 195deg,
                    rgba(255, 200, 50, 0.3) 210deg,
                    transparent 225deg,
                    rgba(255, 215, 0, 0.4) 240deg,
                    transparent 255deg,
                    rgba(255, 180, 0, 0.3) 270deg,
                    transparent 285deg,
                    rgba(255, 220, 100, 0.4) 300deg,
                    transparent 315deg,
                    rgba(255, 200, 50, 0.3) 330deg,
                    transparent 345deg
                );
            animation: coronaRotate 30s linear infinite;
            filter: blur(3px);
        }

        @keyframes coronaRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .supernova-flare {
            position: absolute;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 230, 150, 0.8) 20%,
                rgba(255, 255, 255, 1) 50%,
                rgba(255, 230, 150, 0.8) 80%,
                transparent 100%);
            filter: blur(1px);
        }

        .flare-1 {
            width: 200px;
            height: 4px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: flarePulse 2s ease-in-out infinite;
        }

        .flare-2 {
            width: 4px;
            height: 200px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: flarePulse 2s ease-in-out infinite 0.5s;
        }

        .flare-3 {
            width: 160px;
            height: 3px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            animation: flarePulse 2s ease-in-out infinite 0.25s;
        }

        .flare-4 {
            width: 3px;
            height: 160px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            animation: flarePulse 2s ease-in-out infinite 0.75s;
        }

        @keyframes flarePulse {
            0%, 100% { opacity: 0.6; transform: translate(-50%, -50%) scaleX(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scaleX(1.1); }
        }

        .flare-3, .flare-4 {
            @keyframes flarePulse {
                0%, 100% { opacity: 0.6; }
                50% { opacity: 1; }
            }
        }

        .supernova-core {
            position: absolute;
            inset: 20px;
            background: radial-gradient(circle,
                #fff 0%,
                rgba(255, 250, 200, 1) 20%,
                rgba(255, 215, 0, 0.9) 40%,
                rgba(255, 180, 0, 0.6) 60%,
                rgba(255, 150, 0, 0.3) 80%,
                transparent 100%);
            border-radius: 50%;
            box-shadow:
                0 0 40px rgba(255, 215, 0, 0.9),
                0 0 80px rgba(255, 180, 0, 0.6),
                0 0 120px rgba(255, 150, 0, 0.4);
            animation: supernovaPulse 2s ease-in-out infinite;
        }

        .supernova-center {
            position: absolute;
            inset: 45px;
            background: radial-gradient(circle, #fff 0%, rgba(255, 250, 230, 0.9) 50%, transparent 100%);
            border-radius: 50%;
            animation: centerGlow 1.5s ease-in-out infinite;
        }

        @keyframes supernovaPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.2); }
        }

        @keyframes centerGlow {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 1; }
        }

        /* ============================================
           我的传奇 - 紫色命运星云
           ============================================ */
        .star-destiny {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .destiny-trail {
            position: absolute;
            inset: -40px;
            background:
                conic-gradient(from 180deg at 50% 50%,
                    transparent 0deg,
                    rgba(200, 100, 255, 0.3) 60deg,
                    rgba(255, 100, 200, 0.2) 120deg,
                    transparent 180deg,
                    rgba(150, 50, 200, 0.25) 240deg,
                    rgba(200, 50, 150, 0.15) 300deg,
                    transparent 360deg
                );
            animation: trailSpin 15s linear infinite;
            filter: blur(8px);
        }

        @keyframes trailSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .destiny-ring {
            position: absolute;
            inset: -5px;
            border: 3px solid transparent;
            border-top-color: rgba(200, 100, 255, 0.6);
            border-right-color: rgba(255, 100, 200, 0.4);
            border-radius: 50%;
            animation: ringRotate 4s linear infinite;
        }

        .destiny-ring.ring-2 {
            inset: -18px;
            border-width: 2px;
            border-top-color: rgba(150, 50, 200, 0.4);
            border-right-color: rgba(200, 50, 150, 0.3);
            animation: ringRotate 6s linear infinite reverse;
        }

        @keyframes ringRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .destiny-core {
            position: absolute;
            inset: 10px;
            background: radial-gradient(circle,
                #fff 0%,
                rgba(230, 180, 255, 0.95) 15%,
                rgba(200, 100, 255, 0.8) 35%,
                rgba(150, 50, 200, 0.5) 55%,
                rgba(100, 0, 150, 0.2) 75%,
                transparent 100%);
            border-radius: 50%;
            box-shadow:
                0 0 30px rgba(200, 100, 255, 0.7),
                0 0 60px rgba(150, 50, 200, 0.5),
                0 0 100px rgba(100, 0, 150, 0.3);
            animation: destinyPulse 3s ease-in-out infinite;
        }

        @keyframes destinyPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        /* 星尘粒子 */
        .destiny-sparkles {
            position: absolute;
            inset: 0;
        }

        .destiny-sparkles span {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            animation: sparkleFloat 3s ease-in-out infinite;
        }

        .destiny-sparkles span:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
        .destiny-sparkles span:nth-child(2) { top: 30%; right: 10%; animation-delay: 0.5s; }
        .destiny-sparkles span:nth-child(3) { bottom: 20%; left: 15%; animation-delay: 1s; }
        .destiny-sparkles span:nth-child(4) { top: 60%; right: 20%; animation-delay: 1.5s; }
        .destiny-sparkles span:nth-child(5) { bottom: 10%; right: 30%; animation-delay: 2s; }
        .destiny-sparkles span:nth-child(6) { top: 15%; left: 60%; animation-delay: 2.5s; }

        @keyframes sparkleFloat {
            0%, 100% { opacity: 0; transform: translateY(0) scale(0.5); }
            50% { opacity: 1; transform: translateY(-15px) scale(1); }
        }

        /* 星河入口悬浮效果 */
        .galaxy-entry .entry-name {
            color: rgba(220, 230, 255, 1);
            text-shadow: 0 0 15px rgba(138, 43, 226, 0.9), 0 0 30px rgba(75, 0, 130, 0.5);
            font-size: 15px;
            margin-top: 15px;
        }

        .galaxy-entry:hover .entry-name {
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.9), 0 0 40px rgba(138, 43, 226, 0.7);
        }

        /* 洞见悬浮效果 */
        .galaxy-entry:hover .star-insight .insight-core {
            box-shadow:
                0 0 50px rgba(0, 200, 255, 0.9),
                0 0 100px rgba(0, 150, 255, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.4);
        }

        /* Starlight悬浮效果 */
        .galaxy-entry:hover .star-supernova .supernova-core {
            box-shadow:
                0 0 60px rgba(255, 215, 0, 1),
                0 0 120px rgba(255, 180, 0, 0.8),
                0 0 180px rgba(255, 150, 0, 0.5);
        }

        /* 命运星云悬浮效果 */
        .galaxy-entry:hover .star-destiny .destiny-core {
            box-shadow:
                0 0 50px rgba(200, 100, 255, 0.9),
                0 0 100px rgba(150, 50, 200, 0.7),
                0 0 150px rgba(100, 0, 150, 0.4);
        }

        /* ========================================
           Forest Scene - 梦幻秘境
           ======================================== */
        .scene-forest {
            background:
                radial-gradient(ellipse at 50% 0%, rgba(20, 80, 40, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 20% 30%, rgba(30, 100, 50, 0.2) 0%, transparent 40%),
                radial-gradient(ellipse at 80% 30%, rgba(25, 90, 45, 0.2) 0%, transparent 40%),
                linear-gradient(180deg, #071510 0%, #0a1f14 30%, #0d2518 60%, #081812 100%);
        }

        .forest-layer {
            position: absolute;
            inset: 0;
        }

        /* 极光层 - 森林上空的梦幻极光 */
        .forest-aurora {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60%;
            background:
                radial-gradient(ellipse 80% 40% at 30% 10%, rgba(100, 255, 180, 0.08) 0%, transparent 60%),
                radial-gradient(ellipse 60% 35% at 70% 15%, rgba(80, 200, 150, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse 100% 50% at 50% 5%, rgba(120, 255, 200, 0.1) 0%, transparent 70%);
            animation: auroraFlow 20s ease-in-out infinite;
        }

        .forest-aurora::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse 70% 30% at 60% 20%, rgba(150, 255, 200, 0.05) 0%, transparent 60%),
                radial-gradient(ellipse 50% 25% at 40% 25%, rgba(100, 220, 160, 0.04) 0%, transparent 50%);
            animation: auroraFlow 15s ease-in-out infinite reverse;
        }

        @keyframes auroraFlow {
            0%, 100% {
                transform: translateX(0) scaleY(1);
                opacity: 0.8;
            }
            33% {
                transform: translateX(20px) scaleY(1.1);
                opacity: 1;
            }
            66% {
                transform: translateX(-15px) scaleY(0.95);
                opacity: 0.9;
            }
        }

        /* 多层薄雾 */
        .forest-mist-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        .mist-far {
            background:
                radial-gradient(ellipse 200% 30% at 20% 85%, rgba(150, 200, 150, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse 180% 25% at 80% 90%, rgba(130, 180, 140, 0.1) 0%, transparent 45%);
            animation: mistDrift 25s ease-in-out infinite;
        }

        .mist-mid {
            background:
                radial-gradient(ellipse 150% 20% at 40% 80%, rgba(170, 220, 170, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse 120% 18% at 70% 75%, rgba(160, 210, 160, 0.12) 0%, transparent 45%);
            animation: mistDrift 18s ease-in-out infinite reverse;
        }

        .mist-near {
            background:
                radial-gradient(ellipse 100% 15% at 30% 95%, rgba(180, 230, 180, 0.18) 0%, transparent 50%),
                radial-gradient(ellipse 80% 12% at 75% 92%, rgba(170, 220, 170, 0.14) 0%, transparent 45%);
            animation: mistDrift 12s ease-in-out infinite;
        }

        @keyframes mistDrift {
            0%, 100% { transform: translateX(0); opacity: 0.7; }
            50% { transform: translateX(-40px); opacity: 1; }
        }

        /* 神圣光柱 - 穿透树冠的光 */
        .forest-light-shafts {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .light-shaft {
            position: absolute;
            top: -20%;
            width: 60px;
            height: 120%;
            background: linear-gradient(180deg,
                rgba(255, 255, 200, 0.15) 0%,
                rgba(255, 255, 180, 0.08) 30%,
                rgba(255, 255, 150, 0.03) 60%,
                transparent 100%);
            transform: rotate(5deg);
            animation: shaftShimmer 8s ease-in-out infinite;
        }

        .light-shaft::before {
            content: '';
            position: absolute;
            inset: 0;
            background: inherit;
            filter: blur(20px);
        }

        .light-shaft-1 { left: 15%; animation-delay: 0s; width: 40px; }
        .light-shaft-2 { left: 35%; animation-delay: -2s; width: 50px; transform: rotate(3deg); }
        .light-shaft-3 { left: 55%; animation-delay: -4s; width: 70px; transform: rotate(-2deg); }
        .light-shaft-4 { left: 75%; animation-delay: -6s; width: 45px; transform: rotate(4deg); }

        @keyframes shaftShimmer {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        /* 萤火虫 - 梦幻漂浮的光点 */
        .forest-fireflies {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .firefly {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(200, 255, 150, 1) 0%, rgba(150, 255, 100, 0.6) 40%, transparent 70%);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(180, 255, 120, 0.8), 0 0 20px rgba(150, 255, 100, 0.4);
            animation: fireflyFloat 8s ease-in-out infinite;
        }

        .firefly::after {
            content: '';
            position: absolute;
            inset: -8px;
            background: radial-gradient(circle, rgba(180, 255, 120, 0.3) 0%, transparent 70%);
            animation: fireflyGlow 2s ease-in-out infinite;
        }

        .firefly-1 { left: 10%; top: 30%; animation-delay: 0s; animation-duration: 7s; }
        .firefly-2 { left: 25%; top: 50%; animation-delay: -1s; animation-duration: 9s; }
        .firefly-3 { left: 40%; top: 25%; animation-delay: -2s; animation-duration: 6s; }
        .firefly-4 { left: 55%; top: 45%; animation-delay: -3s; animation-duration: 8s; }
        .firefly-5 { left: 70%; top: 35%; animation-delay: -4s; animation-duration: 10s; }
        .firefly-6 { left: 85%; top: 55%; animation-delay: -5s; animation-duration: 7s; }
        .firefly-7 { left: 15%; top: 60%; animation-delay: -6s; animation-duration: 9s; }
        .firefly-8 { left: 60%; top: 20%; animation-delay: -7s; animation-duration: 8s; }
        .firefly-9 { left: 80%; top: 40%; animation-delay: -2.5s; animation-duration: 11s; }
        .firefly-10 { left: 35%; top: 65%; animation-delay: -4.5s; animation-duration: 7.5s; }

        @keyframes fireflyFloat {
            0% { transform: translate(0, 0) scale(1); opacity: 0.3; }
            25% { transform: translate(30px, -20px) scale(1.2); opacity: 1; }
            50% { transform: translate(-10px, -40px) scale(0.8); opacity: 0.6; }
            75% { transform: translate(-25px, -15px) scale(1.1); opacity: 0.9; }
            100% { transform: translate(0, 0) scale(1); opacity: 0.3; }
        }

        @keyframes fireflyGlow {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        /* 飘落的花瓣/叶片 */
        .forest-petals {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .petal {
            position: absolute;
            width: 8px;
            height: 12px;
            background: linear-gradient(135deg, rgba(200, 255, 180, 0.6) 0%, rgba(150, 220, 130, 0.4) 100%);
            border-radius: 50% 0 50% 0;
            animation: petalFall 15s linear infinite;
            opacity: 0;
        }

        .petal-1 { left: 10%; animation-delay: 0s; }
        .petal-2 { left: 30%; animation-delay: -3s; width: 6px; height: 10px; }
        .petal-3 { left: 50%; animation-delay: -6s; }
        .petal-4 { left: 70%; animation-delay: -9s; width: 10px; height: 14px; }
        .petal-5 { left: 90%; animation-delay: -12s; width: 7px; height: 11px; }

        @keyframes petalFall {
            0% {
                transform: translateY(-20px) rotate(0deg) translateX(0);
                opacity: 0;
            }
            10% { opacity: 0.7; }
            90% { opacity: 0.5; }
            100% {
                transform: translateY(100vh) rotate(720deg) translateX(50px);
                opacity: 0;
            }
        }

        /* 魔法粒子尘埃 */
        .forest-magic-dust {
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(1px 1px at 50px 80px, rgba(200, 255, 180, 0.8), transparent),
                radial-gradient(1px 1px at 150px 120px, rgba(180, 255, 160, 0.7), transparent),
                radial-gradient(1.5px 1.5px at 250px 60px, rgba(160, 255, 140, 0.9), transparent),
                radial-gradient(1px 1px at 350px 140px, rgba(200, 255, 200, 0.6), transparent),
                radial-gradient(1px 1px at 450px 90px, rgba(180, 255, 180, 0.8), transparent),
                radial-gradient(1.5px 1.5px at 550px 110px, rgba(160, 255, 160, 0.7), transparent),
                radial-gradient(1px 1px at 650px 70px, rgba(200, 255, 180, 0.6), transparent),
                radial-gradient(1px 1px at 100px 180px, rgba(180, 255, 160, 0.5), transparent),
                radial-gradient(1px 1px at 300px 200px, rgba(200, 255, 180, 0.6), transparent),
                radial-gradient(1px 1px at 500px 160px, rgba(160, 255, 140, 0.7), transparent),
                radial-gradient(1.5px 1.5px at 700px 190px, rgba(180, 255, 170, 0.5), transparent);
            background-size: 800px 280px;
            animation: magicDustFloat 20s ease-in-out infinite;
        }

        @keyframes magicDustFloat {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0.6; }
            33% { transform: translateY(-10px) translateX(5px); opacity: 0.9; }
            66% { transform: translateY(-5px) translateX(-8px); opacity: 0.7; }
        }

        .world-tree {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 100%;
            opacity: 0.85;
        }

        /* ===== 森林三个独特入口 ===== */

        /* 洞见 - 智慧古树眼 */
        .forest-insight {
            position: relative;
            width: 80px;
            height: 100px;
        }

        .insight-tree-eye {
            position: relative;
            width: 70px;
            height: 70px;
        }

        .insight-bark {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background:
                radial-gradient(ellipse at 50% 50%, rgba(60, 40, 30, 0.9) 30%, rgba(40, 25, 15, 0.8) 60%, transparent 70%);
            box-shadow:
                inset 0 0 20px rgba(0, 0, 0, 0.5),
                0 0 30px rgba(100, 200, 100, 0.3);
        }

        .insight-eye-socket {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 45px;
            height: 30px;
            background: radial-gradient(ellipse, rgba(20, 60, 40, 0.9) 0%, rgba(10, 30, 20, 0.8) 100%);
            border-radius: 50%;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.6);
            overflow: hidden;
        }

        .insight-iris {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 25px;
            height: 25px;
            background: radial-gradient(circle,
                rgba(100, 255, 150, 0.9) 0%,
                rgba(50, 200, 100, 0.8) 40%,
                rgba(30, 150, 70, 0.7) 70%,
                rgba(20, 100, 50, 0.6) 100%);
            border-radius: 50%;
            box-shadow:
                0 0 15px rgba(100, 255, 150, 0.6),
                0 0 30px rgba(50, 200, 100, 0.4);
            animation: insightIrisPulse 3s ease-in-out infinite;
        }

        .insight-pupil {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #000 60%, rgba(0, 50, 30, 0.8) 100%);
            border-radius: 50%;
        }

        .insight-pupil::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 3px;
            height: 3px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }

        .insight-vines {
            position: absolute;
            inset: -15px;
        }

        .insight-vine {
            position: absolute;
            width: 3px;
            height: 25px;
            background: linear-gradient(to bottom, rgba(80, 150, 80, 0.7), rgba(60, 120, 60, 0.4));
            border-radius: 2px;
        }

        .insight-vine:nth-child(1) { top: 0; left: 30%; transform: rotate(-20deg); }
        .insight-vine:nth-child(2) { top: 5px; right: 25%; transform: rotate(25deg); }
        .insight-vine:nth-child(3) { bottom: 10px; left: 20%; transform: rotate(15deg); height: 20px; }
        .insight-vine:nth-child(4) { bottom: 5px; right: 20%; transform: rotate(-18deg); height: 22px; }

        .insight-glow-ring {
            position: absolute;
            inset: -20px;
            border: 2px solid rgba(100, 255, 150, 0.3);
            border-radius: 50%;
            animation: insightRingPulse 4s ease-in-out infinite;
        }

        @keyframes insightIrisPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        @keyframes insightRingPulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.15); opacity: 0.8; }
        }

        /* Starlight - 生命之花 */
        .forest-lifeflower {
            position: relative;
            width: 100px;
            height: 110px;
        }

        .lifeflower-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            background: radial-gradient(circle,
                rgba(255, 255, 200, 0.95) 0%,
                rgba(200, 255, 150, 0.8) 50%,
                rgba(150, 230, 100, 0.6) 100%);
            border-radius: 50%;
            box-shadow:
                0 0 20px rgba(200, 255, 150, 0.8),
                0 0 40px rgba(150, 255, 100, 0.5),
                0 0 60px rgba(100, 200, 80, 0.3);
            animation: lifeflowerPulse 2s ease-in-out infinite;
        }

        .lifeflower-petal {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 45px;
            background: linear-gradient(to top,
                rgba(150, 255, 150, 0.1) 0%,
                rgba(180, 255, 180, 0.5) 40%,
                rgba(200, 255, 200, 0.7) 70%,
                rgba(220, 255, 220, 0.4) 100%);
            border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
            transform-origin: center bottom;
            animation: petalSway 4s ease-in-out infinite;
        }

        .lifeflower-petal:nth-child(1) { transform: translate(-50%, -100%) rotate(0deg); }
        .lifeflower-petal:nth-child(2) { transform: translate(-50%, -100%) rotate(45deg); animation-delay: -0.5s; }
        .lifeflower-petal:nth-child(3) { transform: translate(-50%, -100%) rotate(90deg); animation-delay: -1s; }
        .lifeflower-petal:nth-child(4) { transform: translate(-50%, -100%) rotate(135deg); animation-delay: -1.5s; }
        .lifeflower-petal:nth-child(5) { transform: translate(-50%, -100%) rotate(180deg); animation-delay: -2s; }
        .lifeflower-petal:nth-child(6) { transform: translate(-50%, -100%) rotate(225deg); animation-delay: -2.5s; }
        .lifeflower-petal:nth-child(7) { transform: translate(-50%, -100%) rotate(270deg); animation-delay: -3s; }
        .lifeflower-petal:nth-child(8) { transform: translate(-50%, -100%) rotate(315deg); animation-delay: -3.5s; }

        .lifeflower-aura {
            position: absolute;
            inset: -30px;
            background: radial-gradient(circle,
                rgba(150, 255, 150, 0.15) 0%,
                rgba(100, 200, 100, 0.08) 50%,
                transparent 70%);
            animation: auraBreath 3s ease-in-out infinite;
        }

        .lifeflower-sparkles span {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(200, 255, 180, 0.9);
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(180, 255, 150, 0.8);
            animation: sparkleOrbit 6s linear infinite;
        }

        .lifeflower-sparkles span:nth-child(1) { animation-delay: 0s; }
        .lifeflower-sparkles span:nth-child(2) { animation-delay: -1.5s; }
        .lifeflower-sparkles span:nth-child(3) { animation-delay: -3s; }
        .lifeflower-sparkles span:nth-child(4) { animation-delay: -4.5s; }

        @keyframes lifeflowerPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 20px rgba(200, 255, 150, 0.8), 0 0 40px rgba(150, 255, 100, 0.5); }
            50% { transform: translate(-50%, -50%) scale(1.15); box-shadow: 0 0 30px rgba(200, 255, 150, 1), 0 0 60px rgba(150, 255, 100, 0.7); }
        }

        @keyframes petalSway {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        @keyframes auraBreath {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        @keyframes sparkleOrbit {
            0% { transform: rotate(0deg) translateX(45px) rotate(0deg); opacity: 0.5; }
            50% { opacity: 1; }
            100% { transform: rotate(360deg) translateX(45px) rotate(-360deg); opacity: 0.5; }
        }

        /* 我的传奇 - 精灵蝶 */
        .forest-spirit-butterfly {
            position: relative;
            width: 90px;
            height: 90px;
        }

        .butterfly-body {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 35px;
            background: linear-gradient(to bottom,
                rgba(100, 200, 150, 0.9) 0%,
                rgba(80, 180, 130, 0.8) 50%,
                rgba(60, 150, 100, 0.7) 100%);
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(100, 200, 150, 0.6);
        }

        .butterfly-wing {
            position: absolute;
            top: 50%;
            width: 40px;
            height: 55px;
            background: radial-gradient(ellipse at 70% 50%,
                rgba(150, 255, 200, 0.7) 0%,
                rgba(100, 220, 150, 0.5) 40%,
                rgba(80, 180, 120, 0.3) 70%,
                transparent 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: wingFlutter 0.8s ease-in-out infinite;
        }

        .butterfly-wing.left {
            right: 50%;
            transform: translateY(-60%) rotateY(0deg) skewY(-5deg);
            transform-origin: right center;
        }

        .butterfly-wing.right {
            left: 50%;
            transform: translateY(-60%) rotateY(0deg) skewY(5deg);
            transform-origin: left center;
            animation-delay: -0.1s;
        }

        .butterfly-wing::before {
            content: '';
            position: absolute;
            inset: 5px;
            background: radial-gradient(ellipse at 60% 40%,
                rgba(200, 255, 220, 0.5) 0%,
                rgba(150, 230, 180, 0.3) 50%,
                transparent 80%);
            border-radius: inherit;
        }

        .butterfly-wing-lower {
            position: absolute;
            top: 55%;
            width: 30px;
            height: 35px;
            background: radial-gradient(ellipse at 60% 40%,
                rgba(120, 230, 170, 0.6) 0%,
                rgba(80, 180, 130, 0.4) 50%,
                transparent 100%);
            border-radius: 40% 40% 60% 60%;
            animation: wingFlutterLower 0.8s ease-in-out infinite;
        }

        .butterfly-wing-lower.left {
            right: 50%;
            transform: translateY(-30%) rotate(-15deg);
            transform-origin: right top;
        }

        .butterfly-wing-lower.right {
            left: 50%;
            transform: translateY(-30%) rotate(15deg);
            transform-origin: left top;
            animation-delay: -0.1s;
        }

        .butterfly-trail {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
        }

        .butterfly-trail span {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(150, 255, 200, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(150, 255, 200, 0.6);
            animation: trailFloat 3s ease-out infinite;
        }

        .butterfly-trail span:nth-child(1) { bottom: 0; left: 40%; animation-delay: 0s; }
        .butterfly-trail span:nth-child(2) { bottom: 10%; left: 55%; animation-delay: -0.5s; }
        .butterfly-trail span:nth-child(3) { bottom: 20%; left: 35%; animation-delay: -1s; }
        .butterfly-trail span:nth-child(4) { bottom: 5%; left: 60%; animation-delay: -1.5s; }
        .butterfly-trail span:nth-child(5) { bottom: 15%; left: 45%; animation-delay: -2s; }

        @keyframes wingFlutter {
            0%, 100% { transform: translateY(-60%) rotateY(0deg) scaleX(1); }
            50% { transform: translateY(-60%) rotateY(30deg) scaleX(0.7); }
        }

        @keyframes wingFlutterLower {
            0%, 100% { transform: translateY(-30%) rotate(-15deg) scaleX(1); }
            50% { transform: translateY(-30%) rotate(-15deg) scaleX(0.75); }
        }

        @keyframes trailFloat {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-30px) scale(0); opacity: 0; }
        }

        /* 森林入口通用样式 */
        .forest-entry .entry-name {
            color: rgba(180, 255, 180, 1);
            text-shadow: 0 0 15px rgba(100, 200, 100, 0.8), 0 0 30px rgba(50, 150, 50, 0.5);
            font-size: 15px;
        }

        .forest-entry:hover .entry-name {
            text-shadow: 0 0 20px rgba(150, 255, 150, 1), 0 0 40px rgba(100, 200, 100, 0.7);
        }

        .forest-entry:hover .insight-iris {
            box-shadow: 0 0 25px rgba(100, 255, 150, 0.9), 0 0 50px rgba(50, 200, 100, 0.6);
        }

        .forest-entry:hover .lifeflower-center {
            box-shadow: 0 0 30px rgba(200, 255, 150, 1), 0 0 60px rgba(150, 255, 100, 0.8), 0 0 90px rgba(100, 200, 80, 0.5);
        }

        .forest-entry:hover .butterfly-wing {
            animation-duration: 0.4s;
        }

        /* ========================================
           Angel Scene - 天界圣殿（梦幻细腻版）
           ======================================== */
        .scene-angel {
            background:
                radial-gradient(ellipse at 50% 0%, rgba(255, 250, 240, 0.95) 0%, transparent 50%),
                radial-gradient(ellipse at 30% 20%, rgba(255, 245, 220, 0.3) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 20%, rgba(255, 240, 210, 0.3) 0%, transparent 40%),
                linear-gradient(180deg, #fffef8 0%, #fff9e8 20%, #fff5d8 50%, #ffeecc 100%);
        }

        .angel-layer {
            position: absolute;
            inset: 0;
        }

        /* 神圣光晕 - 多层次发光 */
        .angel-divine-glow {
            position: absolute;
            top: -10%;
            left: 50%;
            transform: translateX(-50%);
            width: 120%;
            height: 80%;
            background:
                radial-gradient(ellipse 60% 50% at 50% 20%, rgba(255, 255, 255, 0.9) 0%, transparent 50%),
                radial-gradient(ellipse 80% 60% at 50% 25%, rgba(255, 250, 220, 0.6) 0%, transparent 60%),
                radial-gradient(ellipse 100% 70% at 50% 30%, rgba(255, 240, 180, 0.3) 0%, transparent 70%);
            animation: divineGlowPulse 6s ease-in-out infinite;
        }

        @keyframes divineGlowPulse {
            0%, 100% { opacity: 0.8; transform: translateX(-50%) scale(1); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.05); }
        }

        /* 飘落的羽毛 */
        .angel-feathers {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .feather {
            position: absolute;
            width: 12px;
            height: 30px;
            background: linear-gradient(to bottom,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(255, 250, 240, 0.7) 50%,
                rgba(255, 245, 230, 0.4) 100%);
            border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: featherFall 20s linear infinite;
            opacity: 0;
        }

        .feather::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 10%;
            width: 1px;
            height: 80%;
            background: linear-gradient(to bottom, rgba(255, 220, 180, 0.6), transparent);
        }

        .feather-1 { left: 8%; animation-delay: 0s; }
        .feather-2 { left: 22%; animation-delay: -4s; width: 10px; height: 25px; }
        .feather-3 { left: 38%; animation-delay: -8s; }
        .feather-4 { left: 52%; animation-delay: -12s; width: 14px; height: 35px; }
        .feather-5 { left: 68%; animation-delay: -16s; width: 11px; height: 28px; }
        .feather-6 { left: 85%; animation-delay: -3s; }
        .feather-7 { left: 15%; animation-delay: -7s; width: 9px; height: 22px; }
        .feather-8 { left: 75%; animation-delay: -11s; }

        @keyframes featherFall {
            0% {
                transform: translateY(-30px) rotate(0deg) translateX(0);
                opacity: 0;
            }
            5% { opacity: 0.8; }
            50% {
                transform: translateY(45vh) rotate(180deg) translateX(30px);
                opacity: 0.6;
            }
            95% { opacity: 0.4; }
            100% {
                transform: translateY(100vh) rotate(360deg) translateX(-20px);
                opacity: 0;
            }
        }

        /* 圣光粒子 */
        .angel-holy-particles {
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(2px 2px at 80px 60px, rgba(255, 230, 180, 0.9), transparent),
                radial-gradient(1.5px 1.5px at 160px 100px, rgba(255, 220, 160, 0.8), transparent),
                radial-gradient(2px 2px at 240px 40px, rgba(255, 215, 0, 0.7), transparent),
                radial-gradient(1.5px 1.5px at 320px 120px, rgba(255, 240, 200, 0.85), transparent),
                radial-gradient(2px 2px at 400px 80px, rgba(255, 225, 170, 0.75), transparent),
                radial-gradient(1px 1px at 480px 50px, rgba(255, 235, 190, 0.9), transparent),
                radial-gradient(2px 2px at 560px 110px, rgba(255, 215, 0, 0.65), transparent),
                radial-gradient(1.5px 1.5px at 640px 70px, rgba(255, 230, 180, 0.8), transparent),
                radial-gradient(2px 2px at 720px 130px, rgba(255, 220, 160, 0.7), transparent),
                radial-gradient(1px 1px at 120px 150px, rgba(255, 240, 200, 0.6), transparent),
                radial-gradient(1.5px 1.5px at 280px 180px, rgba(255, 225, 170, 0.75), transparent),
                radial-gradient(1px 1px at 440px 160px, rgba(255, 215, 0, 0.6), transparent),
                radial-gradient(2px 2px at 600px 190px, rgba(255, 235, 190, 0.7), transparent);
            background-size: 800px 250px;
            animation: holyParticlesFloat 15s ease-in-out infinite;
        }

        @keyframes holyParticlesFloat {
            0%, 100% { transform: translateY(0); opacity: 0.6; }
            50% { transform: translateY(-15px); opacity: 1; }
        }

        /* 云朵层 - 更细腻 */
        .angel-clouds-layer {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .cloud-wisp {
            position: absolute;
            width: 200%;
            height: 100%;
            background-repeat: repeat-x;
        }

        .cloud-wisp-1 {
            bottom: 5%;
            background-image:
                radial-gradient(ellipse 150px 60px at 100px 90%, rgba(255,255,255,0.85), transparent),
                radial-gradient(ellipse 120px 50px at 300px 85%, rgba(255,255,255,0.75), transparent),
                radial-gradient(ellipse 180px 70px at 550px 92%, rgba(255,255,255,0.8), transparent),
                radial-gradient(ellipse 100px 40px at 750px 88%, rgba(255,255,255,0.7), transparent);
            background-size: 900px 100%;
            animation: wispFloat 80s linear infinite;
        }

        .cloud-wisp-2 {
            bottom: 15%;
            background-image:
                radial-gradient(ellipse 100px 45px at 50px 50%, rgba(255,255,255,0.7), transparent),
                radial-gradient(ellipse 140px 55px at 250px 55%, rgba(255,255,255,0.65), transparent),
                radial-gradient(ellipse 90px 38px at 450px 48%, rgba(255,255,255,0.6), transparent),
                radial-gradient(ellipse 130px 52px at 650px 52%, rgba(255,255,255,0.7), transparent);
            background-size: 800px 100%;
            animation: wispFloat 60s linear infinite reverse;
        }

        .cloud-wisp-3 {
            bottom: 25%;
            background-image:
                radial-gradient(ellipse 80px 35px at 150px 50%, rgba(255,255,255,0.6), transparent),
                radial-gradient(ellipse 110px 48px at 400px 55%, rgba(255,255,255,0.55), transparent),
                radial-gradient(ellipse 70px 30px at 600px 48%, rgba(255,255,255,0.5), transparent);
            background-size: 750px 100%;
            animation: wispFloat 50s linear infinite;
        }

        @keyframes wispFloat {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }

        /* 神圣光柱 */
        .angel-light-pillars {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .light-pillar {
            position: absolute;
            top: -10%;
            width: 80px;
            height: 100%;
            background: linear-gradient(180deg,
                rgba(255, 230, 180, 0.2) 0%,
                rgba(255, 220, 150, 0.12) 30%,
                rgba(255, 215, 130, 0.06) 60%,
                transparent 100%);
            animation: pillarShimmer 8s ease-in-out infinite;
        }

        .light-pillar::before {
            content: '';
            position: absolute;
            inset: 0;
            background: inherit;
            filter: blur(30px);
        }

        .light-pillar-1 { left: 20%; animation-delay: 0s; width: 60px; }
        .light-pillar-2 { left: 40%; animation-delay: -2s; width: 100px; }
        .light-pillar-3 { left: 60%; animation-delay: -4s; width: 70px; }
        .light-pillar-4 { left: 80%; animation-delay: -6s; width: 50px; }

        @keyframes pillarShimmer {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        /* 光环涟漪 */
        .angel-halo-ripples {
            position: absolute;
            top: 5%;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 150px;
        }

        .halo-ripple {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            animation: rippleExpand 4s ease-out infinite;
        }

        .halo-ripple:nth-child(1) { width: 60px; height: 30px; animation-delay: 0s; }
        .halo-ripple:nth-child(2) { width: 60px; height: 30px; animation-delay: -1s; }
        .halo-ripple:nth-child(3) { width: 60px; height: 30px; animation-delay: -2s; }
        .halo-ripple:nth-child(4) { width: 60px; height: 30px; animation-delay: -3s; }

        @keyframes rippleExpand {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.6;
            }
            100% {
                transform: translate(-50%, -50%) scale(4);
                opacity: 0;
            }
        }

        /* ===== 天使三个独特入口 ===== */

        /* 洞见 - 神圣之眼 */
        .angel-divine-eye {
            position: relative;
            width: 85px;
            height: 85px;
        }

        .divine-eye-outer {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle,
                rgba(255, 255, 255, 0.95) 0%,
                rgba(255, 250, 230, 0.8) 40%,
                rgba(255, 240, 200, 0.4) 70%,
                transparent 100%);
            border-radius: 50%;
            box-shadow:
                0 0 30px rgba(255, 230, 180, 0.6),
                0 0 60px rgba(255, 215, 0, 0.3);
            animation: divineEyePulse 3s ease-in-out infinite;
        }

        .divine-eye-rays {
            position: absolute;
            inset: -20px;
        }

        .divine-eye-rays span {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 3px;
            height: 25px;
            background: linear-gradient(to top, transparent, rgba(255, 215, 0, 0.6), transparent);
            transform-origin: center bottom;
            animation: rayPulse 2s ease-in-out infinite;
        }

        .divine-eye-rays span:nth-child(1) { transform: translate(-50%, -100%) rotate(0deg); }
        .divine-eye-rays span:nth-child(2) { transform: translate(-50%, -100%) rotate(45deg); animation-delay: -0.25s; }
        .divine-eye-rays span:nth-child(3) { transform: translate(-50%, -100%) rotate(90deg); animation-delay: -0.5s; }
        .divine-eye-rays span:nth-child(4) { transform: translate(-50%, -100%) rotate(135deg); animation-delay: -0.75s; }
        .divine-eye-rays span:nth-child(5) { transform: translate(-50%, -100%) rotate(180deg); animation-delay: -1s; }
        .divine-eye-rays span:nth-child(6) { transform: translate(-50%, -100%) rotate(225deg); animation-delay: -1.25s; }
        .divine-eye-rays span:nth-child(7) { transform: translate(-50%, -100%) rotate(270deg); animation-delay: -1.5s; }
        .divine-eye-rays span:nth-child(8) { transform: translate(-50%, -100%) rotate(315deg); animation-delay: -1.75s; }

        .divine-eye-iris {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 35px;
            height: 35px;
            background: radial-gradient(circle,
                rgba(255, 215, 0, 0.95) 0%,
                rgba(255, 180, 50, 0.8) 50%,
                rgba(200, 150, 50, 0.6) 100%);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .divine-eye-pupil {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, #2a1a00 60%, #5a4a20 100%);
            border-radius: 50%;
        }

        .divine-eye-pupil::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
        }

        @keyframes divineEyePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        @keyframes rayPulse {
            0%, 100% { opacity: 0.4; height: 25px; }
            50% { opacity: 0.8; height: 30px; }
        }

        /* Starlight - 六翼天使 */
        .angel-seraphim {
            position: relative;
            width: 110px;
            height: 120px;
        }

        .seraphim-core {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 50px;
            background: radial-gradient(ellipse at 50% 40%,
                rgba(255, 255, 255, 0.98) 0%,
                rgba(255, 250, 230, 0.9) 50%,
                rgba(255, 240, 200, 0.7) 100%);
            border-radius: 50% 50% 45% 45%;
            box-shadow:
                0 0 30px rgba(255, 255, 255, 0.9),
                0 0 60px rgba(255, 230, 180, 0.5);
            animation: seraphimFloat 3s ease-in-out infinite;
        }

        .seraphim-halo {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 18px;
            border: 3px solid rgba(255, 215, 0, 0.9);
            border-radius: 50%;
            box-shadow:
                0 0 15px rgba(255, 215, 0, 0.8),
                0 0 30px rgba(255, 200, 100, 0.5),
                inset 0 0 10px rgba(255, 215, 0, 0.3);
            animation: haloGlowAngel 2s ease-in-out infinite;
        }

        .seraphim-wing {
            position: absolute;
            background: linear-gradient(to right,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(255, 250, 240, 0.7) 50%,
                rgba(255, 245, 230, 0.3) 100%);
            border-radius: 50% 50% 0 50%;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .seraphim-wing.top-left {
            top: 15%;
            right: 55%;
            width: 45px;
            height: 35px;
            transform: rotate(-30deg);
            animation: wingTop 2.5s ease-in-out infinite;
        }

        .seraphim-wing.top-right {
            top: 15%;
            left: 55%;
            width: 45px;
            height: 35px;
            transform: rotate(30deg) scaleX(-1);
            animation: wingTop 2.5s ease-in-out infinite reverse;
        }

        .seraphim-wing.mid-left {
            top: 35%;
            right: 60%;
            width: 55px;
            height: 45px;
            transform: rotate(-15deg);
            animation: wingMid 3s ease-in-out infinite;
        }

        .seraphim-wing.mid-right {
            top: 35%;
            left: 60%;
            width: 55px;
            height: 45px;
            transform: rotate(15deg) scaleX(-1);
            animation: wingMid 3s ease-in-out infinite reverse;
        }

        .seraphim-wing.bottom-left {
            top: 55%;
            right: 55%;
            width: 40px;
            height: 30px;
            transform: rotate(10deg);
            animation: wingBottom 2.8s ease-in-out infinite;
        }

        .seraphim-wing.bottom-right {
            top: 55%;
            left: 55%;
            width: 40px;
            height: 30px;
            transform: rotate(-10deg) scaleX(-1);
            animation: wingBottom 2.8s ease-in-out infinite reverse;
        }

        .seraphim-glow {
            position: absolute;
            inset: -25px;
            background: radial-gradient(circle,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 240, 200, 0.15) 50%,
                transparent 70%);
            animation: seraphimGlow 4s ease-in-out infinite;
        }

        @keyframes seraphimFloat {
            0%, 100% { transform: translate(-50%, -50%) translateY(0); }
            50% { transform: translate(-50%, -50%) translateY(-8px); }
        }

        @keyframes haloGlowAngel {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 200, 100, 0.5); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 1), 0 0 50px rgba(255, 200, 100, 0.7); }
        }

        @keyframes wingTop {
            0%, 100% { transform: rotate(-30deg) scaleY(1); }
            50% { transform: rotate(-35deg) scaleY(0.95); }
        }

        @keyframes wingMid {
            0%, 100% { transform: rotate(-15deg) scaleY(1); }
            50% { transform: rotate(-18deg) scaleY(0.97); }
        }

        @keyframes wingBottom {
            0%, 100% { transform: rotate(10deg) scaleY(1); }
            50% { transform: rotate(12deg) scaleY(0.96); }
        }

        @keyframes seraphimGlow {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        /* 我的传奇 - 命运之书 */
        .angel-destiny-book {
            position: relative;
            width: 80px;
            height: 95px;
        }

        .destiny-book-cover {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 55px;
            height: 70px;
            background: linear-gradient(135deg,
                rgba(255, 250, 240, 0.95) 0%,
                rgba(255, 240, 210, 0.9) 50%,
                rgba(255, 230, 180, 0.85) 100%);
            border-radius: 3px 8px 8px 3px;
            box-shadow:
                -3px 0 8px rgba(200, 180, 150, 0.3),
                0 0 20px rgba(255, 230, 180, 0.5),
                0 0 40px rgba(255, 215, 0, 0.3);
            animation: bookFloat 3s ease-in-out infinite;
        }

        .destiny-book-cover::before {
            content: '';
            position: absolute;
            left: 3px;
            top: 5px;
            bottom: 5px;
            width: 2px;
            background: linear-gradient(to bottom,
                rgba(200, 170, 120, 0.6),
                rgba(180, 150, 100, 0.4),
                rgba(200, 170, 120, 0.6));
        }

        .destiny-book-pages {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 48px;
            height: 62px;
            background: repeating-linear-gradient(to right,
                rgba(255, 255, 255, 0.9) 0px,
                rgba(255, 255, 255, 0.9) 2px,
                rgba(240, 235, 220, 0.8) 2px,
                rgba(240, 235, 220, 0.8) 4px);
            border-radius: 0 5px 5px 0;
        }

        .destiny-book-glyph {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: rgba(180, 150, 80, 0.8);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: glyphPulse 2s ease-in-out infinite;
        }

        .destiny-book-sparkles span {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 215, 0, 0.9);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255, 200, 100, 0.8);
            animation: bookSparkle 3s ease-in-out infinite;
        }

        .destiny-book-sparkles span:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
        .destiny-book-sparkles span:nth-child(2) { top: 5%; right: 25%; animation-delay: -0.5s; }
        .destiny-book-sparkles span:nth-child(3) { bottom: 15%; left: 15%; animation-delay: -1s; }
        .destiny-book-sparkles span:nth-child(4) { bottom: 10%; right: 20%; animation-delay: -1.5s; }
        .destiny-book-sparkles span:nth-child(5) { top: 50%; left: 5%; animation-delay: -2s; }
        .destiny-book-sparkles span:nth-child(6) { top: 50%; right: 5%; animation-delay: -2.5s; }

        .destiny-book-aura {
            position: absolute;
            inset: -20px;
            background: radial-gradient(circle,
                rgba(255, 230, 180, 0.2) 0%,
                rgba(255, 215, 0, 0.1) 50%,
                transparent 70%);
            animation: bookAura 4s ease-in-out infinite;
        }

        @keyframes bookFloat {
            0%, 100% { transform: translate(-50%, -50%) translateY(0) rotate(-2deg); }
            50% { transform: translate(-50%, -50%) translateY(-8px) rotate(2deg); }
        }

        @keyframes glyphPulse {
            0%, 100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        }

        @keyframes bookSparkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes bookAura {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.15); }
        }

        /* 天使入口通用样式 */
        .angel-entry .entry-name {
            color: rgba(139, 119, 42, 1);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.7), 0 0 30px rgba(255, 200, 100, 0.4);
            font-size: 15px;
        }

        .angel-entry:hover .entry-name {
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.9), 0 0 40px rgba(255, 200, 100, 0.6);
        }

        .angel-entry:hover .divine-eye-outer {
            box-shadow: 0 0 40px rgba(255, 230, 180, 0.8), 0 0 80px rgba(255, 215, 0, 0.5);
        }

        .angel-entry:hover .seraphim-core {
            box-shadow: 0 0 40px rgba(255, 255, 255, 1), 0 0 80px rgba(255, 230, 180, 0.7);
        }

        .angel-entry:hover .destiny-book-cover {
            box-shadow: -3px 0 8px rgba(200, 180, 150, 0.3), 0 0 30px rgba(255, 230, 180, 0.8), 0 0 60px rgba(255, 215, 0, 0.5);
        }

        /* ========================================
           Passion Scene - 凤凰涅槃（梦幻细腻版）
           ======================================== */
        .scene-passion {
            background:
                radial-gradient(ellipse at 50% 100%, rgba(80, 20, 0, 0.6) 0%, transparent 50%),
                radial-gradient(ellipse at 30% 80%, rgba(60, 10, 0, 0.4) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 80%, rgba(70, 15, 0, 0.4) 0%, transparent 40%),
                linear-gradient(180deg, #080202 0%, #120404 25%, #1a0606 50%, #100303 100%);
        }

        .passion-layer {
            position: absolute;
            inset: 0;
        }

        /* 深渊熔岩 - 底部流动的岩浆 */
        .passion-magma {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 120px;
            background:
                radial-gradient(ellipse 100% 80% at 50% 100%, rgba(255, 120, 0, 0.5) 0%, transparent 70%),
                radial-gradient(ellipse 60% 50% at 25% 100%, rgba(255, 80, 0, 0.4) 0%, transparent 60%),
                radial-gradient(ellipse 60% 50% at 75% 100%, rgba(255, 100, 0, 0.4) 0%, transparent 60%);
            animation: magmaPulse 4s ease-in-out infinite;
        }

        @keyframes magmaPulse {
            0%, 100% { opacity: 0.7; transform: scaleY(1); }
            50% { opacity: 1; transform: scaleY(1.1); }
        }

        /* 岩浆气泡 */
        .passion-bubbles {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            overflow: hidden;
        }

        .magma-bubble {
            position: absolute;
            bottom: 20px;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle at 30% 30%,
                rgba(255, 200, 100, 0.9) 0%,
                rgba(255, 150, 50, 0.7) 40%,
                rgba(255, 100, 0, 0.5) 70%,
                transparent 100%);
            border-radius: 50%;
            animation: bubbleRise 4s ease-in-out infinite;
            opacity: 0;
        }

        .magma-bubble-1 { left: 10%; animation-delay: 0s; width: 12px; height: 12px; }
        .magma-bubble-2 { left: 25%; animation-delay: -1s; width: 18px; height: 18px; }
        .magma-bubble-3 { left: 40%; animation-delay: -2s; }
        .magma-bubble-4 { left: 55%; animation-delay: -0.5s; width: 10px; height: 10px; }
        .magma-bubble-5 { left: 70%; animation-delay: -1.5s; width: 14px; height: 14px; }
        .magma-bubble-6 { left: 85%; animation-delay: -2.5s; width: 16px; height: 16px; }
        .magma-bubble-7 { left: 18%; animation-delay: -3s; width: 11px; height: 11px; }
        .magma-bubble-8 { left: 62%; animation-delay: -3.5s; }

        @keyframes bubbleRise {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { opacity: 0.8; transform: scale(1); }
            80% { opacity: 0.6; }
            100% { transform: translateY(-150px) scale(0.3); opacity: 0; }
        }

        /* 飘舞的火花 */
        .passion-sparks {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .spark {
            position: absolute;
            bottom: 50px;
            width: 3px;
            height: 3px;
            background: rgba(255, 220, 150, 0.95);
            border-radius: 50%;
            box-shadow:
                0 0 6px rgba(255, 180, 50, 0.9),
                0 0 12px rgba(255, 150, 0, 0.6);
            animation: sparkFloat 6s ease-out infinite;
            opacity: 0;
        }

        .spark::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 15px;
            background: linear-gradient(to top, rgba(255, 200, 100, 0.8), transparent);
        }

        .spark-1 { left: 8%; animation-delay: 0s; }
        .spark-2 { left: 18%; animation-delay: -1s; }
        .spark-3 { left: 28%; animation-delay: -2s; }
        .spark-4 { left: 38%; animation-delay: -0.5s; }
        .spark-5 { left: 48%; animation-delay: -1.5s; }
        .spark-6 { left: 58%; animation-delay: -2.5s; }
        .spark-7 { left: 68%; animation-delay: -3s; }
        .spark-8 { left: 78%; animation-delay: -0.8s; }
        .spark-9 { left: 88%; animation-delay: -1.8s; }
        .spark-10 { left: 95%; animation-delay: -2.3s; }

        @keyframes sparkFloat {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            100% {
                transform: translateY(-400px) translateX(30px) rotate(180deg);
                opacity: 0;
            }
        }

        /* 热浪扭曲效果 */
        .passion-heat-distortion {
            position: absolute;
            inset: 0;
            background: linear-gradient(0deg,
                rgba(255, 100, 0, 0.08) 0%,
                rgba(255, 80, 0, 0.04) 20%,
                transparent 50%);
            animation: heatDistort 3s ease-in-out infinite;
        }

        @keyframes heatDistort {
            0%, 100% { transform: scaleY(1) translateY(0); }
            50% { transform: scaleY(1.02) translateY(-2px); }
        }

        /* 凤凰羽毛 - 飘落的火焰羽毛 */
        .passion-phoenix-feathers {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .phoenix-feather {
            position: absolute;
            width: 15px;
            height: 40px;
            background: linear-gradient(to bottom,
                rgba(255, 200, 100, 0.8) 0%,
                rgba(255, 150, 50, 0.6) 30%,
                rgba(255, 100, 0, 0.4) 60%,
                rgba(255, 50, 0, 0.2) 100%);
            border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
            box-shadow:
                0 0 10px rgba(255, 150, 50, 0.5),
                0 0 20px rgba(255, 100, 0, 0.3);
            animation: phoenixFeatherFall 12s linear infinite;
            opacity: 0;
        }

        .phoenix-feather::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 15%;
            width: 1px;
            height: 70%;
            background: linear-gradient(to bottom, rgba(255, 220, 150, 0.8), rgba(255, 100, 0, 0.4));
        }

        .phoenix-feather-1 { left: 12%; animation-delay: 0s; }
        .phoenix-feather-2 { left: 30%; animation-delay: -3s; width: 12px; height: 32px; }
        .phoenix-feather-3 { left: 50%; animation-delay: -6s; width: 18px; height: 45px; }
        .phoenix-feather-4 { left: 70%; animation-delay: -9s; }
        .phoenix-feather-5 { left: 88%; animation-delay: -2s; width: 14px; height: 36px; }

        @keyframes phoenixFeatherFall {
            0% {
                transform: translateY(-50px) rotate(-30deg) translateX(0);
                opacity: 0;
            }
            5% { opacity: 0.9; }
            50% {
                transform: translateY(45vh) rotate(30deg) translateX(40px);
                opacity: 0.7;
            }
            100% {
                transform: translateY(100vh) rotate(-30deg) translateX(-20px);
                opacity: 0;
            }
        }

        /* 火焰光环层 */
        .passion-flame-aura {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 200px;
            background: radial-gradient(ellipse,
                rgba(255, 100, 0, 0.1) 0%,
                rgba(255, 50, 0, 0.05) 50%,
                transparent 70%);
            animation: flameAuraPulse 5s ease-in-out infinite;
        }

        @keyframes flameAuraPulse {
            0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.5; }
            50% { transform: translateX(-50%) scale(1.2); opacity: 0.8; }
        }

        /* 细腻的火焰粒子 */
        .passion-fire-particles {
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(1.5px 1.5px at 60px 200px, rgba(255, 220, 150, 0.9), transparent),
                radial-gradient(2px 2px at 140px 180px, rgba(255, 180, 80, 0.85), transparent),
                radial-gradient(1px 1px at 220px 220px, rgba(255, 150, 50, 0.8), transparent),
                radial-gradient(1.5px 1.5px at 300px 190px, rgba(255, 200, 100, 0.85), transparent),
                radial-gradient(2px 2px at 380px 210px, rgba(255, 170, 70, 0.8), transparent),
                radial-gradient(1px 1px at 460px 175px, rgba(255, 140, 40, 0.9), transparent),
                radial-gradient(1.5px 1.5px at 540px 195px, rgba(255, 190, 90, 0.85), transparent),
                radial-gradient(2px 2px at 620px 185px, rgba(255, 160, 60, 0.8), transparent),
                radial-gradient(1px 1px at 700px 205px, rgba(255, 210, 120, 0.9), transparent),
                radial-gradient(1.5px 1.5px at 100px 160px, rgba(255, 130, 30, 0.75), transparent),
                radial-gradient(1px 1px at 250px 150px, rgba(255, 180, 80, 0.7), transparent),
                radial-gradient(2px 2px at 400px 140px, rgba(255, 200, 100, 0.75), transparent),
                radial-gradient(1px 1px at 550px 155px, rgba(255, 150, 50, 0.8), transparent),
                radial-gradient(1.5px 1.5px at 680px 145px, rgba(255, 170, 70, 0.7), transparent);
            background-size: 800px 280px;
            animation: fireParticlesRise 8s linear infinite;
        }

        @keyframes fireParticlesRise {
            from { transform: translateY(0); opacity: 0.7; }
            to { transform: translateY(-60px); opacity: 0; }
        }

        /* ===== 激情三个独特入口 ===== */

        /* 洞见 - 燃烧之眼 */
        .passion-burning-eye {
            position: relative;
            width: 85px;
            height: 85px;
        }

        .burning-eye-flames {
            position: absolute;
            inset: -15px;
        }

        .burning-eye-flames span {
            position: absolute;
            bottom: 20%;
            width: 8px;
            height: 25px;
            background: linear-gradient(to top,
                rgba(255, 200, 100, 0.8) 0%,
                rgba(255, 150, 50, 0.5) 50%,
                transparent 100%);
            border-radius: 50% 50% 0 0;
            animation: eyeFlameDance 0.8s ease-in-out infinite alternate;
        }

        .burning-eye-flames span:nth-child(1) { left: 15%; height: 20px; animation-delay: 0s; }
        .burning-eye-flames span:nth-child(2) { left: 30%; height: 28px; animation-delay: -0.1s; }
        .burning-eye-flames span:nth-child(3) { left: 45%; height: 32px; animation-delay: -0.2s; }
        .burning-eye-flames span:nth-child(4) { left: 60%; height: 28px; animation-delay: -0.3s; }
        .burning-eye-flames span:nth-child(5) { left: 75%; height: 22px; animation-delay: -0.4s; }

        .burning-eye-orb {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 55px;
            height: 55px;
            background: radial-gradient(circle,
                rgba(255, 100, 0, 0.9) 0%,
                rgba(200, 50, 0, 0.8) 50%,
                rgba(150, 30, 0, 0.6) 100%);
            border-radius: 50%;
            box-shadow:
                0 0 20px rgba(255, 100, 0, 0.7),
                0 0 40px rgba(255, 50, 0, 0.4),
                inset 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .burning-eye-iris {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            background: radial-gradient(circle,
                rgba(255, 220, 100, 0.95) 0%,
                rgba(255, 180, 50, 0.8) 40%,
                rgba(255, 120, 0, 0.6) 100%);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 200, 100, 0.8);
            animation: burningIrisPulse 1.5s ease-in-out infinite;
        }

        .burning-eye-pupil {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 18px;
            background: radial-gradient(ellipse, #000 60%, rgba(50, 0, 0, 0.8) 100%);
            border-radius: 50%;
        }

        @keyframes eyeFlameDance {
            from { transform: scaleY(1) scaleX(1); }
            to { transform: scaleY(1.3) scaleX(0.8); }
        }

        @keyframes burningIrisPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        /* Starlight - 凤凰 */
        .passion-phoenix {
            position: relative;
            width: 110px;
            height: 120px;
        }

        .phoenix-body {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 35px;
            height: 45px;
            background: radial-gradient(ellipse at 50% 40%,
                rgba(255, 220, 150, 0.95) 0%,
                rgba(255, 180, 80, 0.85) 40%,
                rgba(255, 120, 30, 0.7) 100%);
            border-radius: 50% 50% 40% 40%;
            box-shadow:
                0 0 25px rgba(255, 180, 80, 0.8),
                0 0 50px rgba(255, 120, 30, 0.5);
            animation: phoenixFloat 3s ease-in-out infinite;
        }

        .phoenix-head {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 22px;
            background: radial-gradient(circle,
                rgba(255, 240, 200, 0.95) 0%,
                rgba(255, 200, 100, 0.85) 100%);
            border-radius: 50% 50% 45% 45%;
            box-shadow: 0 0 15px rgba(255, 200, 100, 0.7);
        }

        .phoenix-crest {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
        }

        .phoenix-crest span {
            position: absolute;
            bottom: 0;
            width: 4px;
            height: 20px;
            background: linear-gradient(to top,
                rgba(255, 180, 80, 0.9) 0%,
                rgba(255, 120, 30, 0.6) 50%,
                transparent 100%);
            border-radius: 50% 50% 0 0;
        }

        .phoenix-crest span:nth-child(1) { left: -8px; height: 15px; transform: rotate(-20deg); }
        .phoenix-crest span:nth-child(2) { left: 0; height: 22px; }
        .phoenix-crest span:nth-child(3) { left: 8px; height: 15px; transform: rotate(20deg); }

        .phoenix-wing {
            position: absolute;
            top: 35%;
            width: 45px;
            height: 50px;
            background: linear-gradient(to right,
                rgba(255, 180, 80, 0.85) 0%,
                rgba(255, 120, 30, 0.6) 50%,
                rgba(255, 80, 0, 0.3) 100%);
            border-radius: 0 70% 50% 50%;
            animation: phoenixWingFlap 1.5s ease-in-out infinite;
        }

        .phoenix-wing.left {
            right: 55%;
            transform: rotate(-25deg) scaleX(-1);
            transform-origin: right center;
        }

        .phoenix-wing.right {
            left: 55%;
            transform: rotate(25deg);
            transform-origin: left center;
            animation-delay: -0.1s;
        }

        .phoenix-tail {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
        }

        .phoenix-tail span {
            position: absolute;
            top: 0;
            width: 6px;
            height: 40px;
            background: linear-gradient(to bottom,
                rgba(255, 180, 80, 0.9) 0%,
                rgba(255, 120, 30, 0.7) 40%,
                rgba(255, 80, 0, 0.4) 70%,
                transparent 100%);
            border-radius: 50% 50% 50% 50% / 20% 20% 80% 80%;
            animation: tailSway 2s ease-in-out infinite;
        }

        .phoenix-tail span:nth-child(1) { left: -15px; height: 35px; transform: rotate(-15deg); animation-delay: 0s; }
        .phoenix-tail span:nth-child(2) { left: -5px; height: 45px; transform: rotate(-5deg); animation-delay: -0.3s; }
        .phoenix-tail span:nth-child(3) { left: 5px; height: 45px; transform: rotate(5deg); animation-delay: -0.6s; }
        .phoenix-tail span:nth-child(4) { left: 15px; height: 35px; transform: rotate(15deg); animation-delay: -0.9s; }

        .phoenix-glow {
            position: absolute;
            inset: -30px;
            background: radial-gradient(circle,
                rgba(255, 150, 50, 0.25) 0%,
                rgba(255, 100, 0, 0.1) 50%,
                transparent 70%);
            animation: phoenixGlow 3s ease-in-out infinite;
        }

        @keyframes phoenixFloat {
            0%, 100% { transform: translate(-50%, -50%) translateY(0); }
            50% { transform: translate(-50%, -50%) translateY(-10px); }
        }

        @keyframes phoenixWingFlap {
            0%, 100% { transform: rotate(-25deg) scaleX(-1) scaleY(1); }
            50% { transform: rotate(-35deg) scaleX(-1) scaleY(0.9); }
        }

        @keyframes tailSway {
            0%, 100% { transform: rotate(-15deg) scaleY(1); }
            50% { transform: rotate(-18deg) scaleY(1.1); }
        }

        @keyframes phoenixGlow {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.9; transform: scale(1.15); }
        }

        /* 我的传奇 - 永恒之焰 */
        .passion-eternal-flame {
            position: relative;
            width: 85px;
            height: 100px;
        }

        .eternal-flame-base {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 15px;
            background: linear-gradient(to bottom,
                rgba(100, 50, 30, 0.9) 0%,
                rgba(60, 30, 15, 0.8) 100%);
            border-radius: 5px 5px 8px 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
        }

        .eternal-flame-core {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 50px;
            background: linear-gradient(to top,
                rgba(255, 220, 150, 0.95) 0%,
                rgba(255, 180, 80, 0.9) 30%,
                rgba(255, 120, 30, 0.8) 60%,
                rgba(255, 80, 0, 0.5) 80%,
                transparent 100%);
            border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
            box-shadow:
                0 0 30px rgba(255, 180, 80, 0.7),
                0 0 60px rgba(255, 120, 30, 0.4);
            animation: eternalFlameCore 0.8s ease-in-out infinite alternate;
        }

        .eternal-flame-outer {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 65px;
            background: linear-gradient(to top,
                rgba(255, 150, 50, 0.6) 0%,
                rgba(255, 100, 0, 0.4) 40%,
                rgba(255, 50, 0, 0.2) 70%,
                transparent 100%);
            border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
            animation: eternalFlameOuter 1s ease-in-out infinite alternate;
        }

        .eternal-flame-wisps span {
            position: absolute;
            bottom: 60%;
            width: 5px;
            height: 20px;
            background: linear-gradient(to top,
                rgba(255, 200, 100, 0.7) 0%,
                rgba(255, 150, 50, 0.4) 50%,
                transparent 100%);
            border-radius: 50%;
            animation: wispFloat 2s ease-out infinite;
        }

        .eternal-flame-wisps span:nth-child(1) { left: 35%; animation-delay: 0s; }
        .eternal-flame-wisps span:nth-child(2) { left: 50%; animation-delay: -0.5s; height: 25px; }
        .eternal-flame-wisps span:nth-child(3) { left: 65%; animation-delay: -1s; }

        .eternal-flame-sparkles span {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 220, 150, 0.95);
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(255, 180, 80, 0.8);
            animation: flameSparkle 1.5s ease-out infinite;
        }

        .eternal-flame-sparkles span:nth-child(1) { bottom: 50%; left: 30%; animation-delay: 0s; }
        .eternal-flame-sparkles span:nth-child(2) { bottom: 60%; left: 50%; animation-delay: -0.3s; }
        .eternal-flame-sparkles span:nth-child(3) { bottom: 55%; left: 70%; animation-delay: -0.6s; }
        .eternal-flame-sparkles span:nth-child(4) { bottom: 70%; left: 40%; animation-delay: -0.9s; }
        .eternal-flame-sparkles span:nth-child(5) { bottom: 65%; left: 60%; animation-delay: -1.2s; }

        @keyframes eternalFlameCore {
            from { transform: translateX(-50%) scaleY(1) scaleX(1); }
            to { transform: translateX(-50%) scaleY(1.15) scaleX(0.9); }
        }

        @keyframes eternalFlameOuter {
            from { transform: translateX(-50%) scaleY(1) scaleX(1) rotate(-2deg); }
            to { transform: translateX(-50%) scaleY(1.1) scaleX(0.95) rotate(2deg); }
        }

        @keyframes wispFloat {
            0% { transform: translateY(0) scale(1); opacity: 0.7; }
            100% { transform: translateY(-40px) scale(0.3); opacity: 0; }
        }

        @keyframes flameSparkle {
            0% { transform: translateY(0) scale(1); opacity: 0.9; }
            100% { transform: translateY(-30px) scale(0); opacity: 0; }
        }

        /* 激情入口通用样式 */
        .passion-entry .entry-name {
            color: rgba(255, 200, 120, 1);
            text-shadow: 0 0 15px rgba(255, 120, 30, 0.9), 0 0 30px rgba(255, 80, 0, 0.5);
            font-size: 15px;
        }

        .passion-entry:hover .entry-name {
            text-shadow: 0 0 20px rgba(255, 150, 50, 1), 0 0 40px rgba(255, 100, 0, 0.7);
        }

        .passion-entry:hover .burning-eye-orb {
            box-shadow: 0 0 30px rgba(255, 100, 0, 0.9), 0 0 60px rgba(255, 50, 0, 0.6);
        }

        .passion-entry:hover .phoenix-body {
            box-shadow: 0 0 35px rgba(255, 180, 80, 1), 0 0 70px rgba(255, 120, 30, 0.7);
        }

        .passion-entry:hover .eternal-flame-core {
            box-shadow: 0 0 40px rgba(255, 180, 80, 0.9), 0 0 80px rgba(255, 120, 30, 0.6);
        }

        /* Scene Portal 响应式 */
        @media (max-width: 768px) {
            /* 调整内容区域顶部间距 */
            .app-container {
                padding-top: 280px;
            }

            /* 入口元素在屏幕上半部分 */
            .entry-left { left: 8%; top: 140px; }
            .entry-center { top: 110px; }
            .entry-right { right: 8%; top: 140px; }

            .galaxy-main-star { width: 60px; height: 60px; }
            .galaxy-main-star .star-rays { inset: -25px; }
            .galaxy-main-star.featured { width: 80px; height: 80px; }
            .galaxy-main-star.featured .star-rays { inset: -35px; }

            .sacred-leaf { width: 50px; height: 62px; }
            .sacred-leaf::after { inset: -12px; }
            .sacred-leaf.featured { width: 65px; height: 81px; }

            .celestial-angel { width: 70px; height: 80px; }
            .celestial-angel .angel-body { font-size: 45px; }
            .celestial-angel .angel-wings { width: 100px; height: 45px; }
            .celestial-angel .angel-halo { width: 45px; height: 15px; }
            .celestial-angel.featured { width: 90px; height: 100px; }
            .celestial-angel.featured .angel-body { font-size: 58px; }
            .celestial-angel.featured .angel-wings { width: 130px; height: 55px; }

            .fire-spirit-orb { width: 60px; height: 70px; }
            .fire-spirit-orb .spirit-core { font-size: 48px; }
            .fire-spirit-orb .spirit-flame { inset: -20px; }
            .fire-spirit-orb.featured { width: 80px; height: 90px; }
            .fire-spirit-orb.featured .spirit-core { font-size: 62px; }
            .fire-spirit-orb.featured .spirit-flame { inset: -30px; }

            .portal-entry .entry-name { font-size: 13px; letter-spacing: 1px; }

            /* 场景渐变遮罩调整 */
            .scene::after {
                background: linear-gradient(
                    180deg,
                    transparent 0%,
                    transparent 20%,
                    rgba(var(--bg-rgb, 10, 10, 15), 0.4) 35%,
                    rgba(var(--bg-rgb, 10, 10, 15), 0.75) 50%,
                    rgba(var(--bg-rgb, 10, 10, 15), 0.95) 70%,
                    var(--bg-0) 100%
                );
            }
        }

        /* 超小屏幕 */
        @media (max-width: 480px) {
            .app-container {
                padding-top: 220px;
            }

            .entry-left { left: 5%; top: 100px; }
            .entry-center { top: 70px; }
            .entry-right { right: 5%; top: 100px; }

            .galaxy-main-star { width: 45px; height: 45px; }
            .galaxy-main-star.featured { width: 60px; height: 60px; }

            .sacred-leaf { width: 38px; height: 47px; }
            .sacred-leaf.featured { width: 50px; height: 62px; }

            .celestial-angel { width: 55px; height: 65px; }
            .celestial-angel .angel-body { font-size: 38px; }
            .celestial-angel.featured { width: 70px; height: 80px; }
            .celestial-angel.featured .angel-body { font-size: 48px; }

            .fire-spirit-orb { width: 48px; height: 55px; }
            .fire-spirit-orb .spirit-core { font-size: 40px; }
            .fire-spirit-orb.featured { width: 62px; height: 70px; }
            .fire-spirit-orb.featured .spirit-core { font-size: 52px; }

            .portal-entry .entry-name { font-size: 11px; }
        }

        /* 时光回廊入口按钮 */
        .corridor-entry-btn {
            background: var(--surface-2);
            border: 1px solid var(--border-1);
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .corridor-entry-btn:hover {
            background: var(--surface-3);
            border-color: var(--primary-2);
            transform: scale(1.05);
        }

        /* ========== 时光回廊页面样式 ========== */
        .corridor-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, var(--bg-1) 0%, rgba(88, 86, 214, 0.05) 100%);
            z-index: 1000;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .corridor-page.active {
            transform: translateX(0);
        }

        .corridor-page-header {
            position: sticky;
            top: 0;
            background: linear-gradient(180deg, var(--bg-1), rgba(var(--bg-1-rgb), 0.95));
            backdrop-filter: blur(12px);
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }

        .corridor-page-title {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .corridor-title-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 8px rgba(88, 86, 214, 0.5));
        }

        .corridor-title-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .corridor-title-main {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-1);
            background: linear-gradient(135deg, var(--text-1), var(--primary-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .corridor-title-sub {
            font-size: 0.8rem;
            color: var(--text-3);
            font-weight: 400;
        }

        .corridor-back-btn {
            background: var(--surface-2);
            border: none;
            padding: 10px 18px;
            border-radius: 10px;
            color: var(--text-2);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .corridor-back-btn:hover {
            background: var(--surface-3);
            color: var(--text-1);
        }

        .corridor-controls {
            padding: 20px 24px;
            background: var(--surface-1);
            border-bottom: 1px solid var(--border-1);
        }

        .corridor-stats {
            display: flex;
            gap: 24px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .corridor-stat {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            background: var(--surface-2);
            border-radius: 12px;
            min-width: 100px;
        }

        .corridor-stat-icon {
            font-size: 1.2rem;
        }

        .corridor-stat-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .corridor-stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-2);
        }

        .corridor-stat-label {
            font-size: 0.75rem;
            color: var(--text-3);
        }

        .corridor-progress-row {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .corridor-progress-bar {
            flex: 1;
            height: 8px;
            background: var(--surface-2);
            border-radius: 4px;
            overflow: hidden;
        }

        .corridor-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(118, 75, 162, 0.4);
        }

        .corridor-btn-group {
            display: flex;
            gap: 10px;
        }

        .corridor-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .corridor-btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 12px rgba(118, 75, 162, 0.3);
        }

        .corridor-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.4);
        }

        .corridor-btn-secondary {
            background: var(--surface-2);
            color: var(--text-2);
            border: 1px solid var(--border-1);
        }

        .corridor-btn-secondary:hover {
            background: var(--surface-3);
            color: var(--text-1);
        }

        .corridor-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* 时间线装饰 */
        .corridor-timeline {
            position: relative;
            padding: 0 24px;
            display: none;
        }

        .corridor-timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--primary-2), transparent);
            transform: translateX(-50%);
        }

        /* 时间分组 */
        .corridor-time-group {
            margin-bottom: 32px;
        }

        .corridor-time-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 24px;
            position: sticky;
            top: 76px;
            background: rgba(var(--bg-1-rgb), 0.9);
            backdrop-filter: blur(8px);
            z-index: 5;
            border-bottom: 1px solid var(--border-1);
        }

        .corridor-time-dot {
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(118, 75, 162, 0.5);
        }

        .corridor-time-label {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-2);
        }

        .corridor-time-count {
            font-size: 0.8rem;
            color: var(--text-3);
            margin-left: auto;
        }

        /* 画廊网格 */
        .corridor-gallery {
            padding: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        .corridor-card {
            background: var(--surface-1);
            border: 1px solid var(--border-1);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .corridor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .corridor-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        }

        .corridor-card:hover::before {
            opacity: 1;
        }

        .corridor-card-image {
            width: 100%;
            aspect-ratio: 4/3;
            object-fit: cover;
            cursor: pointer;
            background: var(--surface-2);
        }

        .corridor-card-image.generating {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            animation: corridorPulse 2s ease-in-out infinite;
            background: linear-gradient(135deg, var(--surface-2), var(--surface-3));
        }

        @keyframes corridorPulse {
            0%, 100% {
                opacity: 0.6;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        .corridor-card-content {
            padding: 16px;
        }

        .corridor-card-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-1);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .corridor-card-meta {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-1);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            color: var(--text-3);
        }

        .corridor-card-date {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .corridor-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 80px 20px;
            color: var(--text-2);
        }

        .corridor-empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px rgba(88, 86, 214, 0.3));
        }

        .corridor-empty-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .corridor-empty-text {
            font-size: 1rem;
            margin-bottom: 20px;
        }

        /* 图片预览模态框 */
        .image-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .image-preview-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .image-preview-modal img {
            max-width: 90%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 8px;
        }

        .image-preview-text {
            max-width: 600px;
            margin-top: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            line-height: 1.6;
            text-align: center;
        }

        .image-preview-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-preview-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            .corridor-gallery {
                grid-template-columns: 1fr;
                padding: 12px;
                gap: 16px;
            }

            .corridor-stats {
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="theme-bg">
        <div class="halo-orb"></div>
        <div class="halo-orb"></div>
        <div class="halo-orb"></div>
        <div class="halo-orb"></div>
        <div class="halo-orb"></div>
        <div class="stars"></div>
    </div>

    <div class="app-container">
        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-inner">
                <div class="nav-brand">
                    <span class="nav-logo">Jotmo</span>
                    <span class="nav-tagline">capture moments</span>
                </div>
                <div class="nav-actions">
                <!-- Theme Switcher (Collapsible) -->
                <div class="theme-dropdown" id="themeDropdown">
                    <button class="theme-current" onclick="toggleThemeDropdown()">
                        <span class="theme-current-icon" id="currentThemeIcon">&#127756;</span>
                        <svg class="theme-dropdown-arrow" width="12" height="12" viewBox="0 0 16 16" fill="none">
                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="theme-options" id="themeOptions">
                        <button class="theme-option active" data-theme="galaxy" onclick="selectTheme('galaxy', '&#127756;')">
                            <span class="icon">&#127756;</span>
                            <span class="label">Galaxy</span>
                        </button>
                        <button class="theme-option" data-theme="forest" onclick="selectTheme('forest', '&#127795;')">
                            <span class="icon">&#127795;</span>
                            <span class="label">Forest</span>
                        </button>
                        <button class="theme-option" data-theme="angel" onclick="selectTheme('angel', '&#128124;')">
                            <span class="icon">&#128124;</span>
                            <span class="label">Angel</span>
                        </button>
                        <button class="theme-option" data-theme="passion" onclick="selectTheme('passion', '&#128293;')">
                            <span class="icon">&#128293;</span>
                            <span class="label">Passion</span>
                        </button>
                    </div>
                </div>

                <!-- User Menu -->
                <div class="nav-user hidden" id="navUser">
                    <button class="user-button" id="userButton">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span class="user-name" id="userName">User</span>
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <button class="dropdown-item" onclick="logout()">Log out</button>
                    </div>
                </div>
            </div>
            </div>
        </nav>

        <!-- Auth Section -->
        <section class="auth-section" id="authSection">
            <div class="glass-card auth-card">
                <div class="auth-header">
                    <h1 class="auth-title" id="authTitle">Welcome back</h1>
                    <p class="auth-subtitle" id="authSubtitle">Enter your credentials to continue</p>
                </div>
                <div id="authMessage"></div>
                <form id="authForm">
                    <div class="form-group">
                        <label class="form-label" for="username">Username</label>
                        <input type="text" id="username" class="form-input" placeholder="your username" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="password">Password</label>
                        <input type="password" id="password" class="form-input" placeholder="your password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn-primary" id="authBtn">Sign in</button>
                </form>
                <p class="auth-switch">
                    <span id="switchText">New here? </span>
                    <a class="auth-switch-link" onclick="toggleAuthMode()" id="switchLink">Create account</a>
                </p>
            </div>
        </section>

        <!-- Notes Section -->
        <section class="notes-section" id="notesSection">
            <!-- Theme Scene Portal - 沉浸式主题场景 -->
            <div class="scene-portal" id="scenePortal">
                <!-- ========== Galaxy Scene - 细腻梦幻星河 ========== -->
                <div class="scene scene-galaxy">
                    <!-- 深空背景 -->
                    <div class="galaxy-layer galaxy-deep"></div>

                    <!-- 宇宙极光 -->
                    <div class="galaxy-aurora"></div>

                    <!-- 星云层 -->
                    <div class="galaxy-layer galaxy-nebula"></div>
                    <div class="galaxy-layer galaxy-nebula-2"></div>

                    <!-- 星云丝带 -->
                    <div class="galaxy-nebula-wisps">
                        <div class="nebula-wisp wisp-1"></div>
                        <div class="nebula-wisp wisp-2"></div>
                        <div class="nebula-wisp wisp-3"></div>
                    </div>

                    <!-- 银河带 -->
                    <div class="galaxy-layer galaxy-milkyway"></div>
                    <div class="galaxy-milkyway-particles"></div>

                    <!-- 宇宙薄雾层 -->
                    <div class="galaxy-mist">
                        <div class="galaxy-mist-layer mist-cosmic-1"></div>
                        <div class="galaxy-mist-layer mist-cosmic-2"></div>
                        <div class="galaxy-mist-layer mist-cosmic-3"></div>
                    </div>

                    <!-- 多层星星 -->
                    <div class="galaxy-stars-container galaxy-stars-far"></div>
                    <div class="galaxy-stars-container galaxy-stars-mid"></div>
                    <div class="galaxy-stars-container galaxy-stars-near"></div>

                    <!-- 十字光芒主星 -->
                    <div class="galaxy-bright-star bright-star-1"></div>
                    <div class="galaxy-bright-star bright-star-2"></div>
                    <div class="galaxy-bright-star bright-star-3"></div>

                    <!-- 螺旋星系 -->
                    <div class="spiral-galaxy spiral-1"></div>
                    <div class="spiral-galaxy spiral-2"></div>
                    <div class="spiral-galaxy spiral-3"></div>

                    <!-- 星团簇 -->
                    <div class="star-cluster cluster-1"></div>
                    <div class="star-cluster cluster-2"></div>
                    <div class="star-cluster cluster-3"></div>

                    <!-- 远方星系团 -->
                    <div class="distant-galaxy dg-1"></div>
                    <div class="distant-galaxy dg-2"></div>
                    <div class="distant-galaxy dg-3"></div>
                    <div class="distant-galaxy dg-4"></div>
                    <div class="distant-galaxy dg-5"></div>

                    <!-- 精致流星 -->
                    <div class="galaxy-shooting-star"></div>
                    <div class="galaxy-shooting-star delay-1"></div>
                    <div class="galaxy-shooting-star delay-2"></div>
                    <div class="galaxy-shooting-star delay-3"></div>
                    <div class="galaxy-shooting-star delay-4"></div>

                    <!-- 宇宙尘埃 -->
                    <div class="cosmic-dust"></div>

                    <!-- 星光粒子飘浮 -->
                    <div class="stardust-particles">
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                        <div class="stardust"></div>
                    </div>

                    <!-- 三颗独特主星入口 -->
                    <!-- 洞见 - 蓝色智慧之眼 -->
                    <div class="portal-entry galaxy-entry entry-left" onclick="openInsights()">
                        <div class="star-insight">
                            <div class="insight-orbit"></div>
                            <div class="insight-orbit orbit-2"></div>
                            <div class="insight-glow"></div>
                            <div class="insight-core">
                                <div class="insight-pupil"></div>
                            </div>
                        </div>
                        <span class="entry-name">洞见</span>
                    </div>

                    <!-- Starlight - 金色超新星 -->
                    <div class="portal-entry galaxy-entry entry-center" onclick="triggerStarlight()">
                        <div class="star-supernova">
                            <div class="supernova-corona"></div>
                            <div class="supernova-flare flare-1"></div>
                            <div class="supernova-flare flare-2"></div>
                            <div class="supernova-flare flare-3"></div>
                            <div class="supernova-flare flare-4"></div>
                            <div class="supernova-core"></div>
                            <div class="supernova-center"></div>
                        </div>
                        <span class="entry-name">星光</span>
                    </div>

                    <!-- 我的传奇 - 紫色命运星云 -->
                    <div class="portal-entry galaxy-entry entry-right" onclick="openBiography()">
                        <div class="star-destiny">
                            <div class="destiny-trail"></div>
                            <div class="destiny-ring"></div>
                            <div class="destiny-ring ring-2"></div>
                            <div class="destiny-core"></div>
                            <div class="destiny-sparkles">
                                <span></span><span></span><span></span>
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                        <span class="entry-name">我的传奇</span>
                    </div>
                </div>

                <!-- ========== Forest Scene - 世界树 ========== -->
                <div class="scene scene-forest">
                    <!-- 极光层 -->
                    <div class="forest-aurora"></div>

                    <!-- 多层薄雾 -->
                    <div class="forest-mist-layer mist-far"></div>
                    <div class="forest-mist-layer mist-mid"></div>
                    <div class="forest-mist-layer mist-near"></div>

                    <!-- 神圣光柱 -->
                    <div class="forest-light-shafts">
                        <div class="light-shaft light-shaft-1"></div>
                        <div class="light-shaft light-shaft-2"></div>
                        <div class="light-shaft light-shaft-3"></div>
                        <div class="light-shaft light-shaft-4"></div>
                    </div>

                    <!-- 萤火虫 -->
                    <div class="forest-fireflies">
                        <div class="firefly firefly-1"></div>
                        <div class="firefly firefly-2"></div>
                        <div class="firefly firefly-3"></div>
                        <div class="firefly firefly-4"></div>
                        <div class="firefly firefly-5"></div>
                        <div class="firefly firefly-6"></div>
                        <div class="firefly firefly-7"></div>
                        <div class="firefly firefly-8"></div>
                        <div class="firefly firefly-9"></div>
                        <div class="firefly firefly-10"></div>
                    </div>

                    <!-- 飘落花瓣 -->
                    <div class="forest-petals">
                        <div class="petal petal-1"></div>
                        <div class="petal petal-2"></div>
                        <div class="petal petal-3"></div>
                        <div class="petal petal-4"></div>
                        <div class="petal petal-5"></div>
                    </div>

                    <!-- 魔法尘埃 -->
                    <div class="forest-magic-dust"></div>

                    <!-- 世界树 SVG -->
                    <svg class="world-tree" viewBox="0 0 800 300" preserveAspectRatio="xMidYMax slice">
                        <defs>
                            <linearGradient id="trunkGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#4a3728"/>
                                <stop offset="100%" style="stop-color:#2d1f15"/>
                            </linearGradient>
                            <radialGradient id="crownGrad" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" style="stop-color:#5daa68;stop-opacity:0.9"/>
                                <stop offset="70%" style="stop-color:#2d5a34;stop-opacity:0.6"/>
                                <stop offset="100%" style="stop-color:#1a3d1f;stop-opacity:0.2"/>
                            </radialGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="3" result="blur"/>
                                <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                        </defs>
                        <path d="M400 300 Q380 280 370 300 M400 300 Q420 280 430 300 M400 300 Q360 270 340 300 M400 300 Q440 270 460 300" stroke="url(#trunkGrad)" stroke-width="8" fill="none" opacity="0.6"/>
                        <path d="M400 300 L400 180 Q400 160 400 140" stroke="url(#trunkGrad)" stroke-width="20" fill="none" stroke-linecap="round"/>
                        <path d="M400 200 Q350 180 280 160 M400 200 Q450 180 520 160" stroke="url(#trunkGrad)" stroke-width="10" fill="none" stroke-linecap="round"/>
                        <path d="M400 170 Q330 140 250 120 M400 170 Q470 140 550 120" stroke="url(#trunkGrad)" stroke-width="8" fill="none" stroke-linecap="round"/>
                        <path d="M400 150 Q360 120 300 80 M400 150 Q440 120 500 80" stroke="url(#trunkGrad)" stroke-width="6" fill="none" stroke-linecap="round"/>
                        <path d="M320 145 Q290 130 260 140 M480 145 Q510 130 540 140" stroke="url(#trunkGrad)" stroke-width="4" fill="none" opacity="0.7"/>
                        <path d="M350 125 Q320 100 290 90 M450 125 Q480 100 510 90" stroke="url(#trunkGrad)" stroke-width="3" fill="none" opacity="0.6"/>
                        <ellipse cx="400" cy="100" rx="200" ry="100" fill="url(#crownGrad)" filter="url(#glow)"/>
                        <ellipse cx="300" cy="130" rx="80" ry="50" fill="url(#crownGrad)" opacity="0.5"/>
                        <ellipse cx="500" cy="130" rx="80" ry="50" fill="url(#crownGrad)" opacity="0.5"/>
                    </svg>

                    <!-- 洞见 - 智慧古树眼 -->
                    <div class="portal-entry forest-entry entry-left" onclick="openInsights()">
                        <div class="forest-insight">
                            <div class="insight-tree-eye">
                                <div class="insight-bark"></div>
                                <div class="insight-eye-socket">
                                    <div class="insight-iris">
                                        <div class="insight-pupil"></div>
                                    </div>
                                </div>
                                <div class="insight-vines">
                                    <div class="insight-vine"></div>
                                    <div class="insight-vine"></div>
                                    <div class="insight-vine"></div>
                                    <div class="insight-vine"></div>
                                </div>
                                <div class="insight-glow-ring"></div>
                            </div>
                        </div>
                        <span class="entry-name">洞见</span>
                    </div>

                    <!-- Starlight - 生命之花 -->
                    <div class="portal-entry forest-entry entry-center" onclick="triggerStarlight()">
                        <div class="forest-lifeflower">
                            <div class="lifeflower-aura"></div>
                            <div class="lifeflower-petal"></div>
                            <div class="lifeflower-petal"></div>
                            <div class="lifeflower-petal"></div>
                            <div class="lifeflower-petal"></div>
                            <div class="lifeflower-petal"></div>
                            <div class="lifeflower-petal"></div>
                            <div class="lifeflower-petal"></div>
                            <div class="lifeflower-petal"></div>
                            <div class="lifeflower-center"></div>
                            <div class="lifeflower-sparkles">
                                <span></span><span></span><span></span><span></span>
                            </div>
                        </div>
                        <span class="entry-name">星光</span>
                    </div>

                    <!-- 我的传奇 - 精灵蝶 -->
                    <div class="portal-entry forest-entry entry-right" onclick="openBiography()">
                        <div class="forest-spirit-butterfly">
                            <div class="butterfly-trail">
                                <span></span><span></span><span></span><span></span><span></span>
                            </div>
                            <div class="butterfly-wing left"></div>
                            <div class="butterfly-wing right"></div>
                            <div class="butterfly-wing-lower left"></div>
                            <div class="butterfly-wing-lower right"></div>
                            <div class="butterfly-body"></div>
                        </div>
                        <span class="entry-name">我的传奇</span>
                    </div>
                </div>

                <!-- ========== Angel Scene - 天界圣殿 ========== -->
                <div class="scene scene-angel">
                    <!-- 神圣光晕 -->
                    <div class="angel-divine-glow"></div>

                    <!-- 飘落羽毛 -->
                    <div class="angel-feathers">
                        <div class="feather feather-1"></div>
                        <div class="feather feather-2"></div>
                        <div class="feather feather-3"></div>
                        <div class="feather feather-4"></div>
                        <div class="feather feather-5"></div>
                        <div class="feather feather-6"></div>
                        <div class="feather feather-7"></div>
                        <div class="feather feather-8"></div>
                    </div>

                    <!-- 圣光粒子 -->
                    <div class="angel-holy-particles"></div>

                    <!-- 云朵层 -->
                    <div class="angel-clouds-layer">
                        <div class="cloud-wisp cloud-wisp-1"></div>
                        <div class="cloud-wisp cloud-wisp-2"></div>
                        <div class="cloud-wisp cloud-wisp-3"></div>
                    </div>

                    <!-- 神圣光柱 -->
                    <div class="angel-light-pillars">
                        <div class="light-pillar light-pillar-1"></div>
                        <div class="light-pillar light-pillar-2"></div>
                        <div class="light-pillar light-pillar-3"></div>
                        <div class="light-pillar light-pillar-4"></div>
                    </div>

                    <!-- 光环涟漪 -->
                    <div class="angel-halo-ripples">
                        <div class="halo-ripple"></div>
                        <div class="halo-ripple"></div>
                        <div class="halo-ripple"></div>
                        <div class="halo-ripple"></div>
                    </div>

                    <!-- 洞见 - 神圣之眼 -->
                    <div class="portal-entry angel-entry entry-left" onclick="openInsights()">
                        <div class="angel-divine-eye">
                            <div class="divine-eye-outer"></div>
                            <div class="divine-eye-rays">
                                <span></span><span></span><span></span><span></span>
                                <span></span><span></span><span></span><span></span>
                            </div>
                            <div class="divine-eye-iris">
                                <div class="divine-eye-pupil"></div>
                            </div>
                        </div>
                        <span class="entry-name">洞见</span>
                    </div>

                    <!-- Starlight - 六翼天使 -->
                    <div class="portal-entry angel-entry entry-center" onclick="triggerStarlight()">
                        <div class="angel-seraphim">
                            <div class="seraphim-glow"></div>
                            <div class="seraphim-wing top-left"></div>
                            <div class="seraphim-wing top-right"></div>
                            <div class="seraphim-wing mid-left"></div>
                            <div class="seraphim-wing mid-right"></div>
                            <div class="seraphim-wing bottom-left"></div>
                            <div class="seraphim-wing bottom-right"></div>
                            <div class="seraphim-halo"></div>
                            <div class="seraphim-core"></div>
                        </div>
                        <span class="entry-name">星光</span>
                    </div>

                    <!-- 我的传奇 - 命运之书 -->
                    <div class="portal-entry angel-entry entry-right" onclick="openBiography()">
                        <div class="angel-destiny-book">
                            <div class="destiny-book-aura"></div>
                            <div class="destiny-book-cover">
                                <div class="destiny-book-pages"></div>
                                <div class="destiny-book-glyph">✦</div>
                            </div>
                            <div class="destiny-book-sparkles">
                                <span></span><span></span><span></span>
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                        <span class="entry-name">我的传奇</span>
                    </div>
                </div>

                <!-- ========== Passion Scene - 凤凰涅槃 ========== -->
                <div class="scene scene-passion">
                    <!-- 深渊熔岩 -->
                    <div class="passion-magma"></div>

                    <!-- 岩浆气泡 -->
                    <div class="passion-bubbles">
                        <div class="magma-bubble magma-bubble-1"></div>
                        <div class="magma-bubble magma-bubble-2"></div>
                        <div class="magma-bubble magma-bubble-3"></div>
                        <div class="magma-bubble magma-bubble-4"></div>
                        <div class="magma-bubble magma-bubble-5"></div>
                        <div class="magma-bubble magma-bubble-6"></div>
                        <div class="magma-bubble magma-bubble-7"></div>
                        <div class="magma-bubble magma-bubble-8"></div>
                    </div>

                    <!-- 飘舞火花 -->
                    <div class="passion-sparks">
                        <div class="spark spark-1"></div>
                        <div class="spark spark-2"></div>
                        <div class="spark spark-3"></div>
                        <div class="spark spark-4"></div>
                        <div class="spark spark-5"></div>
                        <div class="spark spark-6"></div>
                        <div class="spark spark-7"></div>
                        <div class="spark spark-8"></div>
                        <div class="spark spark-9"></div>
                        <div class="spark spark-10"></div>
                    </div>

                    <!-- 热浪扭曲 -->
                    <div class="passion-heat-distortion"></div>

                    <!-- 凤凰羽毛 -->
                    <div class="passion-phoenix-feathers">
                        <div class="phoenix-feather phoenix-feather-1"></div>
                        <div class="phoenix-feather phoenix-feather-2"></div>
                        <div class="phoenix-feather phoenix-feather-3"></div>
                        <div class="phoenix-feather phoenix-feather-4"></div>
                        <div class="phoenix-feather phoenix-feather-5"></div>
                    </div>

                    <!-- 火焰光环 -->
                    <div class="passion-flame-aura"></div>

                    <!-- 火焰粒子 -->
                    <div class="passion-fire-particles"></div>

                    <!-- 洞见 - 燃烧之眼 -->
                    <div class="portal-entry passion-entry entry-left" onclick="openInsights()">
                        <div class="passion-burning-eye">
                            <div class="burning-eye-flames">
                                <span></span><span></span><span></span><span></span><span></span>
                            </div>
                            <div class="burning-eye-orb">
                                <div class="burning-eye-iris">
                                    <div class="burning-eye-pupil"></div>
                                </div>
                            </div>
                        </div>
                        <span class="entry-name">洞见</span>
                    </div>

                    <!-- Starlight - 凤凰 -->
                    <div class="portal-entry passion-entry entry-center" onclick="triggerStarlight()">
                        <div class="passion-phoenix">
                            <div class="phoenix-glow"></div>
                            <div class="phoenix-tail">
                                <span></span><span></span><span></span><span></span>
                            </div>
                            <div class="phoenix-wing left"></div>
                            <div class="phoenix-wing right"></div>
                            <div class="phoenix-body"></div>
                            <div class="phoenix-head"></div>
                            <div class="phoenix-crest">
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                        <span class="entry-name">星光</span>
                    </div>

                    <!-- 我的传奇 - 永恒之焰 -->
                    <div class="portal-entry passion-entry entry-right" onclick="openBiography()">
                        <div class="passion-eternal-flame">
                            <div class="eternal-flame-base"></div>
                            <div class="eternal-flame-outer"></div>
                            <div class="eternal-flame-core"></div>
                            <div class="eternal-flame-wisps">
                                <span></span><span></span><span></span>
                            </div>
                            <div class="eternal-flame-sparkles">
                                <span></span><span></span><span></span><span></span><span></span>
                            </div>
                        </div>
                        <span class="entry-name">我的传奇</span>
                    </div>
                </div>
            </div>

            <div class="main-layout">
                <!-- Sidebar (Desktop) -->
                <aside class="sidebar">
                    <div class="sidebar-card" id="categoriesCard">
                        <div class="sidebar-header" onclick="toggleSidebarSection('categories')">
                            <span class="sidebar-title">自动分类</span>
                            <div class="sidebar-header-actions">
                                <button class="sidebar-action" id="reclusterBtn" onclick="event.stopPropagation(); triggerRecluster()" title="重新分类">
                                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                        <path d="M1 8a7 7 0 0112.9-3.8M15 8a7 7 0 01-12.9 3.8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        <path d="M14 4V1h-3M2 12v3h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                                <svg class="sidebar-collapse-icon" width="14" height="14" viewBox="0 0 16 16" fill="none">
                                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                        </div>
                        <div class="categories-list sidebar-collapsible" id="categoriesList">
                            <div class="loading"><div class="loading-spinner"></div></div>
                        </div>
                    </div>

                    <!-- Themes Section (用户自定义主题) -->
                    <div class="sidebar-card" id="themesCard" style="margin-top: 12px;">
                        <div class="sidebar-header" onclick="toggleSidebarSection('themes')">
                            <span class="sidebar-title">主题集合</span>
                            <div class="sidebar-header-actions">
                                <button class="sidebar-action" onclick="event.stopPropagation(); showCreateThemeDialog()" title="创建主题">
                                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                </button>
                                <svg class="sidebar-collapse-icon" width="14" height="14" viewBox="0 0 16 16" fill="none">
                                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                        </div>
                        <div class="categories-list sidebar-collapsible" id="themesList">
                            <div class="category-item category-all" onclick="filterByTheme(0)">
                                <span class="category-name">全部快记</span>
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Main Content -->
                <div class="main-content">
                    <!-- Mobile Category Bar -->
                    <div class="mobile-bar">
                        <button class="mobile-category-btn" id="mobileCatBtn" onclick="toggleMobileCategories()">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M2 4h12M2 8h8M2 12h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                            <span class="current-cat" id="currentCatLabel">All Notes</span>
                            <svg width="12" height="12" viewBox="0 0 16 16" fill="none" style="margin-left: auto;">
                                <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="mobile-dropdown" id="mobileDropdown">
                            <div class="mobile-section-label">自动分类</div>
                            <div class="categories-list" id="mobileCategoriesList"></div>
                            <div class="mobile-section-label" style="margin-top: 12px;">
                                主题集合
                                <button class="mobile-add-theme" onclick="showCreateThemeDialog(); toggleMobileCategories();">+</button>
                            </div>
                            <div class="categories-list" id="mobileThemesList"></div>
                        </div>
                    </div>

                    <!-- Search Box -->
                    <div class="search-box">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <circle cx="7" cy="7" r="5" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M11 11l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search notes..." oninput="handleSearch(this.value)">
                        <button class="search-clear" id="searchClear" onclick="clearSearch()" style="display: none;">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                <path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Notes List -->
                    <div class="notes-header">
                        <div>
                            <h3 class="notes-title" id="notesListTitle">Notes</h3>
                        </div>
                        <div class="notes-header-actions">
                            <!-- View Mode Toggle -->
                            <div class="view-mode-toggle">
                                <button class="view-mode-btn active" id="listViewBtn" onclick="setViewMode('list')" title="列表视图">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M2 4h12M2 8h12M2 12h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                </button>
                                <button class="view-mode-btn" id="timelineViewBtn" onclick="setViewMode('timeline')" title="时间轴视图">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 2v12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        <circle cx="8" cy="4" r="2" stroke="currentColor" stroke-width="1.5"/>
                                        <circle cx="8" cy="9" r="2" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M10 4h3M10 9h3M3 4h3M3 9h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>
                            <button class="corridor-entry-btn" onclick="openCorridor()" title="时光回廊">
                                🖼️
                            </button>
                            <div class="more-menu">
                                <button class="btn-more" id="moreBtn" onclick="toggleMoreMenu(event)">
                                    <svg width="18" height="18" viewBox="0 0 16 16" fill="none">
                                        <circle cx="8" cy="3" r="1.5" fill="currentColor"/>
                                        <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
                                        <circle cx="8" cy="13" r="1.5" fill="currentColor"/>
                                    </svg>
                                </button>
                                <div class="more-dropdown" id="moreDropdown">
                                    <button class="more-item" onclick="document.getElementById('importFile').click(); toggleMoreMenu();">
                                        <svg viewBox="0 0 16 16" fill="none">
                                            <path d="M8 2v8m0 0l-3-3m3 3l3-3M2 12v1a1 1 0 001 1h10a1 1 0 001-1v-1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Import Markdown
                                    </button>
                                </div>
                                <input type="file" id="importFile" accept=".md,.txt" style="display:none" onchange="handleImportFile(event)">
                            </div>
                        </div>
                    </div>
                    <div class="notes-list" id="notesList">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <span>Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Bottom Composer (Chat-style) -->
    <div class="bottom-composer" id="bottomComposer">
        <div class="bottom-composer-inner">
            <!-- 知知猫 -->
            <div class="zhizhi-cat" id="zhizhiCat" onclick="toggleZhizhiMode()">
                <div class="cat-body">
                    <div class="cat-head">
                        <div class="cat-ear cat-ear-left"></div>
                        <div class="cat-ear cat-ear-right"></div>
                        <div class="cat-face">
                            <div class="cat-eye cat-eye-left"><div class="cat-pupil"></div></div>
                            <div class="cat-eye cat-eye-right"><div class="cat-pupil"></div></div>
                            <div class="cat-nose"></div>
                            <div class="cat-mouth"></div>
                            <div class="cat-whiskers cat-whiskers-left"></div>
                            <div class="cat-whiskers cat-whiskers-right"></div>
                        </div>
                    </div>
                    <div class="cat-torso"></div>
                    <div class="cat-tail"></div>
                    <div class="cat-paws">
                        <div class="cat-paw cat-paw-left"></div>
                        <div class="cat-paw cat-paw-right"></div>
                    </div>
                </div>
                <div class="cat-zzz">Z<span>z</span><span>z</span></div>
            </div>
            <textarea id="noteContent" class="composer-textarea" placeholder="记录此刻的想法..." rows="1"></textarea>
            <button class="btn-compose" id="saveBtn" onclick="createNote()" title="发送">
                <svg class="send-icon-default" width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="send-icon-cat">🐱</span>
            </button>
        </div>
    </div>

    <!-- Insights Full Page -->
    <div class="insights-page" id="insightsPage">
        <div class="insights-header">
            <button class="insights-back" onclick="closeInsights()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <h1 class="insights-title">洞见</h1>
            <button class="insights-refresh" onclick="refreshInsights()" title="重新分析">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <div class="insights-content" id="insightsContent">
            <div class="insights-loading">
                <div class="insights-loading-icon">
                    <span class="loading-emoji">🔮</span>
                </div>
                <p class="insights-loading-text">正在解读你的内心世界...</p>
                <p class="insights-loading-sub">这可能需要一点时间</p>
            </div>
        </div>
    </div>

    <!-- Biography Full Page -->
    <div class="biography-page" id="biographyPage">
        <div class="biography-header">
            <button class="biography-back" onclick="closeBiography()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <h1 class="biography-title">我的传奇</h1>
            <button class="biography-refresh" onclick="refreshBiography()" title="更新传记" id="biographyRefreshBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <div class="biography-content" id="biographyContent">
            <div class="biography-loading">
                <div class="biography-loading-icon">
                    <span class="loading-emoji">📜</span>
                </div>
                <p class="biography-loading-text">正在翻阅你的人生篇章...</p>
                <p class="biography-loading-sub">传记作家正在构思...</p>
            </div>
        </div>
    </div>

    <!-- 时光回廊页面 -->
    <div class="corridor-page" id="corridorPage">
        <div class="corridor-page-header">
            <div class="corridor-page-title">
                <span class="corridor-title-icon">🌌</span>
                <div class="corridor-title-text">
                    <span class="corridor-title-main">时光回廊</span>
                    <span class="corridor-title-sub">用 AI 重现你的记忆画面</span>
                </div>
            </div>
            <button class="corridor-back-btn" onclick="closeCorridor()">← 返回</button>
        </div>
        <div class="corridor-controls" id="corridorControls">
            <div class="corridor-stats">
                <div class="corridor-stat">
                    <span class="corridor-stat-icon">✨</span>
                    <div class="corridor-stat-info">
                        <span class="corridor-stat-value" id="corridorSuitable">-</span>
                        <span class="corridor-stat-label">适合生成</span>
                    </div>
                </div>
                <div class="corridor-stat">
                    <span class="corridor-stat-icon">🎨</span>
                    <div class="corridor-stat-info">
                        <span class="corridor-stat-value" id="corridorGenerated">-</span>
                        <span class="corridor-stat-label">已生成</span>
                    </div>
                </div>
                <div class="corridor-stat">
                    <span class="corridor-stat-icon">⏳</span>
                    <div class="corridor-stat-info">
                        <span class="corridor-stat-value" id="corridorPending">-</span>
                        <span class="corridor-stat-label">待处理</span>
                    </div>
                </div>
            </div>
            <div class="corridor-progress-row">
                <div class="corridor-progress-bar">
                    <div class="corridor-progress-fill" id="corridorProgressFill" style="width: 0%"></div>
                </div>
                <div class="corridor-btn-group">
                    <button class="corridor-btn corridor-btn-primary" id="corridorStartBtn" onclick="startCorridorProcess()">
                        开始生成
                    </button>
                    <button class="corridor-btn corridor-btn-secondary" id="corridorPauseBtn" onclick="toggleCorridorPause()" style="display: none;">
                        ⏸️ 暂停
                    </button>
                </div>
            </div>
        </div>
        <div class="corridor-timeline" id="corridorTimeline">
            <div class="corridor-timeline-line"></div>
        </div>
        <div class="corridor-gallery" id="corridorGallery">
            <div class="corridor-empty">
                <div class="corridor-empty-icon">🌌</div>
                <p class="corridor-empty-text">加载中...</p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Confirm Dialog -->
    <div class="dialog-overlay" id="dialogOverlay" onclick="closeDialogOnBackdrop(event)">
        <div class="dialog">
            <h3 class="dialog-title">Delete this note?</h3>
            <p class="dialog-message">This action cannot be undone.</p>
            <div class="dialog-actions">
                <button class="btn-cancel" onclick="closeDialog()">Cancel</button>
                <button class="btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Starlight Dialog -->
    <div class="dialog-overlay" id="starlightOverlay" onclick="closeStarlightOnBackdrop(event)">
        <div class="dialog starlight-dialog" style="max-width: 560px;">
            <div class="starlight-header">
                <span class="starlight-badge">✨ 星光</span>
                <button class="starlight-close" onclick="closeStarlight()">&times;</button>
            </div>
            <div class="starlight-content" id="starlightContent">
                <div class="loading"><div class="loading-spinner"></div><span>Seeking starlight...</span></div>
            </div>
        </div>
    </div>

    <!-- Theme Dialog -->
    <div class="dialog-overlay" id="themeDialogOverlay" onclick="closeThemeDialogOnBackdrop(event)">
        <div class="dialog" style="max-width: 360px;">
            <h3 class="dialog-title" id="themeDialogTitle">Create Theme</h3>
            <div style="margin-bottom: 16px;">
                <input type="text" id="themeNameInput" class="auth-input" placeholder="Theme name" style="margin-bottom: 12px;">
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button class="color-btn" data-color="#8B5CF6" style="background: #8B5CF6;" onclick="selectThemeColor('#8B5CF6')"></button>
                    <button class="color-btn" data-color="#3B82F6" style="background: #3B82F6;" onclick="selectThemeColor('#3B82F6')"></button>
                    <button class="color-btn" data-color="#22D3EE" style="background: #22D3EE;" onclick="selectThemeColor('#22D3EE')"></button>
                    <button class="color-btn" data-color="#34D399" style="background: #34D399;" onclick="selectThemeColor('#34D399')"></button>
                    <button class="color-btn" data-color="#FBBF24" style="background: #FBBF24;" onclick="selectThemeColor('#FBBF24')"></button>
                    <button class="color-btn" data-color="#F87171" style="background: #F87171;" onclick="selectThemeColor('#F87171')"></button>
                    <button class="color-btn" data-color="#FB7185" style="background: #FB7185;" onclick="selectThemeColor('#FB7185')"></button>
                    <button class="color-btn" data-color="#A78BFA" style="background: #A78BFA;" onclick="selectThemeColor('#A78BFA')"></button>
                </div>
            </div>
            <div class="dialog-actions">
                <button class="btn-cancel" onclick="closeThemeDialog()">Cancel</button>
                <button class="btn-primary btn-save" id="saveThemeBtn" onclick="saveTheme()" style="width: auto;">Save</button>
            </div>
        </div>
    </div>

    <!-- Move to Theme Dialog -->
    <div class="dialog-overlay" id="moveToThemeOverlay" onclick="closeMoveToThemeOnBackdrop(event)">
        <div class="dialog" style="max-width: 320px;">
            <h3 class="dialog-title">Move to Theme</h3>
            <div class="themes-select-list" id="themesSelectList">
                <div class="loading"><div class="loading-spinner"></div></div>
            </div>
            <div class="dialog-actions">
                <button class="btn-cancel" onclick="closeMoveToTheme()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Import Dialog -->
    <div class="dialog-overlay" id="importDialogOverlay" onclick="closeImportDialogOnBackdrop(event)">
        <div class="dialog" style="max-width: 420px;">
            <h3 class="dialog-title">Import Notes</h3>
            <p class="dialog-message" id="importMessage">Parsing file...</p>
            <div class="import-preview" id="importPreview" style="max-height: 200px; overflow-y: auto; margin-bottom: 16px; padding: 12px; background: var(--surface-input); border-radius: var(--radius-input); font-size: 0.85rem; color: var(--text-2); display: none;"></div>
            <div class="dialog-actions">
                <button class="btn-cancel" onclick="closeImportDialog()">Cancel</button>
                <button class="btn-primary btn-save" id="confirmImportBtn" style="width: auto;" disabled>Import</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== Theme System ====================
        const THEMES = ['galaxy', 'forest', 'angel', 'passion'];
        const THEME_STORAGE_KEY = 'jotmo_theme';

        function initTheme() {
            const saved = localStorage.getItem(THEME_STORAGE_KEY);
            let theme;

            if (saved && THEMES.includes(saved)) {
                theme = saved;
            } else {
                // Default based on system preference
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                theme = prefersDark ? 'galaxy' : 'forest';
            }

            setTheme(theme, false);
        }

        function setTheme(theme, animate = true) {
            if (!THEMES.includes(theme)) return;

            // Add transition class for smooth switching
            if (animate) {
                document.body.style.transition = 'background var(--duration-slow) var(--ease-out)';
            }

            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem(THEME_STORAGE_KEY, theme);

            // Update dropdown UI
            const themeIcons = {
                'galaxy': '&#127756;',
                'forest': '&#127795;',
                'angel': '&#128124;',
                'passion': '&#128293;'
            };
            const iconEl = document.getElementById('currentThemeIcon');
            if (iconEl) iconEl.innerHTML = themeIcons[theme] || themeIcons['galaxy'];

            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.theme === theme);
            });
        }

        // Theme dropdown functions
        function toggleThemeDropdown() {
            const dropdown = document.getElementById('themeDropdown');
            dropdown.classList.toggle('open');
        }

        function selectTheme(theme, iconHtml) {
            setTheme(theme);
            // Update current icon
            document.getElementById('currentThemeIcon').innerHTML = iconHtml;
            // Update active state
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.theme === theme);
            });
            // Close dropdown
            document.getElementById('themeDropdown').classList.remove('open');
        }

        // Close theme dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('themeDropdown');
            if (dropdown && !dropdown.contains(e.target)) {
                dropdown.classList.remove('open');
            }
        });

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem(THEME_STORAGE_KEY)) {
                setTheme(e.matches ? 'galaxy' : 'forest');
            }
        });

        // ==================== State ====================
        const API_BASE = '';
        let isLoginMode = true;
        let currentUser = null;
        let deleteNoteId = null;
        let currentPage = 1;
        let hasMoreNotes = true;
        let isLoadingMore = false;
        let allNotes = [];
        let currentCategoryId = 0; // 0 = all, -1 = uncategorized, >0 = specific category
        let currentSearchQuery = ''; // search query
        let searchDebounceTimer = null;
        let categories = [];
        let expandedCategories = new Set();
        let currentViewMode = 'list'; // 'list' or 'timeline'
        let noteImages = {}; // 时光回廊：note_id -> image info
        let corridorStatus = null; // 时光回廊处理状态
        let corridorPollingTimer = null;

        // 知知猫状态
        let isZhizhiMode = false;
        let catState = 'walking'; // walking, sleeping, lying, listening, active
        let catStateTimer = null;
        let catIdleTimer = null;

        // ==================== 知知猫逻辑 ====================
        function setupZhizhiCat() {
            const cat = document.getElementById('zhizhiCat');
            const composer = document.getElementById('bottomComposer');
            if (!cat || !composer) return;

            // 随机切换猫的空闲状态
            startCatIdleCycle();

            // 监听鼠标靠近
            composer.addEventListener('mouseenter', handleComposerMouseEnter);
            composer.addEventListener('mouseleave', handleComposerMouseLeave);
        }

        function startCatIdleCycle() {
            // 随机在走动、睡觉、趴着之间切换
            function setRandomIdleState() {
                if (isZhizhiMode) return; // 知知模式时不切换

                const cat = document.getElementById('zhizhiCat');
                if (!cat) return;

                // 移除所有状态
                cat.classList.remove('is-sleeping', 'is-lying', 'is-listening', 'is-active');

                const states = ['walking', 'walking', 'sleeping', 'lying']; // 走动概率更高
                const randomState = states[Math.floor(Math.random() * states.length)];
                catState = randomState;

                if (randomState === 'sleeping') {
                    cat.classList.add('is-sleeping');
                } else if (randomState === 'lying') {
                    cat.classList.add('is-lying');
                }
                // walking 不需要额外的 class

                // 设置下一次状态切换
                const duration = randomState === 'walking' ? 8000 : (10000 + Math.random() * 10000);
                catStateTimer = setTimeout(setRandomIdleState, duration);
            }

            // 启动循环
            setRandomIdleState();
        }

        function handleComposerMouseEnter() {
            if (isZhizhiMode) return;

            const cat = document.getElementById('zhizhiCat');
            if (!cat) return;

            // 清除状态切换定时器
            if (catStateTimer) {
                clearTimeout(catStateTimer);
                catStateTimer = null;
            }

            // 切换到倾听状态
            cat.classList.remove('is-sleeping', 'is-lying');
            cat.classList.add('is-listening');
            catState = 'listening';
        }

        function handleComposerMouseLeave() {
            if (isZhizhiMode) return;

            const cat = document.getElementById('zhizhiCat');
            if (!cat) return;

            // 延迟恢复空闲状态
            catIdleTimer = setTimeout(() => {
                cat.classList.remove('is-listening');
                startCatIdleCycle();
            }, 500);
        }

        function toggleZhizhiMode() {
            isZhizhiMode = !isZhizhiMode;

            const cat = document.getElementById('zhizhiCat');
            const composer = document.querySelector('.bottom-composer-inner');
            const textarea = document.getElementById('noteContent');

            if (!cat || !composer || !textarea) return;

            // 清除定时器
            if (catStateTimer) {
                clearTimeout(catStateTimer);
                catStateTimer = null;
            }
            if (catIdleTimer) {
                clearTimeout(catIdleTimer);
                catIdleTimer = null;
            }

            if (isZhizhiMode) {
                // 激活知知模式
                cat.classList.remove('is-sleeping', 'is-lying', 'is-listening');
                cat.classList.add('is-active');
                composer.classList.add('zhizhi-mode');
                textarea.placeholder = '知知听你说...';
                catState = 'active';

                // 显示提示
                showToast('知知模式已开启，快记将获得知知的回应 🐱');
            } else {
                // 退出知知模式
                cat.classList.remove('is-active');
                composer.classList.remove('zhizhi-mode');
                textarea.placeholder = '记录此刻的想法...';

                // 恢复空闲状态循环
                startCatIdleCycle();

                showToast('知知模式已关闭');
            }
        }

        // ==================== User Dropdown ====================
        document.getElementById('userButton')?.addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('userDropdown').classList.toggle('active');
        });

        document.addEventListener('click', () => {
            document.getElementById('userDropdown')?.classList.remove('active');
            document.getElementById('mobileDropdown')?.classList.remove('active');
            document.getElementById('moreDropdown')?.classList.remove('active');
            document.querySelectorAll('.note-menu-dropdown').forEach(d => d.classList.remove('active'));
        });

        // ==================== Auth ====================
        function checkAuth() {
            const token = localStorage.getItem('jotmo_token');
            const username = localStorage.getItem('jotmo_username');
            if (token && username) {
                currentUser = { token, username };
                showNotesSection();
            }
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').textContent = isLoginMode ? 'Welcome back' : 'Create account';
            document.getElementById('authSubtitle').textContent = isLoginMode
                ? 'Enter your credentials to continue'
                : 'Start capturing your moments';
            document.getElementById('authBtn').textContent = isLoginMode ? 'Sign in' : 'Create account';
            document.getElementById('switchText').textContent = isLoginMode ? 'New here? ' : 'Already have an account? ';
            document.getElementById('switchLink').textContent = isLoginMode ? 'Create account' : 'Sign in';
            clearMessage();
        }

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const endpoint = isLoginMode ? '/api/login' : '/api/register';

            try {
                const response = await fetch(API_BASE + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (!response.ok) {
                    const error = await response.text();
                    showMessage(error, 'error');
                    return;
                }

                const data = await response.json();
                localStorage.setItem('jotmo_token', data.token);
                localStorage.setItem('jotmo_username', data.username);
                currentUser = { token: data.token, username: data.username };
                showNotesSection();
            } catch (err) {
                showMessage('Connection failed. Please try again.', 'error');
            }
        });

        function showNotesSection() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('notesSection').classList.add('active');
            document.getElementById('navUser').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            loadCategories();
            loadThemes();
            loadNotes();
            restoreSidebarState();
        }

        // ==================== Sidebar Collapse ====================
        function toggleSidebarSection(section) {
            const cardId = section === 'categories' ? 'categoriesCard' : 'themesCard';
            const card = document.getElementById(cardId);
            if (card) {
                card.classList.toggle('collapsed');
                // Save state to localStorage
                const key = `sidebar_${section}_collapsed`;
                localStorage.setItem(key, card.classList.contains('collapsed'));
            }
        }

        // Restore sidebar collapse state on load
        function restoreSidebarState() {
            ['categories', 'themes'].forEach(section => {
                const key = `sidebar_${section}_collapsed`;
                const collapsed = localStorage.getItem(key) === 'true';
                if (collapsed) {
                    const cardId = section === 'categories' ? 'categoriesCard' : 'themesCard';
                    const card = document.getElementById(cardId);
                    if (card) card.classList.add('collapsed');
                }
            });
        }

        // ==================== Categories ====================
        async function loadCategories() {
            try {
                const response = await fetch(API_BASE + '/api/categories', {
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });

                if (!response.ok) return;

                const data = await response.json();
                categories = data.categories || [];
                renderCategories(data.uncategorizedCount || 0);
            } catch (err) {
                console.error('Failed to load categories:', err);
            }
        }

        function renderCategories(uncategorizedCount) {
            let html = `
                <div class="category-item ${currentCategoryId === 0 ? 'active' : ''}" onclick="selectCategory(0)">
                    <span class="category-name category-all">All Notes</span>
                </div>
            `;

            // Render categories
            for (const cat of categories) {
                if (cat.children && cat.children.length > 0) {
                    // Parent category with children
                    const isExpanded = expandedCategories.has(cat.id);
                    html += `
                        <div class="category-parent">
                            <div class="category-item" onclick="selectCategory(${cat.id}, true)">
                                <span class="category-name">
                                    <button class="category-expand ${isExpanded ? '' : 'collapsed'}" onclick="toggleCategoryExpand(event, ${cat.id})">
                                        <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                    ${escapeHtml(cat.name)}
                                </span>
                                <span class="category-count">${cat.note_count}</span>
                            </div>
                            <div class="category-children" style="display: ${isExpanded ? 'block' : 'none'}">
                                ${cat.children.map(child => `
                                    <div class="category-item ${currentCategoryId === child.id ? 'active' : ''}" onclick="selectCategory(${child.id})">
                                        <span class="category-name">${escapeHtml(child.name)}</span>
                                        <span class="category-count">${child.note_count}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    // Simple category
                    html += `
                        <div class="category-item ${currentCategoryId === cat.id ? 'active' : ''}" onclick="selectCategory(${cat.id})">
                            <span class="category-name">${escapeHtml(cat.name)}</span>
                            <span class="category-count">${cat.note_count}</span>
                        </div>
                    `;
                }
            }

            // Uncategorized
            if (uncategorizedCount > 0) {
                html += `
                    <div class="category-item ${currentCategoryId === -1 ? 'active' : ''}" onclick="selectCategory(-1)">
                        <span class="category-name category-uncategorized">Uncategorized</span>
                        <span class="category-count">${uncategorizedCount}</span>
                    </div>
                `;
            }

            // Update both desktop and mobile category lists
            const desktopList = document.getElementById('categoriesList');
            const mobileList = document.getElementById('mobileCategoriesList');
            if (desktopList) desktopList.innerHTML = html;
            if (mobileList) mobileList.innerHTML = html;

            // Update current category label
            updateCurrentCategoryLabel();
        }

        function updateCurrentCategoryLabel() {
            const label = document.getElementById('currentCatLabel');
            if (!label) return;

            if (currentCategoryId === 0) {
                label.textContent = 'All Notes';
            } else if (currentCategoryId === -1) {
                label.textContent = 'Uncategorized';
            } else {
                const cat = findCategoryById(currentCategoryId);
                label.textContent = cat ? cat.name : 'All Notes';
            }
        }

        function findCategoryById(id) {
            for (const cat of categories) {
                if (cat.id === id) return cat;
                if (cat.children) {
                    for (const child of cat.children) {
                        if (child.id === id) return child;
                    }
                }
            }
            return null;
        }

        // Mobile categories dropdown
        function toggleMobileCategories() {
            const dropdown = document.getElementById('mobileDropdown');
            dropdown.classList.toggle('active');
        }

        // More menu dropdown
        function toggleMoreMenu(e) {
            if (e) e.stopPropagation();
            const dropdown = document.getElementById('moreDropdown');
            dropdown.classList.toggle('active');
        }

        function toggleCategoryExpand(event, categoryId) {
            event.stopPropagation();
            if (expandedCategories.has(categoryId)) {
                expandedCategories.delete(categoryId);
            } else {
                expandedCategories.add(categoryId);
            }
            loadCategories();
        }

        function selectCategory(categoryId, isParent = false) {
            // For parent categories, just expand/collapse, don't filter
            if (isParent) {
                toggleCategoryExpand({ stopPropagation: () => {} }, categoryId);
                return;
            }

            currentCategoryId = categoryId;

            // Close mobile dropdown
            const mobileDropdown = document.getElementById('mobileDropdown');
            if (mobileDropdown) mobileDropdown.classList.remove('active');

            loadCategories();
            loadNotes();
        }

        async function triggerRecluster() {
            if (!confirm('This will recalculate all categories. Continue?')) return;

            const btn = document.getElementById('reclusterBtn');
            if (btn) btn.classList.add('spinning');

            try {
                const response = await fetch(API_BASE + '/api/categories/recluster', {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });

                if (!response.ok) throw new Error('Failed to recluster');

                showToast('Reclustering completed');
                loadCategories();
                loadNotes();
            } catch (err) {
                showToast('Failed to recluster');
            } finally {
                if (btn) btn.classList.remove('spinning');
            }
        }

        function logout() {
            localStorage.removeItem('jotmo_token');
            localStorage.removeItem('jotmo_username');
            currentUser = null;
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('notesSection').classList.remove('active');
            document.getElementById('navUser').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('userDropdown').classList.remove('active');
        }

        function showMessage(text, type) {
            const msgDiv = document.getElementById('authMessage');
            msgDiv.className = 'auth-message ' + type;
            msgDiv.textContent = text;
        }

        function clearMessage() {
            const msgDiv = document.getElementById('authMessage');
            msgDiv.className = '';
            msgDiv.textContent = '';
        }

        // ==================== Notes ====================
        async function loadNotes(reset = true) {
            const notesList = document.getElementById('notesList');

            if (reset) {
                currentPage = 1;
                hasMoreNotes = true;
                allNotes = [];
                notesList.innerHTML = '<div class="loading"><div class="loading-spinner"></div><span>Loading...</span></div>';
            }

            if (isLoadingMore || !hasMoreNotes) return;
            isLoadingMore = true;

            try {
                let url = API_BASE + `/api/notes?page=${currentPage}&limit=20`;
                if (currentCategoryId !== 0) {
                    url += `&category_id=${currentCategoryId}`;
                }
                if (currentThemeId !== 0) {
                    url += `&theme_id=${currentThemeId}`;
                }
                if (currentSearchQuery) {
                    url += `&q=${encodeURIComponent(currentSearchQuery)}`;
                }

                const response = await fetch(url, {
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        logout();
                        return;
                    }
                    throw new Error('Failed to load notes');
                }

                const data = await response.json();
                allNotes = [...allNotes, ...data.notes];
                hasMoreNotes = data.hasMore;
                currentPage++;

                renderNotes(allNotes, data.total);
            } catch (err) {
                if (reset) {
                    notesList.innerHTML = '<div class="empty-state"><div class="empty-icon">!</div><p class="empty-text">Unable to load notes</p></div>';
                }
            } finally {
                isLoadingMore = false;
            }
        }

        // 导航栏滚动效果
        function setupNavScroll() {
            const nav = document.querySelector('.nav');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    nav.classList.add('scrolled');
                } else {
                    nav.classList.remove('scrolled');
                }
            });
        }

        // 快记卡片悬停粒子效果
        function setupNoteParticles() {
            const notesList = document.getElementById('notesList');
            if (!notesList) return;

            // 使用事件委托
            notesList.addEventListener('mouseenter', handleNoteHover, true);
            notesList.addEventListener('mouseleave', handleNoteLeave, true);
        }

        const particleIntervals = new WeakMap();

        function handleNoteHover(e) {
            const card = e.target.closest('.note-card');
            if (!card || particleIntervals.has(card)) return;

            // 开始生成粒子
            const interval = setInterval(() => {
                createNoteParticle(card);
            }, 150); // 每150ms生成一个粒子

            particleIntervals.set(card, interval);

            // 立即生成几个粒子
            for (let i = 0; i < 3; i++) {
                setTimeout(() => createNoteParticle(card), i * 50);
            }
        }

        function handleNoteLeave(e) {
            const card = e.target.closest('.note-card');
            if (!card) return;

            const interval = particleIntervals.get(card);
            if (interval) {
                clearInterval(interval);
                particleIntervals.delete(card);
            }
        }

        function createNoteParticle(card) {
            const theme = document.body.dataset.theme || 'galaxy';
            const particle = document.createElement('div');
            particle.className = 'note-particle';

            // 根据主题设置粒子类型（只有特殊粒子需要额外的class）
            // 默认粒子不需要额外class，特殊粒子需要对应class
            const specialParticleChance = {
                galaxy: 0,           // galaxy只有一种粒子
                forest: 0.3,         // 30%概率出现花瓣
                angel: 0.25,         // 25%概率出现羽毛
                passion: 0.35        // 35%概率出现火焰羽毛
            };

            const specialClass = {
                forest: 'is-petal',
                angel: 'is-feather',
                passion: 'is-flame-feather'
            };

            // 判断是否生成特殊粒子
            const isSpecial = Math.random() < (specialParticleChance[theme] || 0);
            if (isSpecial && specialClass[theme]) {
                particle.classList.add(specialClass[theme]);
            }

            // 随机位置（在卡片范围内）
            const rect = card.getBoundingClientRect();
            const x = Math.random() * (rect.width - 20) + 10;

            particle.style.left = x + 'px';
            particle.style.bottom = '10px';
            particle.style.setProperty('--drift-x', (Math.random() * 40 - 20) + 'px');

            // 添加到卡片
            card.style.position = 'relative';
            card.appendChild(particle);

            // 动画结束后移除
            let duration = 2000; // 默认
            if (isSpecial) {
                if (theme === 'passion') duration = 2500;
                else if (theme === 'angel') duration = 3000;
                else if (theme === 'forest') duration = 3000;
            } else {
                if (theme === 'galaxy') duration = 2000;
                else if (theme === 'forest') duration = 2500;
                else if (theme === 'angel') duration = 2000;
                else if (theme === 'passion') duration = 1800;
            }

            setTimeout(() => {
                particle.remove();
            }, duration);
        }

        // Infinite scroll
        function setupInfiniteScroll() {
            window.addEventListener('scroll', () => {
                if (isLoadingMore || !hasMoreNotes) return;

                const scrollY = window.scrollY;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;

                // Load more when 200px from bottom
                if (scrollY + windowHeight >= documentHeight - 200) {
                    loadMoreNotes();
                }
            });
        }

        async function loadMoreNotes() {
            if (isLoadingMore || !hasMoreNotes) return;

            // Add loading indicator at bottom
            const notesList = document.getElementById('notesList');
            const loadingEl = document.createElement('div');
            loadingEl.className = 'loading';
            loadingEl.id = 'loadMoreSpinner';
            loadingEl.innerHTML = '<div class="loading-spinner"></div><span>Loading more...</span>';
            notesList.appendChild(loadingEl);

            await loadNotes(false);

            // Remove loading indicator
            document.getElementById('loadMoreSpinner')?.remove();
        }

        function findCategoryById(id) {
            for (const cat of categories) {
                if (cat.id === id) return cat;
                if (cat.children) {
                    for (const child of cat.children) {
                        if (child.id === id) return child;
                    }
                }
            }
            return null;
        }

        function renderNotes(notes, total) {
            // Dispatch to the appropriate render function based on view mode
            if (currentViewMode === 'timeline') {
                renderTimelineNotes(notes, total);
            } else {
                renderListNotes(notes, total);
            }
        }

        async function createNote() {
            const content = document.getElementById('noteContent').value.trim();
            if (!content) return;

            const btn = document.getElementById('saveBtn');
            const textarea = document.getElementById('noteContent');

            // 记住当前是否是知知模式
            const wasZhizhiMode = isZhizhiMode;

            // 立即清空输入框并禁用按钮
            textarea.value = '';
            btn.disabled = true;

            try {
                const response = await fetch(API_BASE + '/api/notes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + currentUser.token
                    },
                    body: JSON.stringify({ content, zhizhi_mode: wasZhizhiMode })
                });

                if (!response.ok) throw new Error('Failed to create note');

                const result = await response.json();

                // 立即刷新列表
                loadNotes();
                // 延迟刷新分类
                setTimeout(() => loadCategories(), 2000);

                // 知知模式：始终获取知知回应
                if (wasZhizhiMode && result.note && result.note.id) {
                    fetchCatResponse(result.note.id, content, true);
                }
                // 非知知模式：如果需要猫咪回应，异步获取（不阻塞UI）
                else if (result.cat_name === 'pending' && result.note && result.note.id) {
                    fetchCatResponse(result.note.id, content, false);
                }
            } catch (err) {
                showToast('保存失败，请重试');
                // 恢复内容
                textarea.value = content;
            } finally {
                btn.disabled = false;
            }
        }

        // 异步获取猫咪回应
        async function fetchCatResponse(noteId, content, isZhizhi = false) {
            // 知知模式显示思考提示
            if (isZhizhi) {
                showZhizhiThinking();
            }

            try {
                const response = await fetch(API_BASE + '/api/notes/cat-response', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + currentUser.token
                    },
                    body: JSON.stringify({ note_id: noteId, content: content, zhizhi_mode: isZhizhi })
                });

                // 移除思考提示
                hideZhizhiThinking();

                if (response.ok) {
                    const result = await response.json();
                    if (result.cat_response) {
                        // 知知模式使用专属的显示方式
                        if (isZhizhi) {
                            showZhizhiBubble(result.cat_response);
                        } else {
                            showCatBubble(result.cat_name, result.cat_response);
                        }
                        // 刷新列表以显示猫咪图标
                        loadNotes();
                    }
                } else {
                    if (isZhizhi) {
                        showToast('知知暂时无法回应，请稍后再试');
                    }
                }
            } catch (err) {
                hideZhizhiThinking();
                console.log('Cat response failed:', err);
                if (isZhizhi) {
                    showToast('知知暂时无法回应，请稍后再试');
                }
            }
        }

        // 显示知知思考中的提示
        function showZhizhiThinking() {
            // 移除已有的
            hideZhizhiThinking();

            const thinking = document.createElement('div');
            thinking.className = 'zhizhi-thinking';
            thinking.id = 'zhizhiThinking';
            thinking.innerHTML = `
                <div class="zhizhi-thinking-content">
                    <span class="zhizhi-thinking-emoji">🐱</span>
                    <span class="zhizhi-thinking-text">知知正在思考...</span>
                    <span class="zhizhi-thinking-dots"><span>.</span><span>.</span><span>.</span></span>
                </div>
            `;
            document.body.appendChild(thinking);

            // 添加显示动画
            requestAnimationFrame(() => {
                thinking.classList.add('show');
            });
        }

        function hideZhizhiThinking() {
            const thinking = document.getElementById('zhizhiThinking');
            if (thinking) {
                thinking.classList.remove('show');
                setTimeout(() => thinking.remove(), 300);
            }
        }

        // 显示知知回应气泡（专属样式）
        function showZhizhiBubble(message) {
            // 移除已有的气泡
            const existing = document.querySelector('.cat-bubble-overlay');
            if (existing) existing.remove();

            const overlay = document.createElement('div');
            overlay.className = 'cat-bubble-overlay zhizhi-bubble-overlay';
            overlay.innerHTML = `
                <div class="cat-bubble zhizhi-bubble">
                    <div class="zhizhi-avatar">🐱</div>
                    <div class="zhizhi-content">
                        <div class="zhizhi-name">知知说</div>
                        <div class="zhizhi-message">${escapeHtml(message)}</div>
                    </div>
                    <button class="cat-close" onclick="this.closest('.cat-bubble-overlay').remove()" title="关闭">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
            `;
            document.body.appendChild(overlay);

            // 添加显示动画
            requestAnimationFrame(() => {
                overlay.classList.add('show');
            });

            // 点击背景关闭
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('show');
                    setTimeout(() => overlay.remove(), 300);
                }
            });

            // 自动关闭（延长时间让用户阅读）
            setTimeout(() => {
                if (overlay.parentNode) {
                    overlay.classList.remove('show');
                    setTimeout(() => overlay.remove(), 300);
                }
            }, 10000);
        }

        // 显示猫咪回应气泡
        function showCatBubble(catName, message) {
            // 移除已有的气泡
            const existing = document.querySelector('.cat-bubble-overlay');
            if (existing) existing.remove();

            const overlay = document.createElement('div');
            overlay.className = 'cat-bubble-overlay';
            overlay.innerHTML = `
                <div class="cat-bubble">
                    <div class="cat-avatar">
                        <span class="cat-emoji">🐱</span>
                    </div>
                    <div class="cat-content">
                        <div class="cat-name">${escapeHtml(catName)} 说:</div>
                        <div class="cat-message">${escapeHtml(message)}</div>
                    </div>
                    <button class="cat-close" onclick="closeCatBubble()" title="关闭">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
            `;
            document.body.appendChild(overlay);

            // 点击气泡外部关闭
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeCatBubble();
                }
            });

            // 添加显示动画
            requestAnimationFrame(() => {
                overlay.classList.add('show');
            });

            // 不自动消失，让用户手动关闭
        }

        function closeCatBubble() {
            const overlay = document.querySelector('.cat-bubble-overlay');
            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => overlay.remove(), 300);
            }
        }

        // 查看笔记的猫咪回复
        function showNoteCatResponse(noteId) {
            const note = allNotes.find(n => n.id === noteId);
            if (note && note.cat_response) {
                showCatBubble('知知', note.cat_response);
            }
        }

        // ==================== View Mode (List/Timeline) ====================
        function setViewMode(mode) {
            currentViewMode = mode;
            const notesList = document.getElementById('notesList');
            const listBtn = document.getElementById('listViewBtn');
            const timelineBtn = document.getElementById('timelineViewBtn');

            // Update button states
            if (mode === 'list') {
                listBtn.classList.add('active');
                timelineBtn.classList.remove('active');
                notesList.classList.remove('timeline-mode');
            } else {
                listBtn.classList.remove('active');
                timelineBtn.classList.add('active');
                notesList.classList.add('timeline-mode');
            }

            // Re-render with the current notes
            if (mode === 'list') {
                renderListNotes(allNotes, allNotes.length);
            } else {
                renderTimelineNotes(allNotes, allNotes.length);
            }
        }

        function renderListNotes(notes, total) {
            const notesList = document.getElementById('notesList');
            const notesTitle = document.querySelector('.notes-title');

            // Update title with count and category
            if (total !== undefined) {
                let titleText = 'Recent';
                if (currentCategoryId === -1) {
                    titleText = 'Uncategorized';
                } else if (currentCategoryId > 0) {
                    const cat = findCategoryById(currentCategoryId);
                    if (cat) titleText = cat.name;
                }
                notesTitle.textContent = `${titleText} (${total})`;
            }

            if (notes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">~</div>
                        <p class="empty-text">It's quiet here. Write your first note.</p>
                    </div>
                `;
                return;
            }

            notesList.innerHTML = notes.map(note => `
                <div class="glass-card note-card" data-id="${note.id}">
                    <div class="note-content">${escapeHtml(note.content)}</div>
                    <div class="note-footer">
                        <span class="note-time">${formatDate(note.created_at)}</span>
                        <div class="note-actions-row">
                            ${note.cat_response ? `
                                <button class="cat-indicator" onclick="showNoteCatResponse(${note.id})" title="查看知知的回复">
                                    <span class="cat-indicator-emoji">🐱</span>
                                </button>
                            ` : ''}
                            <div class="note-menu">
                                <button class="note-menu-btn" onclick="toggleNoteMenu(event, ${note.id})" aria-label="Note options">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <circle cx="10" cy="4" r="1.5" fill="currentColor"/>
                                        <circle cx="10" cy="10" r="1.5" fill="currentColor"/>
                                        <circle cx="10" cy="16" r="1.5" fill="currentColor"/>
                                    </svg>
                                </button>
                                <div class="note-menu-dropdown" id="menu-${note.id}">
                                    <button class="menu-item" onclick="copyNote(${note.id})">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <rect x="5" y="5" width="8" height="8" rx="1.5" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M3 11V3.5C3 2.67 3.67 2 4.5 2H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                        Copy
                                    </button>
                                    <button class="menu-item" onclick="showMoveToTheme(${note.id}); toggleNoteMenu(event, ${note.id})">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <path d="M2 4h5l2 2h5v7a1 1 0 01-1 1H3a1 1 0 01-1-1V4z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Move to Theme
                                    </button>
                                    <button class="menu-item danger" onclick="confirmDelete(${note.id})">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <path d="M3 4h10M6 4V3a1 1 0 011-1h2a1 1 0 011 1v1m2 0v9a1 1 0 01-1 1H5a1 1 0 01-1-1V4h10z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderTimelineNotes(notes, total) {
            const notesList = document.getElementById('notesList');
            const notesTitle = document.querySelector('.notes-title');

            // Update title with count and category
            if (total !== undefined) {
                let titleText = 'Recent';
                if (currentCategoryId === -1) {
                    titleText = 'Uncategorized';
                } else if (currentCategoryId > 0) {
                    const cat = findCategoryById(currentCategoryId);
                    if (cat) titleText = cat.name;
                }
                notesTitle.textContent = `${titleText} (${total})`;
            }

            if (notes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">~</div>
                        <p class="empty-text">It's quiet here. Write your first note.</p>
                    </div>
                `;
                return;
            }

            // Group notes by date
            const grouped = {};
            notes.forEach(note => {
                const date = note.created_at.split('T')[0];
                if (!grouped[date]) grouped[date] = [];
                grouped[date].push(note);
            });

            // Sort dates descending
            const sortedDates = Object.keys(grouped).sort((a, b) => b.localeCompare(a));

            let html = '';
            let groupIndex = 0;

            sortedDates.forEach(date => {
                const dateNotes = grouped[date];
                const formattedDate = formatDateGroup(date);

                html += `
                    <div class="timeline-date-group" style="animation-delay: ${groupIndex * 0.1}s">
                        <div class="timeline-date-header">
                            <div class="timeline-date-dot"></div>
                            <span class="timeline-date-text">${formattedDate}</span>
                        </div>
                        <div class="timeline-notes">
                            ${dateNotes.map((note, noteIndex) => `
                                <div class="timeline-note-wrapper" style="animation-delay: ${(groupIndex * 0.1) + (noteIndex * 0.05)}s">
                                    <div class="timeline-note" data-id="${note.id}">
                                        <div class="timeline-note-time">${formatTimeOnly(note.created_at)}</div>
                                        <div class="timeline-note-content">${escapeHtml(note.content)}</div>
                                        <div class="timeline-note-footer">
                                            ${note.cat_response ? `
                                                <button class="cat-indicator" onclick="showNoteCatResponse(${note.id})" title="查看知知的回复">
                                                    <span class="cat-indicator-emoji">🐱</span>
                                                </button>
                                            ` : ''}
                                            <button class="timeline-action-btn" onclick="copyNoteById(${note.id})" title="复制">
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                    <rect x="5" y="5" width="8" height="8" rx="1.5" stroke="currentColor" stroke-width="1.5"/>
                                                    <path d="M3 11V3.5C3 2.67 3.67 2 4.5 2H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                                </svg>
                                            </button>
                                            <button class="timeline-action-btn danger" onclick="confirmDelete(${note.id})" title="删除">
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                    <path d="M3 4h10M6 4V3a1 1 0 011-1h2a1 1 0 011 1v1m2 0v9a1 1 0 01-1 1H5a1 1 0 01-1-1V4h10z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                groupIndex++;
            });

            notesList.innerHTML = html;
        }

        function formatDateGroup(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            const isToday = date.toDateString() === today.toDateString();
            const isYesterday = date.toDateString() === yesterday.toDateString();

            if (isToday) return '今天';
            if (isYesterday) return '昨天';

            const month = date.getMonth() + 1;
            const day = date.getDate();
            const year = date.getFullYear();
            const currentYear = today.getFullYear();

            if (year === currentYear) {
                return `${month}月${day}日`;
            }
            return `${year}年${month}月${day}日`;
        }

        function formatTimeOnly(dateStr) {
            const date = new Date(dateStr);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // ==================== 时光回廊 ====================

        let corridorNotes = []; // 适合生成图片的快记列表

        function openCorridor() {
            document.getElementById('corridorPage').classList.add('active');
            document.body.style.overflow = 'hidden';
            loadCorridorData();
        }

        function closeCorridor() {
            document.getElementById('corridorPage').classList.remove('active');
            document.body.style.overflow = '';
            if (corridorPollingTimer) {
                clearInterval(corridorPollingTimer);
                corridorPollingTimer = null;
            }
        }

        async function loadCorridorData() {
            if (!currentUser) return;

            try {
                // 加载状态
                const statusResp = await fetch('/api/corridor/status', {
                    headers: { 'Authorization': `Bearer ${currentUser.token}` }
                });
                if (statusResp.ok) {
                    corridorStatus = await statusResp.json();
                    updateCorridorUI();
                }

                // 加载所有快记的图片信息并渲染画廊
                await loadCorridorGallery();

            } catch (e) {
                console.error('Failed to load corridor data:', e);
            }
        }

        async function loadCorridorGallery() {
            if (!currentUser) return;

            const gallery = document.getElementById('corridorGallery');
            gallery.innerHTML = '<div class="corridor-empty"><div class="corridor-empty-icon">🌌</div><p class="corridor-empty-text">正在穿越时光...</p></div>';

            try {
                // 使用批量接口一次性获取所有图片信息
                const resp = await fetch('/api/corridor/all-images', {
                    headers: { 'Authorization': `Bearer ${currentUser.token}` }
                });
                if (!resp.ok) {
                    throw new Error('Failed to load images');
                }

                const data = await resp.json();
                const images = data.images || [];

                // 转换为 corridorNotes 格式
                corridorNotes = images.map(item => ({
                    id: item.note_id,
                    content: item.content,
                    created_at: item.created_at,
                    image: item.image
                }));

                // 更新 noteImages map
                corridorNotes.forEach(note => {
                    if (note.image) {
                        noteImages[note.id] = note.image;
                    }
                });

                renderCorridorGallery();

            } catch (e) {
                console.error('Failed to load corridor gallery:', e);
                gallery.innerHTML = '<div class="corridor-empty"><div class="corridor-empty-icon">😢</div><p class="corridor-empty-text">加载失败</p></div>';
            }
        }

        function renderCorridorGallery() {
            const gallery = document.getElementById('corridorGallery');

            // 筛选有图片或正在生成的快记
            const notesWithImages = corridorNotes.filter(n =>
                n.image && (n.image.status === 'completed' || n.image.status === 'generating' || n.image.status === 'pending')
            );

            if (notesWithImages.length === 0) {
                gallery.innerHTML = `
                    <div class="corridor-empty">
                        <div class="corridor-empty-icon">🌌</div>
                        <p class="corridor-empty-text">时光回廊空空如也</p>
                        <p style="font-size: 0.9rem; color: var(--text-3); margin-top: 8px;">
                            点击上方按钮，用 AI 为你的记忆画上画面
                        </p>
                    </div>
                `;
                return;
            }

            // 按月份分组
            const grouped = {};
            notesWithImages.forEach(note => {
                const date = new Date(note.created_at);
                const monthKey = `${date.getFullYear()}年${date.getMonth() + 1}月`;
                if (!grouped[monthKey]) {
                    grouped[monthKey] = [];
                }
                grouped[monthKey].push(note);
            });

            // 按月份降序排序
            const sortedMonths = Object.keys(grouped).sort((a, b) => {
                const parseMonth = (s) => {
                    const match = s.match(/(\d+)年(\d+)月/);
                    return match ? parseInt(match[1]) * 12 + parseInt(match[2]) : 0;
                };
                return parseMonth(b) - parseMonth(a);
            });

            let html = '';
            sortedMonths.forEach(month => {
                const notes = grouped[month];
                html += `
                    <div class="corridor-time-header" style="grid-column: 1 / -1;">
                        <div class="corridor-time-dot"></div>
                        <span class="corridor-time-label">${month}</span>
                        <span class="corridor-time-count">${notes.length} 张图片</span>
                    </div>
                `;

                notes.forEach(note => {
                    const img = note.image;
                    const isCompleted = img.status === 'completed';
                    // Full image for preview modal
                    const fullSrc = isCompleted ? (img.local_path
                        ? `/api/corridor/images/${img.local_path.split('/').pop()}`
                        : img.image_url) : '';
                    // Thumbnail for gallery (falls back to full image if no thumbnail)
                    const thumbSrc = isCompleted ? (img.thumbnail_path
                        ? `/api/corridor/thumbnails/${img.thumbnail_path.split('/').pop()}`
                        : fullSrc) : '';
                    const escapedContent = escapeHtml(note.content).replace(/'/g, "\\'").replace(/"/g, "&quot;");
                    const dateStr = formatDate(note.created_at);

                    html += `
                        <div class="corridor-card">
                            ${isCompleted ? `
                                <img class="corridor-card-image" src="${thumbSrc}" alt="场景重现"
                                     onclick="previewImage('${fullSrc}', '${escapedContent}')" loading="lazy">
                            ` : `
                                <div class="corridor-card-image generating">🎨</div>
                            `}
                            <div class="corridor-card-content">
                                <div class="corridor-card-text">${escapeHtml(note.content)}</div>
                                <div class="corridor-card-meta">
                                    <span class="corridor-card-date">📅 ${dateStr}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });

            gallery.innerHTML = html;
        }

        function previewImage(src, text) {
            let modal = document.getElementById('imagePreviewModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'imagePreviewModal';
                modal.className = 'image-preview-modal';
                modal.innerHTML = `
                    <button class="image-preview-close" onclick="closeImagePreview()">&times;</button>
                    <img src="" alt="预览">
                    <div class="image-preview-text"></div>
                `;
                modal.onclick = (e) => {
                    if (e.target === modal) closeImagePreview();
                };
                document.body.appendChild(modal);
            }
            modal.querySelector('img').src = src;
            modal.querySelector('.image-preview-text').textContent = text || '';
            modal.classList.add('active');
        }

        function closeImagePreview() {
            const modal = document.getElementById('imagePreviewModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        function updateCorridorUI() {
            if (!corridorStatus) return;

            const { status, with_image, suitable, pending, not_suitable, total_notes } = corridorStatus;
            const processStatus = status || {};

            // 适合生成的总数 = 已生成 + 待处理
            const totalSuitable = with_image + (suitable || 0);

            // 更新统计
            const suitableEl = document.getElementById('corridorSuitable');
            const generatedEl = document.getElementById('corridorGenerated');
            const pendingEl = document.getElementById('corridorPending');

            if (suitableEl) suitableEl.textContent = totalSuitable;
            if (generatedEl) generatedEl.textContent = with_image;
            if (pendingEl) pendingEl.textContent = suitable || 0;

            // 更新进度条
            const progress = totalSuitable > 0 ? Math.round((with_image / totalSuitable) * 100) : 0;
            const progressFill = document.getElementById('corridorProgressFill');
            if (progressFill) progressFill.style.width = `${progress}%`;

            // 更新按钮
            const btn = document.getElementById('corridorStartBtn');
            const pauseBtn = document.getElementById('corridorPauseBtn');
            const pendingCount = suitable || 0;

            if (btn) {
                if (processStatus.status === 'processing') {
                    btn.disabled = true;
                    btn.textContent = `⏳ 处理中 (${processStatus.processed_notes || 0}/${processStatus.total_notes || 0})`;
                    // 显示暂停按钮
                    if (pauseBtn) {
                        pauseBtn.style.display = 'inline-flex';
                        pauseBtn.textContent = '⏸️ 暂停';
                    }
                } else if (processStatus.status === 'paused') {
                    btn.disabled = true;
                    btn.textContent = `⏸️ 已暂停 (${processStatus.processed_notes || 0}/${processStatus.total_notes || 0})`;
                    // 显示恢复按钮
                    if (pauseBtn) {
                        pauseBtn.style.display = 'inline-flex';
                        pauseBtn.textContent = '▶️ 继续';
                    }
                } else if (processStatus.status === 'interrupted') {
                    btn.disabled = false;
                    btn.textContent = `🔄 继续生成 ${pendingCount} 张`;
                    if (pauseBtn) pauseBtn.style.display = 'none';
                } else {
                    btn.disabled = pendingCount === 0;
                    btn.textContent = pendingCount > 0 ? `✨ 生成 ${pendingCount} 张图片` : '✅ 已全部生成';
                    if (pauseBtn) pauseBtn.style.display = 'none';
                }
            }
        }

        // 暂停/恢复处理
        async function toggleCorridorPause() {
            if (!currentUser || !corridorStatus) return;

            const processStatus = corridorStatus.status || {};
            const action = processStatus.status === 'paused' ? 'resume' : 'pause';

            try {
                const resp = await fetch('/api/corridor/pause', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action })
                });

                const result = await resp.json();
                if (result.success) {
                    showToast(result.message);
                    await loadCorridorData();
                } else {
                    showToast(result.message || '操作失败');
                }
            } catch (e) {
                console.error('Failed to toggle pause:', e);
                showToast('操作失败');
            }
        }

        async function startCorridorProcess() {
            if (!currentUser) return;

            const btn = document.getElementById('corridorStartBtn');
            if (btn) {
                btn.disabled = true;
                btn.textContent = '启动中...';
            }

            try {
                const resp = await fetch('/api/corridor/start', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await resp.json();
                if (result.success) {
                    showToast(`开始处理 ${result.total_notes} 条快记`);
                    startCorridorPolling();
                } else {
                    showToast(result.message || '启动失败');
                    if (btn) {
                        btn.disabled = false;
                        btn.textContent = '开始生成';
                    }
                }
            } catch (e) {
                console.error('Failed to start corridor process:', e);
                showToast('启动失败');
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = '开始生成';
                }
            }
        }

        function startCorridorPolling() {
            if (corridorPollingTimer) {
                clearInterval(corridorPollingTimer);
            }

            corridorPollingTimer = setInterval(async () => {
                await loadCorridorData();

                if (corridorStatus?.status?.status !== 'processing') {
                    clearInterval(corridorPollingTimer);
                    corridorPollingTimer = null;

                    if (corridorStatus?.status?.status === 'completed') {
                        showToast('时光回廊处理完成！');
                    }
                }
            }, 5000);
        }

        function copyNoteById(id) {
            const note = allNotes.find(n => n.id === id);
            if (note) {
                navigator.clipboard.writeText(note.content);
                showToast('Copied to clipboard');
            }
        }

        function toggleNoteMenu(event, id) {
            event.stopPropagation();
            document.querySelectorAll('.note-menu-dropdown').forEach(d => {
                if (d.id !== `menu-${id}`) d.classList.remove('active');
            });
            document.getElementById(`menu-${id}`).classList.toggle('active');
        }

        function copyNote(id) {
            const card = document.querySelector(`.note-card[data-id="${id}"]`);
            const content = card.querySelector('.note-content').textContent;
            navigator.clipboard.writeText(content);
            showToast('Copied to clipboard');
            document.querySelectorAll('.note-menu-dropdown').forEach(d => d.classList.remove('active'));
        }

        function confirmDelete(id) {
            deleteNoteId = id;
            document.getElementById('dialogOverlay').classList.add('active');
            document.querySelectorAll('.note-menu-dropdown').forEach(d => d.classList.remove('active'));
        }

        function closeDialog() {
            document.getElementById('dialogOverlay').classList.remove('active');
            deleteNoteId = null;
        }

        function closeDialogOnBackdrop(event) {
            if (event.target === event.currentTarget) {
                closeDialog();
            }
        }

        document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
            if (!deleteNoteId) return;

            try {
                const response = await fetch(API_BASE + '/api/notes/' + deleteNoteId, {
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });

                if (!response.ok) throw new Error('Failed to delete');

                closeDialog();
                loadNotes();
                showToast('Deleted');
            } catch (err) {
                showToast('Failed to delete');
            }
        });

        // ==================== Toast ====================
        function showToast(message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast success';
            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('exit');
                setTimeout(() => toast.remove(), 250);
            }, 3000);
        }

        // ==================== Helpers ====================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + ' min ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + ' hr ago';

            return date.toLocaleDateString('zh-CN', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ==================== Import ====================
        let parsedNotes = [];

        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                parsedNotes = parseMdFile(content);

                // Show import dialog
                document.getElementById('importDialogOverlay').classList.add('active');

                if (parsedNotes.length === 0) {
                    document.getElementById('importMessage').textContent = 'No notes found in this file.';
                    document.getElementById('importPreview').style.display = 'none';
                    document.getElementById('confirmImportBtn').disabled = true;
                } else {
                    document.getElementById('importMessage').textContent = `Found ${parsedNotes.length} notes to import:`;
                    document.getElementById('importPreview').style.display = 'block';
                    document.getElementById('importPreview').innerHTML = parsedNotes.map((note, i) =>
                        `<div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--border-1);">
                            <div style="font-size: 0.75rem; color: var(--text-3); margin-bottom: 4px;">${note.created_at}</div>
                            <div style="color: var(--text-1);">${escapeHtml(note.content.substring(0, 100))}${note.content.length > 100 ? '...' : ''}</div>
                        </div>`
                    ).join('');
                    document.getElementById('confirmImportBtn').disabled = false;
                }
            };
            reader.readAsText(file);

            // Reset file input
            event.target.value = '';
        }

        function parseMdFile(content) {
            const notes = [];
            const lines = content.split('\n');

            // Pattern for date headers like "### 2024年8月13日 17:43:44"
            const datePattern = /^###\s*(\d{4})年(\d{1,2})月(\d{1,2})日\s+(\d{1,2}):(\d{2}):(\d{2})/;

            let currentNote = null;
            let currentContent = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];

                // Check if this is a date header
                const match = line.match(datePattern);
                if (match) {
                    // Save previous note if exists
                    if (currentNote) {
                        const content = currentContent.join('\n').trim();
                        if (content) {
                            currentNote.content = content;
                            notes.push(currentNote);
                        }
                    }

                    // Parse date: 2024年8月13日 17:43:44 -> 2024-08-13 17:43:44
                    const year = match[1];
                    const month = match[2].padStart(2, '0');
                    const day = match[3].padStart(2, '0');
                    const hour = match[4].padStart(2, '0');
                    const minute = match[5];
                    const second = match[6];

                    currentNote = {
                        created_at: `${year}-${month}-${day} ${hour}:${minute}:${second}`,
                        content: ''
                    };
                    currentContent = [];
                } else if (currentNote) {
                    // Skip day headers like "## [[2024-08-14]]"
                    if (line.match(/^##\s*\[\[.*\]\]/)) {
                        continue;
                    }
                    currentContent.push(line);
                }
            }

            // Don't forget the last note
            if (currentNote) {
                const content = currentContent.join('\n').trim();
                if (content) {
                    currentNote.content = content;
                    notes.push(currentNote);
                }
            }

            return notes;
        }

        function closeImportDialog() {
            document.getElementById('importDialogOverlay').classList.remove('active');
            parsedNotes = [];
        }

        function closeImportDialogOnBackdrop(event) {
            if (event.target === event.currentTarget) {
                closeImportDialog();
            }
        }

        document.getElementById('confirmImportBtn').addEventListener('click', async () => {
            if (parsedNotes.length === 0) return;

            const btn = document.getElementById('confirmImportBtn');
            btn.disabled = true;
            btn.textContent = 'Importing...';

            try {
                const response = await fetch(API_BASE + '/api/notes/import', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + currentUser.token
                    },
                    body: JSON.stringify({ notes: parsedNotes })
                });

                if (!response.ok) throw new Error('Failed to import');

                const result = await response.json();
                closeImportDialog();
                loadNotes();
                showToast(`Imported ${result.imported} notes`);
            } catch (err) {
                showToast('Failed to import');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Import';
            }
        });

        // ==================== Starlight ====================
        async function triggerStarlight(refresh = false) {
            document.getElementById('starlightOverlay').classList.add('active');
            const loadingText = refresh ? '正在重新生成...' : '正在加载...';
            document.getElementById('starlightContent').innerHTML = '<div class="loading"><div class="loading-spinner"></div><span>' + loadingText + '</span></div>';

            try {
                const url = refresh ? '/api/notes/starlight?refresh=true' : '/api/notes/starlight';
                const response = await fetch(API_BASE + url, {
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });

                if (!response.ok) throw new Error('Failed to fetch starlight');

                const data = await response.json();
                renderStarlight(data);
            } catch (err) {
                document.getElementById('starlightContent').innerHTML = '<div class="starlight-empty">生成报告失败，请稍后再试。</div>';
            }
        }

        function renderStarlight(data) {
            const content = document.getElementById('starlightContent');

            // 新的报告格式
            const reportHtml = data.report ? data.report.replace(/\n/g, '<br>') : '';

            // 格式化生成时间
            let timeInfo = '';
            if (data.generated_at) {
                const genDate = new Date(data.generated_at);
                const now = new Date();
                const diffMs = now - genDate;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                let timeAgo;
                if (diffMins < 1) {
                    timeAgo = '刚刚';
                } else if (diffMins < 60) {
                    timeAgo = diffMins + '分钟前';
                } else if (diffHours < 24) {
                    timeAgo = diffHours + '小时前';
                } else {
                    timeAgo = diffDays + '天前';
                }
                timeInfo = `<span class="starlight-time">生成于 ${timeAgo}</span>`;
            }

            content.innerHTML = `
                <div class="starlight-report">
                    ${reportHtml}
                </div>
                <div class="starlight-footer">
                    ${timeInfo}
                    <button class="btn-starlight-refresh" onclick="triggerStarlight(true)">
                        <span>&#8635;</span> 重新生成
                    </button>
                </div>
            `;
        }

        function closeStarlight() {
            document.getElementById('starlightOverlay').classList.remove('active');
        }

        function closeStarlightOnBackdrop(event) {
            if (event.target === event.currentTarget) {
                closeStarlight();
            }
        }

        // ==================== Scene Portal ====================

        // ==================== Biography ====================
        let biographyData = null;
        let biographyStatus = null;
        let biographyPollInterval = null;

        function openBiography() {
            document.getElementById('biographyPage').classList.add('active');
            document.body.style.overflow = 'hidden';
            loadBiography();
        }

        function closeBiography() {
            document.getElementById('biographyPage').classList.remove('active');
            document.body.style.overflow = '';
            // 停止轮询
            if (biographyPollInterval) {
                clearInterval(biographyPollInterval);
                biographyPollInterval = null;
            }
        }

        async function loadBiography() {
            const content = document.getElementById('biographyContent');

            try {
                const response = await fetch(API_BASE + '/api/biography', {
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });

                if (!response.ok) throw new Error('Failed to fetch biography');

                const data = await response.json();
                biographyStatus = data.status;

                if (data.status === 'not_enough') {
                    content.innerHTML = `
                        <div class="bio-empty">
                            <div class="bio-empty-icon">📖</div>
                            <h3 class="bio-empty-title">故事正在酝酿中</h3>
                            <p class="bio-empty-text">${escapeHtml(data.message)}</p>
                            <p style="font-size: 0.875rem; color: var(--text-3);">
                                当前有意义记录: ${data.note_count} / ${data.required} 条
                            </p>
                        </div>
                    `;
                    document.getElementById('biographyRefreshBtn').style.display = 'none';
                    return;
                }

                if (data.status === 'empty') {
                    content.innerHTML = `
                        <div class="bio-empty">
                            <div class="bio-empty-icon">✨</div>
                            <h3 class="bio-empty-title">你的传奇等待书写</h3>
                            <p class="bio-empty-text">你已有 ${data.note_count} 条有意义的记录，现在可以生成你的专属传记了。</p>
                            <button class="bio-generate-btn" onclick="generateBiography()" id="bioGenerateBtn">
                                <span>📜</span> 开始书写我的传奇
                            </button>
                        </div>
                    `;
                    document.getElementById('biographyRefreshBtn').style.display = 'none';
                    return;
                }

                // 正在生成中
                if (data.status === 'generating') {
                    showBiographyProgress(data);
                    document.getElementById('biographyRefreshBtn').style.display = 'none';
                    // 启动轮询
                    startBiographyPolling();
                    return;
                }

                // Has biography
                biographyData = data.biography;
                document.getElementById('biographyRefreshBtn').style.display = 'flex';
                renderBiography(data);

            } catch (err) {
                console.error('Load biography error:', err);
                content.innerHTML = `
                    <div class="bio-empty">
                        <div class="bio-empty-icon">😔</div>
                        <h3 class="bio-empty-title">加载失败</h3>
                        <p class="bio-empty-text">无法加载传记，请稍后重试</p>
                    </div>
                `;
            }
        }

        async function generateBiography(forceRegenerate = false) {
            const content = document.getElementById('biographyContent');
            const btn = document.getElementById('bioGenerateBtn');

            if (btn) btn.disabled = true;

            // 显示初始加载状态
            showBiographyProgress({
                phase: '正在准备生成...',
                progress: 0,
                current_step: 0,
                total_steps: 1
            });

            try {
                const response = await fetch(API_BASE + '/api/biography/generate', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + currentUser.token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ force_regenerate: forceRegenerate })
                });

                if (!response.ok) throw new Error('Failed to generate biography');

                const data = await response.json();

                if (data.error) {
                    showMessage(data.message || '生成失败', 'error');
                    loadBiography();
                    return;
                }

                // 后端现在是异步生成，返回 status: "generating"
                if (data.status === 'generating') {
                    // 更新进度显示
                    showBiographyProgress(data);
                    // 启动轮询检查进度
                    startBiographyPolling();
                    return;
                }

                // 如果是同步返回结果（增量更新可能较快直接返回）
                if (data.biography) {
                    biographyData = data.biography;
                    biographyStatus = 'ready';
                    document.getElementById('biographyRefreshBtn').style.display = 'flex';
                    showMessage(data.update_summary || '传记生成完成', 'success');
                    renderBiography({ biography: data.biography, can_update: false, new_notes_count: 0 });
                }

            } catch (err) {
                console.error('Generate biography error:', err);
                showMessage('生成传记失败，请稍后重试', 'error');
                loadBiography();
            }
        }

        function refreshBiography() {
            const btn = document.getElementById('biographyRefreshBtn');
            btn.classList.add('loading');

            generateBiography(false).finally(() => {
                btn.classList.remove('loading');
            });
        }

        // 显示传记生成进度
        function showBiographyProgress(data) {
            const content = document.getElementById('biographyContent');
            const progress = data.progress || 0;
            const phase = data.phase || '正在生成...';
            const currentStep = data.current_step || 0;
            const totalSteps = data.total_steps || 1;

            // 选择合适的动画 emoji
            const emojis = ['✍️', '📝', '📖', '🖋️', '📜'];
            const emojiIndex = Math.floor(Date.now() / 1000) % emojis.length;

            content.innerHTML = `
                <div class="biography-loading">
                    <div class="biography-loading-icon">
                        <span class="loading-emoji">${emojis[emojiIndex]}</span>
                    </div>
                    <p class="biography-loading-text">${escapeHtml(phase)}</p>
                    <div class="biography-progress-bar">
                        <div class="biography-progress-fill" style="width: ${progress}%"></div>
                    </div>
                    <p class="biography-loading-sub">
                        ${totalSteps > 1 ? `步骤 ${currentStep}/${totalSteps} · ` : ''}${progress}%
                    </p>
                    <p style="font-size: 0.75rem; color: var(--text-3); margin-top: 1rem;">
                        传记作家正在细细品读你的记录，请耐心等待...
                    </p>
                </div>
            `;
        }

        // 启动进度轮询
        function startBiographyPolling() {
            // 先清除之前的轮询
            if (biographyPollInterval) {
                clearInterval(biographyPollInterval);
            }

            // 每3秒查询一次进度
            biographyPollInterval = setInterval(async () => {
                try {
                    const response = await fetch(API_BASE + '/api/biography', {
                        headers: { 'Authorization': 'Bearer ' + currentUser.token }
                    });

                    if (!response.ok) return;

                    const data = await response.json();

                    if (data.status === 'generating') {
                        // 更新进度显示
                        showBiographyProgress(data);
                    } else if (data.status === 'ready' && data.biography) {
                        // 生成完成
                        clearInterval(biographyPollInterval);
                        biographyPollInterval = null;

                        biographyData = data.biography;
                        biographyStatus = 'ready';
                        document.getElementById('biographyRefreshBtn').style.display = 'flex';
                        showMessage('传记生成完成！', 'success');
                        renderBiography(data);
                    } else if (data.status === 'error') {
                        // 生成失败
                        clearInterval(biographyPollInterval);
                        biographyPollInterval = null;

                        showMessage(data.error || '生成失败', 'error');
                        loadBiography();
                    } else {
                        // 其他状态（可能是后端重启导致状态丢失）
                        clearInterval(biographyPollInterval);
                        biographyPollInterval = null;
                        loadBiography();
                    }
                } catch (err) {
                    console.error('Poll biography status error:', err);
                }
            }, 3000);
        }

        function renderBiography(data) {
            const content = document.getElementById('biographyContent');
            const bio = data.biography;

            let html = '';

            // Update banner if applicable
            if (data.can_update && data.new_notes_count > 0) {
                html += `
                    <div class="bio-update-banner">
                        <div class="bio-update-info">
                            <strong>有新内容可以更新</strong>
                            <small>${data.new_notes_count} 条新记录等待融入你的故事</small>
                        </div>
                        <button class="bio-update-btn" onclick="generateBiography(false)">更新传记</button>
                    </div>
                `;
            }

            // Cover
            html += `
                <div class="bio-cover">
                    <div class="bio-cover-emoji">${bio.cover_emoji || '📜'}</div>
                    <h1 class="bio-cover-title">${escapeHtml(bio.title || '我的传奇')}</h1>
                    <p class="bio-cover-subtitle">${escapeHtml(bio.subtitle || '')}</p>
                </div>
            `;

            // Portrait
            if (bio.portrait) {
                html += `
                    <div class="bio-section">
                        <div class="bio-section-title">
                            <span class="bio-section-icon">👤</span>
                            人物画像
                        </div>
                        <div class="bio-portrait">
                            <div class="bio-tagline">"${escapeHtml(bio.portrait.tagline || '')}"</div>
                            <p class="bio-essence">${escapeHtml(bio.portrait.essence || '')}</p>

                            <div class="bio-traits-row">
                                <div class="bio-traits-col">
                                    <h4>✨ 闪光点</h4>
                                    <ul class="bio-traits-list">
                                        ${(bio.portrait.strengths || []).map(s => `<li>${escapeHtml(s)}</li>`).join('')}
                                    </ul>
                                </div>
                                <div class="bio-traits-col">
                                    <h4>🎭 独特之处</h4>
                                    <ul class="bio-traits-list">
                                        ${(bio.portrait.quirks || []).map(q => `<li>${escapeHtml(q)}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>

                            ${bio.portrait.driving_force ? `
                                <div class="bio-driving-force">
                                    <h4>💫 内心驱动力</h4>
                                    <p>${escapeHtml(bio.portrait.driving_force)}</p>
                                </div>
                            ` : ''}

                            ${bio.portrait.spirit ? `
                                <div class="bio-spirit">${escapeHtml(bio.portrait.spirit)}</div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            // Chapters
            if (bio.chapters && bio.chapters.length > 0) {
                html += `
                    <div class="bio-section">
                        <div class="bio-section-title">
                            <span class="bio-section-icon">📖</span>
                            人生篇章
                        </div>
                        ${bio.chapters.map(ch => `
                            <div class="bio-chapter">
                                <div class="bio-chapter-header">
                                    <div class="bio-chapter-emoji">${ch.emoji || '📄'}</div>
                                    <div class="bio-chapter-meta">
                                        <h3 class="bio-chapter-title">${escapeHtml(ch.title || '')}</h3>
                                        ${ch.subtitle ? `<p class="bio-chapter-subtitle">${escapeHtml(ch.subtitle)}</p>` : ''}
                                        ${ch.period ? `<span class="bio-chapter-period">${escapeHtml(ch.period)}</span>` : ''}
                                    </div>
                                </div>

                                ${ch.opening ? `<div class="bio-chapter-opening">${escapeHtml(ch.opening)}</div>` : ''}

                                <div class="bio-chapter-narrative">${escapeHtml(ch.narrative || '')}</div>

                                ${ch.key_moments && ch.key_moments.length > 0 ? `
                                    <div class="bio-chapter-moments">
                                        <h5>💫 关键时刻</h5>
                                        <ul class="bio-moments-list">
                                            ${ch.key_moments.map(m => `<li>${escapeHtml(m)}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}

                                ${ch.growth ? `
                                    <div class="bio-chapter-growth">
                                        <h5>🌱 成长与蜕变</h5>
                                        <p>${escapeHtml(ch.growth)}</p>
                                    </div>
                                ` : ''}

                                ${ch.closing ? `<div class="bio-chapter-closing">${escapeHtml(ch.closing)}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Life Themes
            if (bio.life_themes && bio.life_themes.length > 0) {
                html += `
                    <div class="bio-section">
                        <div class="bio-section-title">
                            <span class="bio-section-icon">🎯</span>
                            人生主题
                        </div>
                        ${bio.life_themes.map(th => `
                            <div class="bio-theme">
                                <div class="bio-theme-header">
                                    <span class="bio-theme-emoji">${th.emoji || '🔮'}</span>
                                    <span class="bio-theme-name">${escapeHtml(th.theme || '')}</span>
                                </div>
                                <p class="bio-theme-desc">${escapeHtml(th.description || '')}</p>

                                ${th.manifestations && th.manifestations.length > 0 ? `
                                    <div class="bio-theme-manifestations">
                                        <h5>生活中的体现</h5>
                                        <div class="bio-manifestation-tags">
                                            ${th.manifestations.map(m => `<span class="bio-manifestation-tag">${escapeHtml(m)}</span>`).join('')}
                                        </div>
                                    </div>
                                ` : ''}

                                ${th.evolution ? `<p class="bio-theme-evolution">${escapeHtml(th.evolution)}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Quotes
            if (bio.quotes && bio.quotes.length > 0) {
                html += `
                    <div class="bio-section">
                        <div class="bio-section-title">
                            <span class="bio-section-icon">💬</span>
                            金句集
                        </div>
                        ${bio.quotes.map(q => `
                            <div class="bio-quote">
                                <p class="bio-quote-text">${escapeHtml(q.text || '')}</p>
                                <div class="bio-quote-meta">
                                    <span class="bio-quote-source">${q.emoji || ''} ${escapeHtml(q.source || '')}</span>
                                    ${q.meaning ? `<span class="bio-quote-meaning">${escapeHtml(q.meaning)}</span>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Timeline
            if (bio.timeline && bio.timeline.length > 0) {
                html += `
                    <div class="bio-section">
                        <div class="bio-section-title">
                            <span class="bio-section-icon">⏳</span>
                            人生轨迹
                        </div>
                        <div class="bio-timeline">
                            ${bio.timeline.map(ev => `
                                <div class="bio-timeline-item">
                                    <div class="bio-timeline-dot"></div>
                                    <div class="bio-timeline-date">${escapeHtml(ev.date || '')}</div>
                                    <div class="bio-timeline-title">
                                        <span>${ev.emoji || '📌'}</span>
                                        ${escapeHtml(ev.title || '')}
                                    </div>
                                    <p class="bio-timeline-desc">${escapeHtml(ev.description || '')}</p>
                                    ${ev.significance ? `<p class="bio-timeline-significance">${escapeHtml(ev.significance)}</p>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // Epilogue
            if (bio.epilogue) {
                html += `
                    <div class="bio-section">
                        <div class="bio-section-title">
                            <span class="bio-section-icon">🌟</span>
                            尾声
                        </div>
                        <div class="bio-epilogue">
                            <p class="bio-epilogue-text">${escapeHtml(bio.epilogue)}</p>
                            <div class="bio-meta">
                                <span>📝 v${bio.version || 1}</span>
                                <span>🕐 ${bio.last_updated_at || bio.generated_at || ''}</span>
                                <span>📊 基于 ${bio.note_count || 0} 条记录</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            content.innerHTML = html;
        }

        // ==================== Insights ====================
        let insightsData = null;

        function openInsights() {
            document.getElementById('insightsPage').classList.add('active');
            document.body.style.overflow = 'hidden';
            loadInsights(false);
        }

        function closeInsights() {
            document.getElementById('insightsPage').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function loadInsights(refresh = false) {
            const content = document.getElementById('insightsContent');

            if (refresh) {
                content.innerHTML = `
                    <div class="insights-loading">
                        <div class="insights-loading-icon">
                            <span class="loading-emoji">🔮</span>
                        </div>
                        <p class="insights-loading-text">正在重新分析...</p>
                        <p class="insights-loading-sub">这可能需要一点时间</p>
                    </div>
                `;
            }

            try {
                const url = refresh ? '/api/insights?refresh=true' : '/api/insights';
                const response = await fetch(API_BASE + url, {
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });

                if (!response.ok) throw new Error('Failed to fetch insights');

                const data = await response.json();

                if (data.error === 'not_enough_notes') {
                    content.innerHTML = `
                        <div class="insights-error">
                            <div class="insights-error-icon">📝</div>
                            <p class="insights-error-text">${data.message}</p>
                            <p class="insights-error-text" style="margin-top: 12px; font-size: 0.875rem; color: var(--text-3);">
                                当前: ${data.note_count} / ${data.required} 条
                            </p>
                        </div>
                    `;
                    return;
                }

                insightsData = data;
                renderInsights(data);

            } catch (err) {
                console.error('Insights error:', err);
                content.innerHTML = `
                    <div class="insights-error">
                        <div class="insights-error-icon">😔</div>
                        <p class="insights-error-text">生成洞见报告失败，请稍后再试。</p>
                    </div>
                `;
            }
        }

        async function refreshInsights() {
            const btn = document.querySelector('.insights-refresh');
            if (btn) btn.classList.add('spinning');
            await loadInsights(true);
            if (btn) btn.classList.remove('spinning');
        }

        function renderInsights(data) {
            const content = document.getElementById('insightsContent');

            // Build emotion ring gradient
            let gradientParts = [];
            let currentDeg = 0;
            if (data.emotions && data.emotions.distribution) {
                data.emotions.distribution.forEach(em => {
                    const endDeg = currentDeg + (em.percent * 3.6);
                    gradientParts.push(`${em.color} ${currentDeg}deg ${endDeg}deg`);
                    currentDeg = endDeg;
                });
            }
            const ringGradient = gradientParts.length > 0
                ? `conic-gradient(${gradientParts.join(', ')})`
                : 'conic-gradient(var(--surface-2) 0deg 360deg)';

            content.innerHTML = `
                <!-- MBTI Card -->
                <div class="insight-section">
                    <div class="section-label">人格画像</div>
                    <div class="mbti-card">
                        <div class="mbti-type-row">
                            <span class="mbti-type">${escapeHtml(data.mbti?.type || 'XXXX')}</span>
                            <span class="mbti-emoji">${data.mbti?.type_emoji || '🌟'}</span>
                        </div>
                        <div class="mbti-name">${escapeHtml(data.mbti?.type_name || '探索中')}</div>
                        <div class="mbti-description">${escapeHtml(data.mbti?.description || '')}</div>
                        <div class="mbti-traits">
                            ${(data.mbti?.traits || []).map(t => `<span class="mbti-trait">${escapeHtml(t)}</span>`).join('')}
                        </div>
                        <div class="mbti-dimensions">
                            ${(data.mbti?.dimensions || []).map(d => `
                                <div class="dimension-row">
                                    <span class="dimension-label">${escapeHtml(d.left)}</span>
                                    <div class="dimension-bar">
                                        <div class="dimension-fill" style="width: ${d.score}%"></div>
                                    </div>
                                    <span class="dimension-label-right">${escapeHtml(d.right)}</span>
                                </div>
                            `).join('')}
                        </div>
                        ${(data.mbti?.evidences && data.mbti.evidences.length > 0) ? `
                            <div class="mbti-evidences">
                                <div class="evidence-label">你的文字里藏着这些线索</div>
                                ${data.mbti.evidences.map(e => `<div class="evidence-item">"${escapeHtml(e)}"</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>

                <!-- Emotions Card -->
                <div class="insight-section">
                    <div class="section-label">情绪地图</div>
                    <div class="emotions-card">
                        <div class="emotions-header">
                            <span class="emotions-dominant-emoji">${data.emotions?.dom_emoji || '😊'}</span>
                            <div class="emotions-dominant-text">
                                <div class="emotions-dominant-label">主导情绪</div>
                                <div class="emotions-dominant-name">${escapeHtml(data.emotions?.dominant || '平静')}</div>
                            </div>
                        </div>
                        <div class="emotions-ring-container">
                            <div class="emotions-ring" style="background: ${ringGradient}">
                                <div class="emotions-ring-center">${data.emotions?.dom_emoji || '😊'}</div>
                            </div>
                            <div class="emotions-legend">
                                ${(data.emotions?.distribution || []).map(em => `
                                    <div class="emotion-legend-item">
                                        <span class="emotion-dot" style="background: ${em.color}"></span>
                                        <span class="emotion-name">${em.emoji} ${escapeHtml(em.name)}</span>
                                        <span class="emotion-percent">${em.percent}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="emotions-trend">${escapeHtml(data.emotions?.trend || '')}</div>
                        <div class="emotions-insight">${escapeHtml(data.emotions?.insight || '')}</div>
                    </div>
                </div>

                <!-- Keywords Cloud -->
                <div class="insight-section">
                    <div class="section-label">内心词云</div>
                    <div class="keywords-card">
                        <div class="keywords-cloud">
                            ${(data.keywords || []).map((kw, i) => `
                                <span class="keyword-tag keyword-size-${kw.size} keyword-${kw.emotion}"
                                      style="animation-delay: ${i * 0.05}s">
                                    ${escapeHtml(kw.word)}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <!-- Future Forecast -->
                <div class="insight-section">
                    <div class="section-label">未来预见</div>
                    <div class="future-card">
                        ${data.future && (data.future.emerging_interests?.length || data.future.summary) ? `
                        <!-- 兴趣萌芽 -->
                        <div class="future-section">
                            <div class="future-section-title">
                                <span class="future-icon">🌱</span>
                                <span>兴趣萌芽</span>
                            </div>
                            <div class="interests-list">
                                ${(data.future.emerging_interests || []).map(item => `
                                    <div class="interest-item">
                                        <div class="interest-header">
                                            <span class="interest-emoji">${item.emoji || '✨'}</span>
                                            <span class="interest-topic">${escapeHtml(item.topic)}</span>
                                        </div>
                                        <div class="interest-signal">${escapeHtml(item.signal)}</div>
                                        <div class="interest-suggestion">${escapeHtml(item.suggestion)}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- 发展趋势 -->
                        <div class="future-section">
                            <div class="future-section-title">
                                <span class="future-icon">📈</span>
                                <span>发展趋势</span>
                            </div>
                            <div class="trajectory-content">
                                <div class="trajectory-flow">
                                    <span class="trajectory-state from-state">${escapeHtml(data.future.growth_trajectory?.from_state || '')}</span>
                                    <span class="trajectory-arrow">→</span>
                                    <span class="trajectory-state to-state">${escapeHtml(data.future.growth_trajectory?.to_state || '')}</span>
                                </div>
                                <div class="trajectory-evidence">${escapeHtml(data.future.growth_trajectory?.evidence || '')}</div>
                                <div class="trajectory-meaning">${escapeHtml(data.future.growth_trajectory?.meaning || '')}</div>
                            </div>
                        </div>

                        <!-- 潜力发现 -->
                        <div class="future-section">
                            <div class="future-section-title">
                                <span class="future-icon">✨</span>
                                <span>潜力发现</span>
                            </div>
                            <div class="potential-list">
                                ${(data.future.hidden_potential || []).map(item => `
                                    <div class="potential-item">
                                        <div class="potential-header">
                                            <span class="potential-emoji">${item.emoji || '💫'}</span>
                                            <span class="potential-ability">${escapeHtml(item.ability)}</span>
                                        </div>
                                        <div class="potential-evidence">${escapeHtml(item.evidence)}</div>
                                        <div class="potential-affirmation">${escapeHtml(item.affirmation)}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- 整体展望 -->
                        <div class="future-summary">
                            <div class="future-summary-icon">🔮</div>
                            <div class="future-summary-text">${escapeHtml(data.future.summary || '')}</div>
                        </div>
                        ` : `
                        <div class="future-empty">
                            <div class="future-empty-icon">🔮</div>
                            <div class="future-empty-text">点击右上角刷新按钮，获取你的未来预见</div>
                        </div>
                        `}
                    </div>
                </div>

                <!-- Personal Note -->
                <div class="insight-section">
                    <div class="section-label">专属寄语</div>
                    <div class="personal-note-card">
                        <div class="personal-note-text">${escapeHtml(data.personal_note || '')}</div>
                        <div class="personal-note-footer">
                            <span class="personal-note-date">${formatInsightDate(data.generated_at)}</span>
                            <span class="personal-note-count">基于 ${data.note_count || 0} 条快记分析</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function formatInsightDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            return `${year}年${month}月${day}日`;
        }

        // ==================== Themes ====================
        let userThemes = [];
        let currentThemeId = 0;
        let editingThemeId = null;
        let selectedThemeColor = '#8B5CF6';
        let noteToMove = null;

        async function loadThemes() {
            try {
                const response = await fetch(API_BASE + '/api/themes', {
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });
                if (response.ok) {
                    userThemes = await response.json() || [];
                    renderThemesList();
                }
            } catch (err) {
                console.error('Failed to load themes:', err);
            }
        }

        function renderThemesList() {
            const list = document.getElementById('themesList');
            const mobileList = document.getElementById('mobileThemesList');

            let html = `
                <div class="category-item ${currentThemeId === 0 ? 'active' : ''}" onclick="filterByTheme(0)">
                    <span class="category-name category-all">全部快记</span>
                </div>
            `;

            for (const theme of userThemes) {
                html += `
                    <div class="category-item ${currentThemeId === theme.id ? 'active' : ''}" onclick="filterByTheme(${theme.id})">
                        <span class="category-name theme-item">
                            <span class="theme-dot" style="background: ${theme.color}"></span>
                            ${escapeHtml(theme.name)}
                        </span>
                        <span class="category-count">${theme.note_count}</span>
                    </div>
                `;
            }

            if (list) list.innerHTML = html;
            if (mobileList) mobileList.innerHTML = html;
        }

        function filterByTheme(themeId) {
            currentThemeId = themeId;
            currentCategoryId = 0; // Reset category filter
            renderThemesList();
            loadNotes(true);

            // Update title
            const title = document.getElementById('notesListTitle');
            if (themeId === 0) {
                title.textContent = 'Notes';
            } else {
                const theme = userThemes.find(t => t.id === themeId);
                title.textContent = theme ? theme.name : 'Notes';
            }

            // Close mobile dropdown
            const dropdown = document.getElementById('mobileDropdown');
            if (dropdown) dropdown.classList.remove('active');
        }

        function showCreateThemeDialog() {
            editingThemeId = null;
            document.getElementById('themeDialogTitle').textContent = 'Create Theme';
            document.getElementById('themeNameInput').value = '';
            selectThemeColor('#8B5CF6');
            document.getElementById('themeDialogOverlay').classList.add('active');
        }

        function showEditThemeDialog(themeId) {
            const theme = userThemes.find(t => t.id === themeId);
            if (!theme) return;

            editingThemeId = themeId;
            document.getElementById('themeDialogTitle').textContent = 'Edit Theme';
            document.getElementById('themeNameInput').value = theme.name;
            selectThemeColor(theme.color);
            document.getElementById('themeDialogOverlay').classList.add('active');
        }

        function closeThemeDialog() {
            document.getElementById('themeDialogOverlay').classList.remove('active');
        }

        function closeThemeDialogOnBackdrop(event) {
            if (event.target === event.currentTarget) {
                closeThemeDialog();
            }
        }

        function selectThemeColor(color) {
            selectedThemeColor = color;
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.color === color);
            });
        }

        async function saveTheme() {
            const name = document.getElementById('themeNameInput').value.trim();
            if (!name) {
                showToast('Please enter a theme name', 'error');
                return;
            }

            try {
                if (editingThemeId) {
                    // Update existing theme
                    const response = await fetch(API_BASE + '/api/themes/' + editingThemeId, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + currentUser.token
                        },
                        body: JSON.stringify({ name, color: selectedThemeColor })
                    });
                    if (response.ok) {
                        showToast('Theme updated');
                    }
                } else {
                    // Create new theme
                    const response = await fetch(API_BASE + '/api/themes', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + currentUser.token
                        },
                        body: JSON.stringify({ name, color: selectedThemeColor })
                    });
                    if (response.ok) {
                        showToast('Theme created');
                    }
                }

                closeThemeDialog();
                loadThemes();
            } catch (err) {
                showToast('Failed to save theme', 'error');
            }
        }

        async function deleteTheme(themeId) {
            if (!confirm('Delete this theme? Notes will be kept.')) return;

            try {
                const response = await fetch(API_BASE + '/api/themes/' + themeId, {
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer ' + currentUser.token }
                });
                if (response.ok) {
                    showToast('Theme deleted');
                    if (currentThemeId === themeId) {
                        currentThemeId = 0;
                    }
                    loadThemes();
                    loadNotes(true);
                }
            } catch (err) {
                showToast('Failed to delete theme', 'error');
            }
        }

        function showMoveToTheme(noteId) {
            noteToMove = noteId;
            renderThemesSelectList();
            document.getElementById('moveToThemeOverlay').classList.add('active');
        }

        function closeMoveToTheme() {
            document.getElementById('moveToThemeOverlay').classList.remove('active');
            noteToMove = null;
        }

        function closeMoveToThemeOnBackdrop(event) {
            if (event.target === event.currentTarget) {
                closeMoveToTheme();
            }
        }

        function renderThemesSelectList() {
            const list = document.getElementById('themesSelectList');
            let html = `
                <div class="theme-select-item" onclick="moveNoteToTheme(0)">
                    <span class="theme-color-dot" style="background: var(--text-3)"></span>
                    <span class="theme-select-name">No Theme</span>
                </div>
            `;

            for (const theme of userThemes) {
                html += `
                    <div class="theme-select-item" onclick="moveNoteToTheme(${theme.id})">
                        <span class="theme-color-dot" style="background: ${theme.color}"></span>
                        <span class="theme-select-name">${escapeHtml(theme.name)}</span>
                    </div>
                `;
            }

            list.innerHTML = html;
        }

        async function moveNoteToTheme(themeId) {
            if (!noteToMove) return;

            try {
                const response = await fetch(API_BASE + '/api/notes/move-to-theme', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + currentUser.token
                    },
                    body: JSON.stringify({ note_id: noteToMove, theme_id: themeId })
                });

                if (response.ok) {
                    showToast('Note moved');
                    closeMoveToTheme();
                    loadThemes();
                    loadNotes(true);
                }
            } catch (err) {
                showToast('Failed to move note', 'error');
            }
        }

        // ==================== Search ====================
        function handleSearch(query) {
            // Debounce search
            if (searchDebounceTimer) {
                clearTimeout(searchDebounceTimer);
            }

            const clearBtn = document.getElementById('searchClear');
            if (clearBtn) {
                clearBtn.style.display = query ? 'flex' : 'none';
            }

            searchDebounceTimer = setTimeout(() => {
                currentSearchQuery = query.trim();
                loadNotes(true);

                // Update title to show search status
                const title = document.getElementById('notesListTitle');
                if (title) {
                    title.textContent = currentSearchQuery ? `Search: "${currentSearchQuery}"` : 'Notes';
                }
            }, 300);
        }

        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
            }
            currentSearchQuery = '';

            const clearBtn = document.getElementById('searchClear');
            if (clearBtn) {
                clearBtn.style.display = 'none';
            }

            const title = document.getElementById('notesListTitle');
            if (title) {
                title.textContent = 'Notes';
            }

            loadNotes(true);
        }

        // ==================== Textarea Auto-resize ====================
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('noteContent');
            if (!textarea) return;

            function resize() {
                textarea.style.height = 'auto';
                textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            }

            textarea.addEventListener('input', resize);
            textarea.addEventListener('focus', resize);
            resize(); // Initial resize

            // Handle enter key to submit (Cmd/Ctrl + Enter)
            textarea.addEventListener('keydown', (e) => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                    e.preventDefault();
                    createNote();
                }
            });
        }

        // ==================== Init ====================
        initTheme();
        checkAuth();
        setupNavScroll();
        setupInfiniteScroll();
        setupNoteParticles();
        setupZhizhiCat();
        setupTextareaAutoResize();
    </script>
</body>
</html>
